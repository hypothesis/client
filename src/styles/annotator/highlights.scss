@use 'tailwindcss/components';

body {
  --hypothesis-color-yellow: #fef9c3;
  --hypothesis-color-yellow--nested: #fef08a;

  --hypothesis-color-purple: #ede9fe;
  --hypothesis-color-orange: #ffedd5;
  --hypothesis-color-blue: #e0f2fe;
  --hypothesis-color-green: #d1fae5;

  // Default anchor highlight colors
  --hypothesis-highlight-color: var(--hypothesis-color-yellow);
  --hypothesis-highlight-color--second: var(--hypothesis-color-yellow--nested);

  // Color for focused annotations
  --hypothesis-highlight-color--focused: var(--hypothesis-color-blue);

  // Default colors for anchor clusters
  --hypothesis-cluster-all: var(--hypothesis-color-yellow);
  --hypothesis-cluster-my-highlights: var(--hypothesis-color-purple);
  --hypothesis-cluster-my-annotations: var(--hypothesis-color-orange);
}

// Highlight coloring without clustering
.hypothesis-highlight {
  mix-blend-mode: normal;
  --highlight-color: var(--hypothesis-highlight-color);

  & > .hypothesis-highlight {
    --highlight-color: var(--hypothesis-highlight-color--second);
  }
}

.cluster {
  mix-blend-mode: normal;

  &.cluster-all {
    --highlight-color: var(--hypothesis-cluster-all);
    & > & {
      mix-blend-mode: multiply;
    }
  }

  &.cluster-my-highlights {
    --highlight-color: var(--hypothesis-cluster-my-highlights);
    & > & {
      mix-blend-mode: multiply;
    }
  }

  &.cluster-my-annotations {
    --highlight-color: var(--hypothesis-cluster-my-annotations);
    & > & {
      mix-blend-mode: multiply;
    }
  }

  // Disable `mix-blend-mode: multiply` to avoid making background colors
  // too dark when several levels deep
  & > & > & > & > & {
    mix-blend-mode: normal;
  }
}

.hypothesis-highlights-always-on {
  .hypothesis-highlight {
    background-color: var(--highlight-color);

    // For PDFs, we still create highlight elements to wrap the text but the
    // highlight effect is created by another element.
    &.is-transparent {
      background-color: transparent !important;
    }

    // When an annotation card is hovered in the sidebar, the corresponding
    // highlights are shown with a "focused" color.
    &.hypothesis-highlight-focused {
      mix-blend-mode: normal !important;
      background-color: var(--hypothesis-highlight-color--focused) !important;

      .hypothesis-highlight {
        background-color: transparent !important;
      }
    }

    cursor: pointer;

    // Make highlights visible to screen readers.
    // See also - https://developer.paciellogroup.com/blog/2017/12/short-note-on-making-your-mark-more-accessible/.
    &::before {
      @apply sr-only;

      // nb. The leading/trailing spaces are intended to ensure the text is treated
      // as separate words by assistive technologies from the content before/after it.
      content: ' annotation start ';
    }
    &::after {
      @apply sr-only;
      content: ' annotation end ';
    }
  }
}

// Prototype: Leaving PDF highlights alone for now

.hypothesis-svg-highlight {
  // These are untouched
  --highlight-color: rgba(255, 255, 60, 0.4);
  --highlight-color--second: rgba(206, 206, 60, 0.4);
  --highlight-color--focused: rgba(156, 230, 255, 0.5);
}

// SVG highlights when the "Show Highlights" toggle is turned off.
.hypothesis-svg-highlight {
  fill: transparent;
}

// `hypothesis-highlights-always-on` is a class that is toggled on the root
// of the annotated document when highlights are enabled/disabled.
.hypothesis-highlights-always-on {
  .hypothesis-svg-highlight {
    fill: var(--highlight-color);

    &.is-focused {
      fill: var(--highlight-color--focused);
    }
  }
}

// Placeholder element to which annotations for off-screen content in PDFs
// is anchored.
.annotator-placeholder {
  opacity: 0;
  position: absolute;
  top: 50%;
  z-index: -1;
}
