:root {
  // Default highlight styling configuration
  --hypothesis-highlight-color: rgba(255, 255, 60, 0.4);
  --hypothesis-highlight-focused-color: rgba(156, 230, 255, 0.5);
  --hypothesis-highlight-text-color: inherit;

  --hypothesis-highlight-second-color: rgba(206, 206, 60, 0.4);
  --hypothesis-highlight-third-color: transparent;

  // Colors available for clustered highlights
  // TODO: This color does not have enough contrast with green or blue highlight colors
  --hypothesis-color-cyan: #cffafe;

  --hypothesis-color-blue: rgb(224, 243, 255);
  --hypothesis-color-blue-1: rgb(203, 235, 255);
  --hypothesis-color-blue-2: rgb(187, 228, 255);

  --hypothesis-color-yellow: rgb(254, 249, 195);
  --hypothesis-color-yellow-1: rgb(253, 243, 149); // Full
  --hypothesis-color-yellow-2: rgb(252, 235, 111); // 0.75

  --hypothesis-color-purple: rgb(234, 231, 254); // 215, 209, 253
  // == multiply at .8 opacity on white
  --hypothesis-color-purple-1: rgb(219, 213, 253); // 188, 178, 251
  // == multiply 1 @.4 opacity on white
  --hypothesis-color-purple-2: rgb(206, 199, 252);

  --hypothesis-color-orange: rgb(255, 237, 214);
  --hypothesis-color-orange-1: rgb(255, 223, 187);
  --hypothesis-color-orange-2: rgb(255, 212, 167);

  --hypothesis-color-green: rgb(209, 250, 229);
  --hypothesis-color-green-1: rgb(179, 246, 211);
  --hypothesis-color-green-2: rgb(144, 241, 188);

  --hypothesis-color-pink: rgb(255, 229, 231);
  --hypothesis-color-pink-1: rgb(255, 211, 213);
  --hypothesis-color-pink-2: rgb(254, 197, 199);

  // Clustered highlight styling configuration
  // These values are updated by the `highlight-clusters` module
  --hypothesis-cluster-text-color: #333333;

  --hypothesis-other-content-color: var(--hypothesis-color-yellow);
  --hypothesis-other-content-color-1: var(--hypothesis-color-yellow);
  --hypothesis-other-content-color-2: var(--hypothesis-color-yellow);

  --hypothesis-user-highlights-color: var(--hypothesis-color-yellow);
  --hypothesis-user-highlights-color-1: var(--hypothesis-color-yellow);
  --hypothesis-user-highlights-color-2: var(--hypothesis-color-yellow);

  --hypothesis-user-annotations-color: var(--hypothesis-color-yellow);
  --hypothesis-user-annotations-color-1: var(--hypothesis-color-yellow);
  --hypothesis-user-annotations-color-2: var(--hypothesis-color-yellow);
}

// Configure highlight styling.
// Map `--hypothesis-*` root values to local `--highlight-*` values
.hypothesis-highlight,
.hypothesis-svg-highlight {
  --highlight-color: var(--hypothesis-highlight-color);
  --highlight-text-color: var(--hypothesis-highlight-text-color);
  --highlight-color-focused: var(--hypothesis-highlight-focused-color);

  & .hypothesis-highlight {
    --highlight-color: var(--hypothesis-highlight-second-color);

    .hypothesis-highlight {
      // Highlights more than two levels deep are transparent by default.
      --highlight-color: var(--hypothesis-highlight-third-color);
    }
  }
}

@mixin clusterHighlightStyles($clusterValue) {
  .hypothesis-highlight.#{$clusterValue},
  .hypothesis-svg-highlight.#{$clusterValue} {
    // Base color for this cluster value
    --highlight-color: var(--hypothesis-#{$clusterValue}-color);

    // Style highlights based on DOM hierarchy of <hypothesis-highlight>
    // elements. This is applicable to HTML documents.
    & > .#{$clusterValue} {
      --highlight-color: var(--hypothesis-#{$clusterValue}-color-1);
    }

    & > .#{$clusterValue} > .#{$clusterValue} {
      --highlight-color: var(--hypothesis-#{$clusterValue}-color-2);
    }

    // Style highlights based on data attributes set by `highlight-clusters`
    // This is available on any document type/integration that supports cluster
    // highlights.

    // Styling for any cluster-level depth > 1
    &[data-cluster-level] {
      --highlight-color: var(--hypothesis-#{$clusterValue}-color-2);
    }

    &[data-cluster-level='1'] {
      --highlight-color: var(--hypothesis-#{$clusterValue}-color-1);
    }

    &[data-cluster-level='0'] {
      --highlight-color: var(--hypothesis-#{$clusterValue}-color);
    }
  }
}

// Configure clustered highlight styling. The `.hypothesis-highlights-clustered`
// class is managed by `highlight-clusters`
.hypothesis-highlights-clustered {
  .hypothesis-highlight,
  .hypothesis-svg-highlight {
    // When clustered highlights are active, use an opaque color for focused
    // annotations so we don't end up with a funny color mix
    --highlight-color-focused: var(--hypothesis-color-cyan);
  }

  .hypothesis-highlight {
    --highlight-text-color: var(--hypothesis-cluster-text-color);
  }

  @include clusterHighlightStyles('user-highlights');
  @include clusterHighlightStyles('user-annotations');
  @include clusterHighlightStyles('other-content');
}

// Apply highlight styling.

// Highlights are non-visible when .hypothesis-highlight-always-on class not present.
.hypothesis-highlight {
  background-color: transparent;
  // For PDFs, we still create highlight elements to wrap the text but the
  // highlight effect is created by another element.
  &.is-transparent {
    background-color: transparent !important;
    color: inherit !important;
  }
}

.hypothesis-svg-highlight {
  fill: transparent;
}

// Apply styling using `--highlight-` values when highlights are visible
// The `.hypothesis-highlights-always-on` class is managed by `highlighter`
.hypothesis-highlights-always-on .hypothesis-svg-highlight {
  transition: fill 300ms;
  fill: var(--highlight-color);

  &.is-opaque {
    fill: yellow;
  }

  &.is-focused {
    fill: var(--highlight-color-focused);
  }
}

.hypothesis-highlights-always-on .hypothesis-highlight {
  color: var(--highlight-text-color);
  background-color: var(--highlight-color);
  transition: background-color 300ms;

  cursor: pointer;

  // Make highlights visible to screen readers.
  // See also - https://developer.paciellogroup.com/blog/2017/12/short-note-on-making-your-mark-more-accessible/.
  &::before {
    @apply sr-only;

    // nb. The leading/trailing spaces are intended to ensure the text is treated
    // as separate words by assistive technologies from the content before/after it.
    content: ' annotation start ';
  }
  &::after {
    @apply sr-only;
    content: ' annotation end ';
  }
}

// Apply focused-highlight styling

.hypothesis-highlights-always-on
  .hypothesis-highlight.hypothesis-highlight-focused {
  // When an annotation card is hovered in the sidebar, the corresponding
  // highlights are shown with a "focused" color.
  &.hypothesis-highlight-focused {
    mix-blend-mode: normal !important;
    background-color: var(--highlight-color-focused) !important;

    .hypothesis-highlight {
      background-color: transparent !important;
    }
  }
}

// Placeholder element to which annotations for off-screen content in PDFs
// is anchored.
.annotator-placeholder {
  opacity: 0;
  position: absolute;
  top: 50%;
  z-index: -1;
}
