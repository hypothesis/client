(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){
!function(t,e){"use strict";var n=window.angulartics||(window.angulartics={});n.waitForVendorCount=0,n.waitForVendorApi=function(t,e,a,i,r){r||n.waitForVendorCount++,i||(i=a,a=void 0),!Object.prototype.hasOwnProperty.call(window,t)||void 0!==a&&void 0===window[t][a]?setTimeout(function(){n.waitForVendorApi(t,e,a,i,!0)},e):(n.waitForVendorCount--,i(window[t]))},t.module("angulartics",[]).provider("$analytics",function(){var e={pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},eventTracking:{},bufferFlushDelay:1e3,developerMode:!1},a=["pageTrack","eventTrack","setAlias","setUsername","setAlias","setUserProperties","setUserPropertiesOnce","setSuperProperties","setSuperPropertiesOnce"],i={},r={},s=function(t){return function(){n.waitForVendorCount&&(i[t]||(i[t]=[]),i[t].push(arguments))}},o=function(e,n){return r[e]||(r[e]=[]),r[e].push(n),function(){var n=arguments;t.forEach(r[e],function(t){t.apply(this,n)},this)}},u={settings:e},c=function(t,e){e?setTimeout(t,e):t()},g={$get:function(){return u},api:u,settings:e,virtualPageviews:function(t){this.settings.pageTracking.autoTrackVirtualPages=t},firstPageview:function(t){this.settings.pageTracking.autoTrackFirstPage=t},withBase:function(e){this.settings.pageTracking.basePath=e?t.element("base").attr("href").slice(0,-1):""},withAutoBase:function(t){this.settings.pageTracking.autoBasePath=t},developerMode:function(t){this.settings.developerMode=t}},f=function(n,a){u[n]=o(n,a);var r=e[n],s=r?r.bufferFlushDelay:null,g=null!==s?s:e.bufferFlushDelay;t.forEach(i[n],function(t,e){c(function(){a.apply(this,t)},e*g)})},l=function(t){return t.replace(/^./,function(t){return t.toUpperCase()})},p=function(t){var e="register"+l(t);g[e]=function(e){f(t,e)},u[t]=o(t,s(t))};return t.forEach(a,p),g}).run(["$rootScope","$window","$analytics","$injector",function(e,n,a,i){a.settings.pageTracking.autoTrackFirstPage&&i.invoke(["$location",function(t){var e=!0;if(i.has("$route")){var r=i.get("$route");for(var s in r.routes){e=!1;break}}else if(i.has("$state")){var o=i.get("$state");for(var u in o.get()){e=!1;break}}if(e)if(a.settings.pageTracking.autoBasePath&&(a.settings.pageTracking.basePath=n.location.pathname),a.settings.trackRelativePath){var c=a.settings.pageTracking.basePath+t.url();a.pageTrack(c,t)}else a.pageTrack(t.absUrl(),t)}]),a.settings.pageTracking.autoTrackVirtualPages&&i.invoke(["$location",function(t){a.settings.pageTracking.autoBasePath&&(a.settings.pageTracking.basePath=n.location.pathname+"#"),i.has("$route")&&e.$on("$routeChangeSuccess",function(e,n){if(!n||!(n.$$route||n).redirectTo){var i=a.settings.pageTracking.basePath+t.url();a.pageTrack(i,t)}}),i.has("$state")&&e.$on("$stateChangeSuccess",function(e,n){var i=a.settings.pageTracking.basePath+t.url();a.pageTrack(i,t)})}]),a.settings.developerMode&&t.forEach(a,function(t,e){"function"==typeof t&&(a[e]=function(){})})}]).directive("analyticsOn",["$analytics",function(e){function n(t){return["a:","button:","button:button","button:submit","input:button","input:submit"].indexOf(t.tagName.toLowerCase()+":"+(t.type||""))>=0}function a(t){return n(t),"click"}function i(t){return n(t)?t.innerText||t.value:t.id||t.name||t.tagName}function r(t){return"analytics"===t.substr(0,9)&&-1===["On","Event","If","Properties","EventType"].indexOf(t.substr(9))}function s(t){var e=t.slice(9);return void 0!==e&&null!==e&&e.length>0?e.substring(0,1).toLowerCase()+e.substring(1):e}return{restrict:"A",link:function(n,o,u){var c=u.analyticsOn||a(o[0]),g={};t.forEach(u.$attr,function(t,e){r(e)&&(g[s(e)]=u[e],u.$observe(e,function(t){g[s(e)]=t}))}),t.element(o[0]).bind(c,function(a){var r=u.analyticsEvent||i(o[0]);g.eventType=a.type,u.analyticsIf&&!n.$eval(u.analyticsIf)||(u.analyticsProperties&&t.extend(g,n.$eval(u.analyticsProperties)),e.eventTrack(r,g))})}}}])}(angular);

},{}],2:[function(require,module,exports){
!function(n){function t(){var n,t;for(n=0;n<this.length;n++)t=this[n],e(t)||(u(t),c(t))}function e(n){"$$currentValue"in n||(n.$$currentValue=n.getAttribute("value"));var t=n.value,e=n.$$currentValue;return!t&&!e||t===e}function u(n){n.$$currentValue=n.value}function r(n,t){function e(n){var e=n.target;t(e)}l.addEventListener(n,e,!0)}function i(n){for(;n;){if("FORM"===n.nodeName)return a(n);n=n.parentNode}return a()}function o(n,t){if(n.forEach)return n.forEach(t);var e;for(e=0;e<n.length;e++)t(n[e])}function c(t){var e=n.document,u=e.createEvent("HTMLEvents");u.initEvent("change",!0,!0),t.dispatchEvent(u)}var a=n.jQuery||n.angular.element,l=n.document.documentElement,f=a(l);r("change",u),function(t){var e=n.jQuery||n.angular.element,u=e.prototype,r=u.val;u.val=function(n){var e=r.apply(this,arguments);return arguments.length>0&&o(this,function(e){t(e,n)}),e}}(u),a.prototype.checkAndTriggerAutoFillEvent=t,r("blur",function(t){n.setTimeout(function(){i(t).find("input").checkAndTriggerAutoFillEvent()},20)}),n.document.addEventListener("DOMContentLoaded",function(){o(document.getElementsByTagName("input"),u),n.setTimeout(function(){f.find("input").checkAndTriggerAutoFillEvent()},200)},!1)}(window);

},{}],3:[function(require,module,exports){
"use strict";function escapeHtml(e){var t=""+e,a=matchHtmlRegExp.exec(t);if(!a)return t;var r,c="",s=0,n=0;for(s=a.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#39;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}n!==s&&(c+=t.substring(n,s)),n=s+1,c+=r}return n!==s?c+t.substring(n,s):c}var matchHtmlRegExp=/["'&<>]/;module.exports=escapeHtml;

},{}],4:[function(require,module,exports){
var hasOwn=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,undefined,isArray=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===toStr.call(t)},isPlainObject=function(t){"use strict";if(!t||"[object Object]"!==toStr.call(t))return!1;var r=hasOwn.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&hasOwn.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!o)return!1;var n;for(n in t);return n===undefined||hasOwn.call(t,n)};module.exports=function t(){"use strict";var r,o,n,e,c,i,a=arguments[0],s=1,u=arguments.length,l=!1;for("boolean"==typeof a?(l=a,a=arguments[1]||{},s=2):("object"!=typeof a&&"function"!=typeof a||null==a)&&(a={});s<u;++s)if(null!=(r=arguments[s]))for(o in r)n=a[o],e=r[o],a!==e&&(l&&e&&(isPlainObject(e)||(c=isArray(e)))?(c?(c=!1,i=n&&isArray(n)?n:[]):i=n&&isPlainObject(n)?n:{},a[o]=t(l,i,e)):e!==undefined&&(a[o]=e));return a};

},{}],5:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};

},{}],6:[function(require,module,exports){
(function (global){
function debounce(e,t,r){function o(t){var r=s,o=v;return s=v=void 0,O=t,j=e.apply(o,r)}function n(e){return O=e,y=setTimeout(a,t),d?o(e):j}function i(e){var r=e-p,o=e-O,n=t-r;return T?nativeMin(n,m-o):n}function u(e){var r=e-p,o=e-O;return void 0===p||r>=t||r<0||T&&o>=m}function a(){var e=now();if(u(e))return f(e);y=setTimeout(a,i(e))}function f(e){return y=void 0,g&&s?o(e):(s=v=void 0,j)}function c(){void 0!==y&&clearTimeout(y),O=0,s=p=v=y=void 0}function l(){return void 0===y?j:f(now())}function b(){var e=now(),r=u(e);if(s=arguments,v=this,p=e,r){if(void 0===y)return n(p);if(T)return y=setTimeout(a,t),o(p)}return void 0===y&&(y=setTimeout(a,t)),j}var s,v,m,j,y,p,O=0,d=!1,T=!1,g=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return t=toNumber(t)||0,isObject(r)&&(d=!!r.leading,T="maxWait"in r,m=T?nativeMax(toNumber(r.maxWait)||0,t):m,g="trailing"in r?!!r.trailing:g),b.cancel=c,b.flush=l,b}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var FUNC_ERROR_TEXT="Expected a function",NAN=NaN,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};module.exports=debounce;

}).call(this,window)

},{}],7:[function(require,module,exports){
(function (global){
function getValue(t,e){return null==t?void 0:t[e]}function isHostObject(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function Hash(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(t){return this.has(t)&&delete this.__data__[t]}function hashGet(t){var e=this.__data__;if(nativeCreate){var r=e[t];return r===HASH_UNDEFINED?void 0:r}return hasOwnProperty.call(e,t)?e[t]:void 0}function hashHas(t){var e=this.__data__;return nativeCreate?void 0!==e[t]:hasOwnProperty.call(e,t)}function hashSet(t,e){return this.__data__[t]=nativeCreate&&void 0===e?HASH_UNDEFINED:e,this}function ListCache(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(t){var e=this.__data__,r=assocIndexOf(e,t);return!(r<0)&&(r==e.length-1?e.pop():splice.call(e,r,1),!0)}function listCacheGet(t){var e=this.__data__,r=assocIndexOf(e,t);return r<0?void 0:e[r][1]}function listCacheHas(t){return assocIndexOf(this.__data__,t)>-1}function listCacheSet(t,e){var r=this.__data__,a=assocIndexOf(r,t);return a<0?r.push([t,e]):r[a][1]=e,this}function MapCache(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(t){return getMapData(this,t).delete(t)}function mapCacheGet(t){return getMapData(this,t).get(t)}function mapCacheHas(t){return getMapData(this,t).has(t)}function mapCacheSet(t,e){return getMapData(this,t).set(t,e),this}function assocIndexOf(t,e){for(var r=t.length;r--;)if(eq(t[r][0],e))return r;return-1}function baseGet(t,e){e=isKey(e,t)?[e]:castPath(e);for(var r=0,a=e.length;null!=t&&r<a;)t=t[toKey(e[r++])];return r&&r==a?t:void 0}function baseIsNative(t){return!(!isObject(t)||isMasked(t))&&(isFunction(t)||isHostObject(t)?reIsNative:reIsHostCtor).test(toSource(t))}function baseToString(t){if("string"==typeof t)return t;if(isSymbol(t))return symbolToString?symbolToString.call(t):"";var e=t+"";return"0"==e&&1/t==-INFINITY?"-0":e}function castPath(t){return isArray(t)?t:stringToPath(t)}function getMapData(t,e){var r=t.__data__;return isKeyable(e)?r["string"==typeof e?"string":"hash"]:r.map}function getNative(t,e){var r=getValue(t,e);return baseIsNative(r)?r:void 0}function isKey(t,e){if(isArray(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!isSymbol(t))||(reIsPlainProp.test(t)||!reIsDeepProp.test(t)||null!=e&&t in Object(e))}function isKeyable(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function isMasked(t){return!!maskSrcKey&&maskSrcKey in t}function toKey(t){if("string"==typeof t||isSymbol(t))return t;var e=t+"";return"0"==e&&1/t==-INFINITY?"-0":e}function toSource(t){if(null!=t){try{return funcToString.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function memoize(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var a=arguments,o=e?e.apply(this,a):a[0],n=r.cache;if(n.has(o))return n.get(o);var i=t.apply(this,a);return r.cache=n.set(o,i),i};return r.cache=new(memoize.Cache||MapCache),r}function eq(t,e){return t===e||t!==t&&e!==e}function isFunction(t){var e=isObject(t)?objectToString.call(t):"";return e==funcTag||e==genTag}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag}function toString(t){return null==t?"":baseToString(t)}function get(t,e,r){var a=null==t?void 0:baseGet(t,e);return void 0===a?r:a}var FUNC_ERROR_TEXT="Expected a function",HASH_UNDEFINED="__lodash_hash_undefined__",INFINITY=1/0,funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]",reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reEscapeChar=/\\(\\)?/g,reIsHostCtor=/^\[object .+?Constructor\]$/,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=function(){var t=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Symbol=root.Symbol,splice=arrayProto.splice,Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create"),symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var stringToPath=memoize(function(t){t=toString(t);var e=[];return reLeadingDot.test(t)&&e.push(""),t.replace(rePropName,function(t,r,a,o){e.push(a?o.replace(reEscapeChar,"$1"):r||t)}),e});memoize.Cache=MapCache;var isArray=Array.isArray;module.exports=get;

}).call(this,window)

},{}],8:[function(require,module,exports){
var root=require("./_root"),Symbol=root.Symbol;module.exports=Symbol;

},{"./_root":15}],9:[function(require,module,exports){
function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var Symbol=require("./_Symbol"),getRawTag=require("./_getRawTag"),objectToString=require("./_objectToString"),nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol?Symbol.toStringTag:void 0;module.exports=baseGetTag;

},{"./_Symbol":8,"./_getRawTag":12,"./_objectToString":13}],10:[function(require,module,exports){
(function (global){
var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global;module.exports=freeGlobal;

}).call(this,window)

},{}],11:[function(require,module,exports){
var overArg=require("./_overArg"),getPrototype=overArg(Object.getPrototypeOf,Object);module.exports=getPrototype;

},{"./_overArg":14}],12:[function(require,module,exports){
function getRawTag(t){var o=hasOwnProperty.call(t,symToStringTag),r=t[symToStringTag];try{t[symToStringTag]=void 0;var a=!0}catch(t){}var e=nativeObjectToString.call(t);return a&&(o?t[symToStringTag]=r:delete t[symToStringTag]),e}var Symbol=require("./_Symbol"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=Symbol?Symbol.toStringTag:void 0;module.exports=getRawTag;

},{"./_Symbol":8}],13:[function(require,module,exports){
function objectToString(t){return nativeObjectToString.call(t)}var objectProto=Object.prototype,nativeObjectToString=objectProto.toString;module.exports=objectToString;

},{}],14:[function(require,module,exports){
function overArg(r,e){return function(n){return r(e(n))}}module.exports=overArg;

},{}],15:[function(require,module,exports){
var freeGlobal=require("./_freeGlobal"),freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();module.exports=root;

},{"./_freeGlobal":10}],16:[function(require,module,exports){
function isObjectLike(e){return null!=e&&"object"==typeof e}module.exports=isObjectLike;

},{}],17:[function(require,module,exports){
function isPlainObject(t){if(!isObjectLike(t)||baseGetTag(t)!=objectTag)return!1;var e=getPrototype(t);if(null===e)return!0;var o=hasOwnProperty.call(e,"constructor")&&e.constructor;return"function"==typeof o&&o instanceof o&&funcToString.call(o)==objectCtorString}var baseGetTag=require("./_baseGetTag"),getPrototype=require("./_getPrototype"),isObjectLike=require("./isObjectLike"),objectTag="[object Object]",funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectCtorString=funcToString.call(Object);module.exports=isPlainObject;

},{"./_baseGetTag":9,"./_getPrototype":11,"./isObjectLike":16}],18:[function(require,module,exports){
!function(n){"use strict";function e(n,e,r){var o=e&&r||0,t=0;for(e=e||[],n.toLowerCase().replace(/[0-9a-f]{2}/g,function(n){t<16&&(e[o+t++]=d[n])});t<16;)e[o+t++]=0;return e}function r(n,e){var r=e||0,o=l;return o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+"-"+o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]+o[n[r++]]}function o(n,e,o){var t=e&&o||0,u=e||[];n=n||{};var a=null!=n.clockseq?n.clockseq:p,f=null!=n.msecs?n.msecs:(new Date).getTime(),i=null!=n.nsecs?n.nsecs:g+1,c=f-w+(i-g)/1e4;if(c<0&&null==n.clockseq&&(a=a+1&16383),(c<0||f>w)&&null==n.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");w=f,g=i,p=a,f+=122192928e5;var s=(1e4*(268435455&f)+i)%4294967296;u[t++]=s>>>24&255,u[t++]=s>>>16&255,u[t++]=s>>>8&255,u[t++]=255&s;var l=f/4294967296*1e4&268435455;u[t++]=l>>>8&255,u[t++]=255&l,u[t++]=l>>>24&15|16,u[t++]=l>>>16&255,u[t++]=a>>>8|128,u[t++]=255&a;for(var d=n.node||m,v=0;v<6;v++)u[t+v]=d[v];return e||r(u)}function t(n,e,o){var t=e&&o||0;"string"==typeof n&&(e="binary"===n?new s(16):null,n=null),n=n||{};var a=n.random||(n.rng||u)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var f=0;f<16;f++)e[t+f]=a[f];return e||r(a)}var u,a,f,i,c;n?function(){var e=n.crypto||n.msCrypto;if(!u&&e&&e.getRandomValues)try{var r=new Uint8Array(16);i=u=function(){return e.getRandomValues(r),r},u()}catch(n){}if(!u){var o=new Array(16);a=u=function(){for(var n,e=0;e<16;e++)0==(3&e)&&(n=4294967296*Math.random()),o[e]=n>>>((3&e)<<3)&255;return o},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}():function(){if("function"==typeof require)try{var n=require("crypto").randomBytes;f=u=n&&function(){return n(16)},u()}catch(n){}}();for(var s="function"==typeof Buffer?Buffer:Array,l=[],d={},v=0;v<256;v++)l[v]=(v+256).toString(16).substr(1),d[l[v]]=v;var y=u(),m=[1|y[0],y[1],y[2],y[3],y[4],y[5]],p=16383&(y[6]<<8|y[7]),w=0,g=0,h=t;h.v1=o,h.v4=t,h.parse=e,h.unparse=r,h.BufferClass=s,h._rng=u,h._mathRNG=a,h._nodeRNG=f,h._whatwgRNG=i,"undefined"!=typeof module&&module.exports?module.exports=h:"function"==typeof define&&define.amd?define(function(){return h}):(c=n.uuid,h.noConflict=function(){return n.uuid=c,h},n.uuid=h)}("undefined"!=typeof window?window:null);

},{"crypto":undefined}],19:[function(require,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],20:[function(require,module,exports){
"use strict";var strictUriEncode=require("strict-uri-encode");exports.extract=function(r){return r.split("?")[1]||""},exports.parse=function(r){return"string"!=typeof r?{}:(r=r.trim().replace(/^(\?|#|&)/,""),r?r.split("&").reduce(function(r,t){var e=t.replace(/\+/g," ").split("="),n=e.shift(),i=e.length>0?e.join("="):void 0;return n=decodeURIComponent(n),i=void 0===i?null:decodeURIComponent(i),r.hasOwnProperty(n)?Array.isArray(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i,r},{}):{})},exports.stringify=function(r){return r?Object.keys(r).sort().map(function(t){var e=r[t];return void 0===e?"":null===e?t:Array.isArray(e)?e.slice().sort().map(function(r){return strictUriEncode(t)+"="+strictUriEncode(r)}).join("&"):strictUriEncode(t)+"="+strictUriEncode(e)}).filter(function(r){return r.length>0}).join("&"):""};

},{"strict-uri-encode":37}],21:[function(require,module,exports){
function angularPlugin(a,e){function n(){this.$get=["$window",function(e){return a}]}function r(a){a.decorator("$exceptionHandler",["Raven","$delegate",u])}function u(a,e){return function(n,r){a.captureException(n,{extra:{cause:r}}),e(n,r)}}(e=e||window.angular)&&(e.module(moduleName,[]).provider("Raven",n).config(["$provide",r]),a.setDataCallback(wrappedCallback(function(a){return angularPlugin._normalizeData(a)})))}var wrappedCallback=require("../src/utils").wrappedCallback,angularPattern=/^\[((?:[$a-zA-Z0-9]+:)?(?:[$a-zA-Z0-9]+))\] (.*?)\n?(\S+)$/,moduleName="ngRaven";angularPlugin._normalizeData=function(a){var e=a.exception;if(e){e=e.values[0];var n=angularPattern.exec(e.value);n&&(e.type=n[1],e.value=n[2],a.message=e.type+": "+e.value,a.extra.angularDocs=n[3].substr(0,250))}return a},angularPlugin.moduleName=moduleName,module.exports=angularPlugin;

},{"../src/utils":22}],22:[function(require,module,exports){
(function (global){
function isObject(e){return"object"==typeof e&&null!==e}function isError(e){switch({}.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}}function isErrorEvent(e){return supportsErrorEvent()&&"[object ErrorEvent]"==={}.toString.call(e)}function isUndefined(e){return void 0===e}function isFunction(e){return"function"==typeof e}function isPlainObject(e){return"[object Object]"===Object.prototype.toString.call(e)}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function isEmptyObject(e){if(!isPlainObject(e))return!1;for(var r in e)if(e.hasOwnProperty(r))return!1;return!0}function supportsErrorEvent(){try{return new ErrorEvent(""),!0}catch(e){return!1}}function supportsFetch(){if(!("fetch"in _window))return!1;try{return new Headers,new Request(""),new Response,!0}catch(e){return!1}}function supportsReferrerPolicy(){if(!supportsFetch())return!1;try{return new Request("pickleRick",{referrerPolicy:"origin"}),!0}catch(e){return!1}}function supportsPromiseRejectionEvent(){return"function"==typeof PromiseRejectionEvent}function wrappedCallback(e){function r(r,t){var n=e(r)||r;return t?t(n)||n:n}return r}function each(e,r){var t,n;if(isUndefined(e.length))for(t in e)hasKey(e,t)&&r.call(null,t,e[t]);else if(n=e.length)for(t=0;t<n;t++)r.call(null,t,e[t])}function objectMerge(e,r){return r?(each(r,function(r,t){e[r]=t}),e):e}function objectFrozen(e){return!!Object.isFrozen&&Object.isFrozen(e)}function truncate(e,r){return!r||e.length<=r?e:e.substr(0,r)+"…"}function hasKey(e,r){return Object.prototype.hasOwnProperty.call(e,r)}function joinRegExp(e){for(var r,t=[],n=0,i=e.length;n<i;n++)r=e[n],isString(r)?t.push(r.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):r&&r.source&&t.push(r.source);return new RegExp(t.join("|"),"i")}function urlencode(e){var r=[];return each(e,function(e,t){r.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),r.join("&")}function parseUrl(e){if("string"!=typeof e)return{};var r=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/),t=r[6]||"",n=r[8]||"";return{protocol:r[2],host:r[4],path:r[5],relative:r[5]+t+n}}function uuid4(){var e=_window.crypto||_window.msCrypto;if(!isUndefined(e)&&e.getRandomValues){var r=new Uint16Array(8);e.getRandomValues(r),r[3]=4095&r[3]|16384,r[4]=16383&r[4]|32768;var t=function(e){for(var r=e.toString(16);r.length<4;)r="0"+r;return r};return t(r[0])+t(r[1])+t(r[2])+t(r[3])+t(r[4])+t(r[5])+t(r[6])+t(r[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=16*Math.random()|0;return("x"===e?r:3&r|8).toString(16)})}function htmlTreeAsString(e){for(var r,t=[],n=0,i=0,o=" > ".length;e&&n++<5&&!("html"===(r=htmlElementAsString(e))||n>1&&i+t.length*o+r.length>=80);)t.push(r),i+=r.length,e=e.parentNode;return t.reverse().join(" > ")}function htmlElementAsString(e){var r,t,n,i,o,s=[];if(!e||!e.tagName)return"";if(s.push(e.tagName.toLowerCase()),e.id&&s.push("#"+e.id),(r=e.className)&&isString(r))for(t=r.split(/\s+/),o=0;o<t.length;o++)s.push("."+t[o]);var u=["type","name","title","alt"];for(o=0;o<u.length;o++)n=u[o],(i=e.getAttribute(n))&&s.push("["+n+'="'+i+'"]');return s.join("")}function isOnlyOneTruthy(e,r){return!!(!!e^!!r)}function isBothUndefined(e,r){return isUndefined(e)&&isUndefined(r)}function isSameException(e,r){return!isOnlyOneTruthy(e,r)&&(e=e.values[0],r=r.values[0],e.type===r.type&&e.value===r.value&&(!isBothUndefined(e.stacktrace,r.stacktrace)&&isSameStacktrace(e.stacktrace,r.stacktrace)))}function isSameStacktrace(e,r){if(isOnlyOneTruthy(e,r))return!1;var t=e.frames,n=r.frames;if(t.length!==n.length)return!1;for(var i,o,s=0;s<t.length;s++)if(i=t[s],o=n[s],i.filename!==o.filename||i.lineno!==o.lineno||i.colno!==o.colno||i.function!==o.function)return!1;return!0}function fill(e,r,t,n){if(null!=e){var i=e[r];e[r]=t(i),e[r].__raven__=!0,e[r].__orig__=i,n&&n.push([e,r,i])}}function safeJoin(e,r){if(!isArray(e))return"";for(var t=[],n=0;n<e.length;n++)try{t.push(String(e[n]))}catch(e){t.push("[value cannot be serialized]")}return t.join(r)}function utf8Length(e){return~-encodeURI(e).split(/%..|./).length}function jsonSize(e){return utf8Length(JSON.stringify(e))}function serializeValue(e){if("string"==typeof e)return e.length<=40?e:e.substr(0,39)+"…";if("number"==typeof e||"boolean"==typeof e||void 0===e)return e;var r=Object.prototype.toString.call(e);return"[object Object]"===r?"[Object]":"[object Array]"===r?"[Array]":"[object Function]"===r?e.name?"[Function: "+e.name+"]":"[Function]":e}function serializeObject(e,r){return 0===r?serializeValue(e):isPlainObject(e)?Object.keys(e).reduce(function(t,n){return t[n]=serializeObject(e[n],r-1),t},{}):Array.isArray(e)?e.map(function(e){return serializeObject(e,r-1)}):serializeValue(e)}function serializeException(e,r,t){if(!isPlainObject(e))return e;r="number"!=typeof r?MAX_SERIALIZE_EXCEPTION_DEPTH:r,t="number"!=typeof r?MAX_SERIALIZE_EXCEPTION_SIZE:t;var n=serializeObject(e,r);return jsonSize(stringify(n))>t?serializeException(e,r-1):n}function serializeKeysForMessage(e,r){if("number"==typeof e||"string"==typeof e)return e.toString();if(!Array.isArray(e))return"";if(e=e.filter(function(e){return"string"==typeof e}),0===e.length)return"[object has no keys]";if(r="number"!=typeof r?MAX_SERIALIZE_KEYS_LENGTH:r,e[0].length>=r)return e[0];for(var t=e.length;t>0;t--){var n=e.slice(0,t).join(", ");if(!(n.length>r))return t===e.length?n:n+"…"}return""}function sanitize(e,r){function t(e){return isArray(e)?e.map(function(e){return t(e)}):isPlainObject(e)?Object.keys(e).reduce(function(r,n){return i.test(n)?r[n]=o:r[n]=t(e[n]),r},{}):e}if(!isArray(r)||isArray(r)&&0===r.length)return e;var n,i=joinRegExp(r),o="********";try{n=JSON.parse(stringify(e))}catch(r){return e}return t(n)}var stringify=require("../vendor/json-stringify-safe/stringify"),_window="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},MAX_SERIALIZE_EXCEPTION_DEPTH=3,MAX_SERIALIZE_EXCEPTION_SIZE=51200,MAX_SERIALIZE_KEYS_LENGTH=40;module.exports={isObject:isObject,isError:isError,isErrorEvent:isErrorEvent,isUndefined:isUndefined,isFunction:isFunction,isPlainObject:isPlainObject,isString:isString,isArray:isArray,isEmptyObject:isEmptyObject,supportsErrorEvent:supportsErrorEvent,supportsFetch:supportsFetch,supportsReferrerPolicy:supportsReferrerPolicy,supportsPromiseRejectionEvent:supportsPromiseRejectionEvent,wrappedCallback:wrappedCallback,each:each,objectMerge:objectMerge,truncate:truncate,objectFrozen:objectFrozen,hasKey:hasKey,joinRegExp:joinRegExp,urlencode:urlencode,uuid4:uuid4,htmlTreeAsString:htmlTreeAsString,htmlElementAsString:htmlElementAsString,isSameException:isSameException,isSameStacktrace:isSameStacktrace,parseUrl:parseUrl,fill:fill,safeJoin:safeJoin,serializeException:serializeException,serializeKeysForMessage:serializeKeysForMessage,sanitize:sanitize};

}).call(this,window)

},{"../vendor/json-stringify-safe/stringify":23}],23:[function(require,module,exports){
function indexOf(r,i){for(var e=0;e<r.length;++e)if(r[e]===i)return e;return-1}function stringify(r,i,e,n){return JSON.stringify(r,serializer(i,n),e)}function stringifyError(r){var i={stack:r.stack,message:r.message,name:r.name};for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(i[e]=r[e]);return i}function serializer(r,i){var e=[],n=[];return null==i&&(i=function(r,i){return e[0]===i?"[Circular ~]":"[Circular ~."+n.slice(0,indexOf(e,i)).join(".")+"]"}),function(t,s){if(e.length>0){var l=indexOf(e,this);~l?e.splice(l+1):e.push(this),~l?n.splice(l,1/0,t):n.push(t),~indexOf(e,s)&&(s=i.call(this,t,s))}else e.push(s);return null==r?s instanceof Error?stringifyError(s):s:r.call(this,t,s)}}exports=module.exports=stringify,exports.getSerialize=serializer;

},{}],24:[function(require,module,exports){
"use strict";function createThunkMiddleware(t){return function(e){var n=e.dispatch,r=e.getState;return function(e){return function(u){return"function"==typeof u?u(n,r,t):e(u)}}}}exports.__esModule=!0;var thunk=createThunkMiddleware();thunk.withExtraArgument=createThunkMiddleware,exports.default=thunk;

},{}],25:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function applyMiddleware(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(r,n,o){var a=e(r,n,o),u=a.dispatch,p=[],i={getState:a.getState,dispatch:function(e){return u(e)}};return p=t.map(function(e){return e(i)}),u=_compose2.default.apply(void 0,p)(a.dispatch),_extends({},a,{dispatch:u})}}}exports.__esModule=!0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};exports.default=applyMiddleware;var _compose=require("./compose"),_compose2=_interopRequireDefault(_compose);

},{"./compose":28}],26:[function(require,module,exports){
"use strict";function bindActionCreator(t,o){return function(){return o(t.apply(void 0,arguments))}}function bindActionCreators(t,o){if("function"==typeof t)return bindActionCreator(t,o);if("object"!=typeof t||null===t)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(t),n={},e=0;e<r.length;e++){var i=r[e],c=t[i];"function"==typeof c&&(n[i]=bindActionCreator(c,o))}return n}exports.__esModule=!0,exports.default=bindActionCreators;

},{}],27:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getUndefinedStateErrorMessage(e,t){var n=t&&t.type;return"Given action "+(n&&'"'+n.toString()+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function getUnexpectedStateShapeWarningMessage(e,t,n,r){var i=Object.keys(t),o=n&&n.type===_createStore.ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===i.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!(0,_isPlainObject2.default)(e))return"The "+o+' has unexpected type of "'+{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following keys: "'+i.join('", "')+'"';var a=Object.keys(e).filter(function(e){return!t.hasOwnProperty(e)&&!r[e]});return a.forEach(function(e){r[e]=!0}),a.length>0?"Unexpected "+(a.length>1?"keys":"key")+' "'+a.join('", "')+'" found in '+o+'. Expected to find one of the known reducer keys instead: "'+i.join('", "')+'". Unexpected keys will be ignored.':void 0}function assertReducerShape(e){Object.keys(e).forEach(function(t){var n=e[t];if(void 0===n(void 0,{type:_createStore.ActionTypes.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===n(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+_createStore.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}function combineReducers(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];"function"==typeof e[i]&&(n[i]=e[i])}var o=Object.keys(n),a=void 0;try{assertReducerShape(n)}catch(e){a=e}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(a)throw a;for(var r=!1,i={},u=0;u<o.length;u++){var s=o[u],d=n[s],c=e[s],l=d(c,t);if(void 0===l){var f=getUndefinedStateErrorMessage(s,t);throw new Error(f)}i[s]=l,r=r||l!==c}return r?i:e}}exports.__esModule=!0,exports.default=combineReducers;var _createStore=require("./createStore"),_isPlainObject=require("lodash/isPlainObject"),_isPlainObject2=_interopRequireDefault(_isPlainObject),_warning=require("./utils/warning"),_warning2=_interopRequireDefault(_warning);

},{"./createStore":29,"./utils/warning":31,"lodash/isPlainObject":17}],28:[function(require,module,exports){
"use strict";function compose(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return 0===r.length?function(e){return e}:1===r.length?r[0]:r.reduce(function(e,r){return function(){return e(r.apply(void 0,arguments))}})}exports.__esModule=!0,exports.default=compose;

},{}],29:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function createStore(e,t,r){function n(){p===l&&(p=l.slice())}function o(){return b}function i(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return n(),p.push(e),function(){if(t){t=!1,n();var r=p.indexOf(e);p.splice(r,1)}}}function c(e){if(!(0,_isPlainObject2.default)(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(d)throw new Error("Reducers may not dispatch actions.");try{d=!0,b=f(b,e)}finally{d=!1}for(var t=l=p,r=0;r<t.length;r++){(0,t[r])()}return e}function u(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");f=e,c({type:ActionTypes.INIT})}function s(){var e,t=i;return e={subscribe:function(e){function r(){e.next&&e.next(o())}if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");return r(),{unsubscribe:t(r)}}},e[_symbolObservable2.default]=function(){return this},e}var a;if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(createStore)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var f=e,b=t,l=[],p=l,d=!1;return c({type:ActionTypes.INIT}),a={dispatch:c,subscribe:i,getState:o,replaceReducer:u},a[_symbolObservable2.default]=s,a}exports.__esModule=!0,exports.ActionTypes=void 0,exports.default=createStore;var _isPlainObject=require("lodash/isPlainObject"),_isPlainObject2=_interopRequireDefault(_isPlainObject),_symbolObservable=require("symbol-observable"),_symbolObservable2=_interopRequireDefault(_symbolObservable),ActionTypes=exports.ActionTypes={INIT:"@@redux/INIT"};

},{"lodash/isPlainObject":17,"symbol-observable":38}],30:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function isCrushed(){}exports.__esModule=!0,exports.compose=exports.applyMiddleware=exports.bindActionCreators=exports.combineReducers=exports.createStore=void 0;var _createStore=require("./createStore"),_createStore2=_interopRequireDefault(_createStore),_combineReducers=require("./combineReducers"),_combineReducers2=_interopRequireDefault(_combineReducers),_bindActionCreators=require("./bindActionCreators"),_bindActionCreators2=_interopRequireDefault(_bindActionCreators),_applyMiddleware=require("./applyMiddleware"),_applyMiddleware2=_interopRequireDefault(_applyMiddleware),_compose=require("./compose"),_compose2=_interopRequireDefault(_compose),_warning=require("./utils/warning"),_warning2=_interopRequireDefault(_warning);exports.createStore=_createStore2.default,exports.combineReducers=_combineReducers2.default,exports.bindActionCreators=_bindActionCreators2.default,exports.applyMiddleware=_applyMiddleware2.default,exports.compose=_compose2.default;

},{"./applyMiddleware":25,"./bindActionCreators":26,"./combineReducers":27,"./compose":28,"./createStore":29,"./utils/warning":31}],31:[function(require,module,exports){
"use strict";function warning(o){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(o);try{throw new Error(o)}catch(o){}}exports.__esModule=!0,exports.default=warning;

},{}],32:[function(require,module,exports){
module.exports=require("./lib/retry");

},{"./lib/retry":33}],33:[function(require,module,exports){
var RetryOperation=require("./retry_operation");exports.operation=function(r){var t=!1;r&&!0===r.forever&&(t=!0);var o=exports.timeouts(r);return new RetryOperation(o,t)},exports.timeouts=function(r){if(r instanceof Array)return[].concat(r);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var o in r)t[o]=r[o];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var e=[],n=0;n<t.retries;n++)e.push(this.createTimeout(n,t));return e.sort(function(r,t){return r-t}),e},exports.createTimeout=function(r,t){var o=t.randomize?Math.random()+1:1,e=Math.round(o*t.minTimeout*Math.pow(t.factor,r));return e=Math.min(e,t.maxTimeout)},exports.wrap=function(r,t,o){if(t instanceof Array&&(o=t,t=null),!o){o=[];for(var e in r)"function"==typeof r[e]&&o.push(e)}for(var n=0;n<o.length;n++){var i=o[n],a=r[i];r[i]=function(){var o=exports.operation(t),e=Array.prototype.slice.call(arguments),n=e.pop();e.push(function(r){o.retry(r)||(r&&(arguments[0]=o.mainError()),n.apply(this,arguments))}),o.attempt(function(){a.apply(r,e)})},r[i].options=t}};

},{"./retry_operation":34}],34:[function(require,module,exports){
function RetryOperation(t,e){this._timeouts=t,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,e&&(this._cachedTimeouts=this._timeouts.slice(0))}module.exports=RetryOperation,RetryOperation.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;this._errors.push(t);var e=this._timeouts.shift();if(void 0===e){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),e=this._timeouts.shift()}var i=this;return setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout)),i._fn(i._attempts)},e),!0},RetryOperation.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var i=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){i._operationTimeoutCb()},i._operationTimeout)),this._fn(this._attempts)},RetryOperation.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},RetryOperation.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,i=0,o=0;o<this._errors.length;o++){var r=this._errors[o],s=r.message,n=(t[s]||0)+1;t[s]=n,n>=i&&(e=r,i=n)}return e};

},{}],35:[function(require,module,exports){
function raf(e){if("requestAnimationFrame"in window)return window.requestAnimationFrame(e);setTimeout(e,16)}function setElementScroll(e,t,n){e.self===e?e.scrollTo(t,n):(e.scrollLeft=t,e.scrollTop=n)}function getTargetScrollLocation(e,t,n){var l,i,r,a,o,s,f,c=e.getBoundingClientRect(),u=n&&null!=n.left?n.left:.5,d=n&&null!=n.top?n.top:.5,m=n&&null!=n.leftOffset?n.leftOffset:0,g=n&&null!=n.topOffset?n.topOffset:0,h=u,p=d;if(t.self===t)s=Math.min(c.width,t.innerWidth),f=Math.min(c.height,t.innerHeight),i=c.left+t.pageXOffset-t.innerWidth*h+s*h,r=c.top+t.pageYOffset-t.innerHeight*p+f*p,i-=m,r-=g,a=i-t.pageXOffset,o=r-t.pageYOffset;else{s=c.width,f=c.height,l=t.getBoundingClientRect();var E=c.left-(l.left-t.scrollLeft),S=c.top-(l.top-t.scrollTop);i=E+s*h-t.clientWidth*h,r=S+f*p-t.clientHeight*p,i=Math.max(Math.min(i,t.scrollWidth-t.clientWidth),0),r=Math.max(Math.min(r,t.scrollHeight-t.clientHeight),0),i-=m,r-=g,a=i-t.scrollLeft,o=r-t.scrollTop}return{x:i,y:r,differenceX:a,differenceY:o}}function animate(e){var t=e._scrollSettings;if(t){var n=getTargetScrollLocation(t.target,e,t.align),l=Date.now()-t.startTime,i=Math.min(1/t.time*l,1);if(l>t.time&&t.endIterations>3)return setElementScroll(e,n.x,n.y),e._scrollSettings=null,t.end(COMPLETE);t.endIterations++;var r=1-t.ease(i);if(setElementScroll(e,n.x-n.differenceX*r,n.y-n.differenceY*r),l>=t.time)return animate(e);raf(animate.bind(null,e))}}function transitionScrollTo(e,t,n,l){function i(e){t._scrollSettings=null,t.parentElement&&t.parentElement._scrollSettings&&t.parentElement._scrollSettings.end(e),l(e),t.removeEventListener("touchstart",r,{passive:!0})}var r,a=!t._scrollSettings,o=t._scrollSettings,s=Date.now();o&&o.end(CANCELED),t._scrollSettings={startTime:o?o.startTime:Date.now(),endIterations:0,target:e,time:n.time+(o?s-o.startTime:0),ease:n.ease,align:n.align,end:i},r=i.bind(null,CANCELED),t.addEventListener("touchstart",r,{passive:!0}),a&&animate(t)}function defaultIsScrollable(e){return"pageXOffset"in e||(e.scrollHeight!==e.clientHeight||e.scrollWidth!==e.clientWidth)&&"hidden"!==getComputedStyle(e).overflow}function defaultValidTarget(){return!0}var COMPLETE="complete",CANCELED="canceled";module.exports=function(e,t,n){function l(e){--r||n&&n(e)}if(e){"function"==typeof t&&(n=t,t=null),t||(t={}),t.time=isNaN(t.time)?1e3:t.time,t.ease=t.ease||function(e){return 1-Math.pow(1-e,e/2)};for(var i=e.parentElement,r=0,a=t.validTarget||defaultValidTarget,o=t.isScrollable;i;){if(a(i,r)&&(o?o(i,defaultIsScrollable):defaultIsScrollable(i))&&(r++,transitionScrollTo(e,i,t,l)),!(i=i.parentElement))return;"BODY"===i.tagName&&(i=i.ownerDocument,i=i.defaultView||i.ownerWindow)}}};

},{}],36:[function(require,module,exports){
(function (process,global){
!function(){"use strict";function t(t,e,r){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:r})}function e(e,r){t(e,r,function(){throw new a("The "+r+" method cannot be invoked on an Immutable data structure.")})}function r(e){t(e,x,!0)}function n(t){return"object"!=typeof t||(null===t||Boolean(Object.getOwnPropertyDescriptor(t,x)))}function i(t,e){return t===e||t!==t&&e!==e}function o(t){return!(null===t||"object"!=typeof t||Array.isArray(t)||t instanceof Date)}function a(t){var e=new Error(t);return e.__proto__=a,e}function s(t,n){if(r(t),"production"!==process.env.NODE_ENV){for(var i in n)n.hasOwnProperty(i)&&e(t,n[i]);Object.freeze(t)}return t}function c(e,r){var n=e[r];t(e,r,function(){return S(n.apply(e,arguments))})}function u(t,e,r){var n=r&&r.deep;if(t in this&&(n&&this[t]!==e&&o(e)&&o(this[t])&&(e=this[t].merge(e,{deep:!0,mode:"replace"})),i(this[t],e)))return this;var a=m.call(this);return a[t]=S(e),l(a)}function f(t,e,r){var n=t[0];if(1===t.length)return u.call(this,n,e,r);var i,o=t.slice(1),a=this[n];if("object"==typeof a&&null!==a&&"function"==typeof a.setIn)i=a.setIn(o,e);else{var s=o[0];i=""!==s&&isFinite(s)?f.call(J,o,e):g.call(R,o,e)}if(n in this&&a===i)return this;var c=m.call(this);return c[n]=i,l(c)}function l(e){for(var r in Y)if(Y.hasOwnProperty(r)){var n=Y[r];c(e,n)}t(e,"flatMap",y),t(e,"asObject",v),t(e,"asMutable",m),t(e,"set",u),t(e,"setIn",f),t(e,"update",I),t(e,"updateIn",A);for(var i=0,o=e.length;i<o;i++)e[i]=S(e[i]);return s(e,H)}function p(e){return t(e,"asMutable",h),s(e,z)}function h(){return new Date(this.getTime())}function y(t){if(0===arguments.length)return this;var e,r=[],n=this.length;for(e=0;e<n;e++){var i=t(this[e],e,this);Array.isArray(i)?r.push.apply(r,i):r.push(i)}return l(r)}function b(t){if(void 0===t&&0===arguments.length)return this;if("function"!=typeof t){var e=Array.isArray(t)?t.slice():Array.prototype.slice.call(arguments);e.forEach(function(t,e,r){"number"==typeof t&&(r[e]=t.toString())}),t=function(t,r){return-1!==e.indexOf(r)}}var r=this.instantiateEmptyObject();for(var n in this)this.hasOwnProperty(n)&&!1===t(this[n],n)&&(r[n]=this[n]);return T(r,{instantiateEmptyObject:this.instantiateEmptyObject})}function m(t){var e,r,n=[];if(t&&t.deep)for(e=0,r=this.length;e<r;e++)n.push(d(this[e]));else for(e=0,r=this.length;e<r;e++)n.push(this[e]);return n}function v(t){"function"!=typeof t&&(t=function(t){return t});var e,r={},n=this.length;for(e=0;e<n;e++){var i=t(this[e],e,this),o=i[0],a=i[1];r[o]=a}return T(r)}function d(t){return!t||"object"!=typeof t||!Object.getOwnPropertyDescriptor(t,x)||t instanceof Date?t:t.asMutable({deep:!0})}function O(t,e){for(var r in t)Object.getOwnPropertyDescriptor(t,r)&&(e[r]=t[r]);return e}function j(t,e){function r(t,r,a){var s=S(r[a]),u=f&&f(t[a],s,e),l=t[a];if(void 0!==n||void 0!==u||!t.hasOwnProperty(a)||!i(s,l)){var p;p=u||(c&&o(l)&&o(s)?l.merge(s,e):s),i(l,p)&&t.hasOwnProperty(a)||(void 0===n&&(n=O(t,t.instantiateEmptyObject())),n[a]=p)}}if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(t));var n,a,s=Array.isArray(t),c=e&&e.deep,u=e&&e.mode||"merge",f=e&&e.merger;if(s)for(var l=0,p=t.length;l<p;l++){var h=t[l];for(a in h)h.hasOwnProperty(a)&&r(void 0!==n?n:this,h,a)}else{for(a in t)Object.getOwnPropertyDescriptor(t,a)&&r(this,t,a);"replace"===u&&function(t,e){for(var r in t)e.hasOwnProperty(r)||(void 0===n&&(n=O(t,t.instantiateEmptyObject())),delete n[r])}(this,t)}return void 0===n?this:T(n,{instantiateEmptyObject:this.instantiateEmptyObject})}function w(t,e){var r=e&&e.deep;if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(t));return this.merge(t,{deep:r,mode:"replace"})}function g(t,e,r){var n=t[0];if(1===t.length)return E.call(this,n,e,r);var i,o=t.slice(1),a=this[n];if(i=this.hasOwnProperty(n)&&"object"==typeof a&&null!==a&&"function"==typeof a.setIn?a.setIn(o,e):g.call(R,o,e),this.hasOwnProperty(n)&&a===i)return this;var s=O(this,this.instantiateEmptyObject());return s[n]=i,T(s,this)}function E(t,e,r){var n=r&&r.deep;if(this.hasOwnProperty(t)&&(n&&this[t]!==e&&o(e)&&o(this[t])&&(e=this[t].merge(e,{deep:!0,mode:"replace"})),i(this[t],e)))return this;var a=O(this,this.instantiateEmptyObject());return a[t]=S(e),T(a,this)}function I(t,e){var r=Array.prototype.slice.call(arguments,2),n=this[t];return this.set(t,e.apply(n,[n].concat(r)))}function P(t,e){for(var r=0,n=e.length;null!=t&&r<n;r++)t=t[e[r]];return r&&r==n?t:void 0}function A(t,e){var r=Array.prototype.slice.call(arguments,2),n=P(this,t);return this.setIn(t,e.apply(n,[n].concat(r)))}function D(t){var e,r=this.instantiateEmptyObject();if(t&&t.deep)for(e in this)this.hasOwnProperty(e)&&(r[e]=d(this[e]));else for(e in this)this.hasOwnProperty(e)&&(r[e]=this[e]);return r}function M(){return{}}function T(e,r){var n=r&&r.instantiateEmptyObject?r.instantiateEmptyObject:M;return t(e,"merge",j),t(e,"replace",w),t(e,"without",b),t(e,"asMutable",D),t(e,"instantiateEmptyObject",n),t(e,"set",E),t(e,"setIn",g),t(e,"update",I),t(e,"updateIn",A),s(e,$)}function _(t){return"object"==typeof t&&null!==t&&(t.$$typeof===k||t.$$typeof===N)}function S(t,e,r){if(n(t)||_(t))return t;if(Array.isArray(t))return l(t.slice());if(t instanceof Date)return p(new Date(t.getTime()));var i=e&&e.prototype,o=i&&i!==Object.prototype?function(){return Object.create(i)}:M,s=o();if("production"!==process.env.NODE_ENV){if(null==r&&(r=64),r<=0)throw new a("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");r-=1}for(var c in t)Object.getOwnPropertyDescriptor(t,c)&&(s[c]=S(t[c],void 0,r));return T(s,{instantiateEmptyObject:o})}function C(t){function e(){var e=[].slice.call(arguments),r=e.shift();return t.apply(r,e)}return e}function U(t,e){function r(){var r=[].slice.call(arguments),n=r.shift();return Array.isArray(n)?e.apply(n,r):t.apply(n,r)}return r}var N="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),k=60103,x="__immutable_invariants_hold",$=["setPrototypeOf"],F=["keys"],H=$.concat(["push","pop","sort","splice","shift","unshift","reverse"]),Y=F.concat(["map","filter","slice","concat","reduce","reduceRight"]),z=$.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);a.prototype=Error.prototype;var J=S([]),R=S({});S.from=S,S.isImmutable=n,S.ImmutableError=a,S.merge=C(j),S.replace=C(w),S.without=C(b),S.asMutable=U(D,m),S.set=U(E,u),S.setIn=U(g,f),S.update=C(I),S.updateIn=C(A),S.flatMap=C(y),S.asObject=C(v),Object.freeze(S),"object"==typeof module?module.exports=S:"object"==typeof exports?exports.Immutable=S:"object"==typeof window?window.Immutable=S:"object"==typeof global&&(global.Immutable=S)}();

}).call(this,require('_process'),window)

},{"_process":19}],37:[function(require,module,exports){
"use strict";module.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})};

},{}],38:[function(require,module,exports){
(function (global){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _ponyfill=require("./ponyfill.js"),_ponyfill2=_interopRequireDefault(_ponyfill),root;root="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")();var result=(0,_ponyfill2.default)(root);exports.default=result;

}).call(this,window)

},{"./ponyfill.js":39}],39:[function(require,module,exports){
"use strict";function symbolObservablePonyfill(e){var b,l=e.Symbol;return"function"==typeof l?l.observable?b=l.observable:(b=l("observable"),l.observable=b):b="@@observable",b}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=symbolObservablePonyfill;

},{}],40:[function(require,module,exports){
function E(){}E.prototype={on:function(t,n,e){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:n,ctx:e}),this},once:function(t,n,e){function i(){f.off(t,i),n.apply(e,arguments)}var f=this;return i._=n,this.on(t,i,e)},emit:function(t){var n=[].slice.call(arguments,1),e=((this.e||(this.e={}))[t]||[]).slice(),i=0,f=e.length;for(i;i<f;i++)e[i].fn.apply(e[i].ctx,n);return this},off:function(t,n){var e=this.e||(this.e={}),i=e[t],f=[];if(i&&n)for(var o=0,r=i.length;o<r;o++)i[o].fn!==n&&i[o].fn._!==n&&f.push(i[o]);return f.length?e[t]=f:delete e[t],this}},module.exports=E;

},{}],41:[function(require,module,exports){
module.exports='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="10px" height="30px" viewBox="0 0 10 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --\x3e\n    <title>Shape</title>\n    <desc>Created with Sketch.</desc>\n    <defs></defs>\n    <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Start-annotating---eLife" transform="translate(-239.000000, -73.000000)" fill-rule="nonzero" fill="#000000">\n            <g id="Group-10" transform="translate(1.000000, 1.000000)">\n                <path d="M243.3125,75.186875 C243.3125,73.535 243.3125,72.625 246.434687,72.625 L248,72.625 L248,72 L246.434687,72 C244.324375,72 243.402813,72.4684375 243,73.183125 C242.597187,72.4684375 241.675625,72 239.565313,72 L238,72 L238,72.625 L239.565313,72.625 C242.6875,72.6246875 242.6875,73.5346875 242.6875,75.186875 L242.6875,82 L242.6875,86.6875 L240.929375,86.6875 L240.929375,87.3125 L242.6875,87.3125 L242.6875,92 L242.6875,98.5434375 C242.6875,100.187188 242.6875,101.375 239.565313,101.375 L238,101.375 L238,102 L239.565313,102 C241.675625,102 242.5975,101.442813 243,100.6525 C243.402813,101.442813 244.324375,102 246.434687,102 L248,102 L248,101.375 L246.434687,101.375 C243.3125,101.374688 243.3125,100.187188 243.3125,98.5434375 L243.3125,91.9996875 L243.3125,87.3121875 L245.070312,87.3121875 L245.070312,86.6871875 L243.3125,86.6871875 L243.3125,81.9996875 L243.3125,75.186875 Z" id="Shape"></path>\n            </g>\n        </g>\n    </g>\n</svg>';

},{}],42:[function(require,module,exports){
module.exports='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 39.1 (31720) - http://www.bohemiancoding.com/sketch --\x3e\n    <defs/>\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Artboard" fill="#D00032">\n            <g id="Group">\n                <path d="M0,8 C0,12.418278 3.581722,16 8,16 C12.418278,16 16,12.418278 16,8 C16,4.89580324 14.2154684,2.11256098 11.4682644,0.789110134 L10.6002482,2.59092808 C12.661769,3.58405472 14,5.6712248 14,8 C14,11.3137085 11.3137085,14 8,14 C4.6862915,14 2,11.3137085 2,8 C2,5.65296151 3.35941993,3.55225774 5.44569583,2.56903563 L4.59307587,0.759881355 C1.81273067,2.07020511 0,4.87140735 0,8 Z" id="Oval"/>\n                <polygon id="Combined-Shape" points="7 8.58578644 7 0 9 0 9 8.58578644 10.2928932 7.29289322 11 6.58578644 12.4142136 8 11.7071068 8.70710678 8.70710678 11.7071068 8 12.4142136 7.64644661 12.0606602 7.29289322 11.7071068 4.29289322 8.70710678 3.58578644 8 5 6.58578644 5.70710678 7.29289322"/>\n            </g>\n        </g>\n    </g>\n</svg>\n';

},{}],43:[function(require,module,exports){
"use strict";module.exports={FEATURE_FLAGS_UPDATED:"featureFlagsUpdated",HELP_REQUESTED:"helpRequested",LOGIN_REQUESTED:"loginRequested",LOGOUT_REQUESTED:"logoutRequested",PROFILE_REQUESTED:"profileRequested",PUBLIC_ANNOTATION_COUNT_CHANGED:"publicAnnotationCountChanged",SIGNUP_REQUESTED:"signupRequested"};

},{}],44:[function(require,module,exports){
"use strict";function _toConsumableArray(n){if(Array.isArray(n)){for(var e=0,r=Array(n.length);e<n.length;e++)r[e]=n[e];return r}return Array.from(n)}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}return function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}}(),extend=require("extend"),RPC=require("./frame-rpc"),Bridge=function(){function n(){_classCallCheck(this,n),this.links=[],this.channelListeners={},this.onConnectListeners=[]}return _createClass(n,[{key:"destroy",value:function(){Array.from(this.links).map(function(n){return n.channel.destroy()})}},{key:"createChannel",value:function(n,e,r){var t=this,i=null,a=!1,o=function(){a||(a=!0,Array.from(t.onConnectListeners).forEach(function(e){return e.call(null,i,n)}))},c=function(n,e){n===r&&(e(),o())},u=extend({connect:c},this.channelListeners);return i=new RPC(window,n,e,u),i.call("connect",r,o),this.links.push({channel:i,window:n}),i}},{key:"call",value:function(n){for(var e=this,r=arguments.length,t=Array(r>1?r-1:0),i=1;i<r;i++)t[i-1]=arguments[i];var a;"function"==typeof t[t.length-1]&&(a=t[t.length-1],t=t.slice(0,-1));var o=function(n){return function(r){throw n.destroy(),e.links=Array.from(e.links).filter(function(e){return e.channel!==n}).map(function(n){return n}),r}},c=this.links.map(function(e){return new Promise(function(r,i){var a=setTimeout(function(){return r(null)},1e3);try{var o;return(o=e.channel).call.apply(o,[n].concat(_toConsumableArray(Array.from(t)),[function(n,e){return clearTimeout(a),n?i(n):r(e)}]))}catch(n){var c=n;return i(c)}}).catch(o(e.channel))}),u=Promise.all(c);return a&&(u=u.then(function(n){return a(null,n)}).catch(function(n){return a(n)})),u}},{key:"on",value:function(n,e){if(this.channelListeners[n])throw new Error("Listener '"+n+"' already bound in Bridge");return this.channelListeners[n]=e,this}},{key:"off",value:function(n){return delete this.channelListeners[n],this}},{key:"onConnect",value:function(n){return this.onConnectListeners.push(n),this}}]),n}();module.exports=Bridge;

},{"./frame-rpc":46,"extend":4}],45:[function(require,module,exports){
var Discovery,bind=function(e,s){return function(){return e.apply(s,arguments)}};module.exports=Discovery=function(){function e(e,s){this.target=e,null==s&&(s={}),this._onMessage=bind(this._onMessage,this),this.stopDiscovery=bind(this.stopDiscovery,this),s.server&&(this.server=s.server),s.origin&&(this.origin=s.origin)}return e.prototype.server=!1,e.prototype.origin="*",e.prototype.onDiscovery=null,e.prototype.requestInProgress=!1,e.prototype.startDiscovery=function(e){if(this.onDiscovery)throw new Error("Discovery is already in progress, call .stopDiscovery() first");this.onDiscovery=e,this.target.addEventListener("message",this._onMessage,!1),this._beacon()},e.prototype.stopDiscovery=function(){this.onDiscovery=null,this.target.removeEventListener("message",this._onMessage)},e.prototype._beacon=function(){var e,s,r,o,t,i,n;for(e=this.server?"__cross_frame_dhcp_offer":"__cross_frame_dhcp_discovery",i=[this.target.top];i.length;)for(t=i.shift(),t!==this.target&&t.postMessage(e,this.origin),n=t.frames,r=0,o=n.length;r<o;r++)s=n[r],i.push(s)},e.prototype._onMessage=function(e){var s,r,o,t,i,n,c,a,p;a=e.source,i=e.origin,s=e.data,("null"===i||i.match("moz-extension:")||"moz-extension:"===window.location.protocol)&&(i="*"),(o="function"==typeof s.match?s.match(/^__cross_frame_dhcp_(discovery|offer|request|ack)(?::(\d+))?$/):void 0)&&(t=o[1],p=o[2],n=this._processMessage(t,p,i),c=n.reply,r=n.discovered,p=n.token,c&&a.postMessage("__cross_frame_dhcp_"+c,i),r&&this.onDiscovery.call(null,a,i,p))},e.prototype._processMessage=function(e,s,r){var o,t;if(t=null,o=!1,this.server){if("discovery"===e)t="offer";else if("request"===e)s=this._generateToken(),t="ack:"+s,o=!0;else if("offer"===e||"ack"===e)throw new Error("A second Discovery server has been detected at "+r+".\nThis is unsupported and will cause unexpected behaviour.")}else"offer"===e?this.requestInProgress||(this.requestInProgress=!0,t="request"):"ack"===e&&(this.requestInProgress=!1,o=!0);return{reply:t,discovered:o,token:s}},e.prototype._generateToken=function(){return(""+Math.random()).replace(/\D/g,"")},e}();

},{}],46:[function(require,module,exports){
"use strict";function RPC(t,e,s,o){if(!(this instanceof RPC))return new RPC(t,e,s,o);var r=this;if(this.src=t,this.dst=e,"*"===s)this.origin="*";else{var n=new URL(s);this.origin=n.protocol+"//"+n.host}this._sequence=0,this._callbacks={},this._onmessage=function(t){r._destroyed||r.dst===t.source&&("*"!==r.origin&&t.origin!==r.origin||t.data&&"object"===_typeof(t.data)&&"frame-rpc"===t.data.protocol&&Array.isArray(t.data.arguments)&&r._handle(t.data))},this.src.addEventListener("message",this._onmessage),this._methods=("function"==typeof o?o(this):o)||{}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},VERSION="1.0.0";module.exports=RPC,RPC.prototype.destroy=function(){this._destroyed=!0,this.src.removeEventListener("message",this._onmessage)},RPC.prototype.call=function(t){var e=[].slice.call(arguments,1);return this.apply(t,e)},RPC.prototype.apply=function(t,e){if(!this._destroyed){var s=this._sequence++;"function"==typeof e[e.length-1]&&(this._callbacks[s]=e[e.length-1],e=e.slice(0,-1)),this.dst.postMessage({protocol:"frame-rpc",version:VERSION,sequence:s,method:t,arguments:e},this.origin)}},RPC.prototype._handle=function(t){var e=this;if(!e._destroyed)if(t.hasOwnProperty("method")){if(!this._methods.hasOwnProperty(t.method))return;var s=t.arguments.concat(function(){e.dst.postMessage({protocol:"frame-rpc",version:VERSION,response:t.sequence,arguments:[].slice.call(arguments)},e.origin)});this._methods[t.method].apply(this._methods,s)}else if(t.hasOwnProperty("response")){var o=this._callbacks[t.response];delete this._callbacks[t.response],o&&o.apply(null,t.arguments)}};

},{}],47:[function(require,module,exports){
"use strict";function assign(o,s){for(var n in s)s.hasOwnProperty(n)&&(o[n]=s[n]);return o}function jsonConfigsFrom(o){for(var s={},n=o.querySelectorAll("script.js-hypothesis-config"),r=0;r<n.length;r++){var t;try{t=JSON.parse(n[r].textContent)}catch(o){console.warn("Could not parse settings from js-hypothesis-config tags",o),t={}}assign(s,t)}return s}module.exports={jsonConfigsFrom:jsonConfigsFrom};

},{}],48:[function(require,module,exports){
module.exports={
    "This feedback is visible only to you.": "This feedback is visible only to you.",
    "Only me": "Only me",
    "This is a highlight. Click \\": "This is a highlight. Click \\",
    "Share": "Share",
    "Tweet link": "Tweet link",
    "Share on Facebook": "Share on Facebook",
    "Post on Google Plus": "Post on Google Plus",
    "Share via email": "Share via email",
    "Group.": "Group.",
    "Only group members will be able to view this annotation.": "Only group members will be able to view this annotation.",
    "Only me.": "Only me.",
    "No one else will be able to view this annotation.": "No one else will be able to view this annotation.",
    "Expand": "Expand",
    "Message not available.": "Message not available.",
    "You must be logged in to leave feedback.": "You must be logged in to leave feedback.",
    "View more information about the Creative Commons Public Domain dedication": "View more information about the Creative Commons Public Domain dedication",
    "Feedback can be freely reused by anyone for any purpose.": "Feedback can be freely reused by anyone for any purpose.",
    "Show replies": "Show replies",
    "Saving...": "Saving...",
    "Edit": "Edit",
    "Delete": "Delete",
    "Show the full excerpt": "Show the full excerpt",
    "More": "More",
    "Show the first few lines only": "Show the first few lines only",
    "Less": "Less",
    "Change the selected group": "Change the selected group",
    "Show public annotations": "Show public annotations",
    "View group activity and invite others": "View group activity and invite others",
    "Create a new group to share annotations": "Create a new group to share annotations",
    "New group": "New group",
    "Send us an email": "Send us an email",
    "Close": "Close",
    "Help": "Help",
    "About this version": "About this version",
    "Version": "Version",
    "User agent": "User agent",
    "URL": "URL",
    "PDF fingerprint": "PDF fingerprint",
    "Username": "Username",
    "Date": "Date",
    "Change the language": "Change the language",
    "Select the language": "Select the language",
    "This is a public annotation created with Hypothesis.": "This is a public annotation created with Hypothesis.",
    "Sign up": "Sign up",
    "Log in": "Log in",
    "View all your annotations": "View all your annotations",
    "account.settings": "account.settings",
    "Log out": "Log out",
    "My Annotations": "My Annotations",
    "Parsed as Markdown": "Parsed as Markdown",
    "Preview": "Preview",
    "Write": "Write",
    "Embolden text": "Embolden text",
    "Italicize text": "Italicize text",
    "Quote text": "Quote text",
    "Insert link": "Insert link",
    "Insert image": "Insert image",
    "Insert mathematical notation (LaTex is supported)": "Insert mathematical notation (LaTex is supported)",
    "Insert numbered list": "Insert numbered list",
    "Insert list": "Insert list",
    "Hidden from users.": "Hidden from users.",
    "Hide this feedback from non-moderators": "Hide this feedback from non-moderators",
    "Hide": "Hide",
    "Make this feedback visible to everyone": "Make this feedback visible to everyone",
    "Unhide": "Unhide",
    "New note": "New note",
    "Publish this feedback to": "Publish this feedback to",
    "Change annotation sharing setting": "Change annotation sharing setting",
    "Cancel changes to this feedback": "Cancel changes to this feedback",
    "Cancel": "Cancel",
    "Loading": "Loading",
    "Clear the search filter and show all feedback": "Clear the search filter and show all feedback",
    "Clear search": "Clear search",
    "Show all feedback and notes": "Show all feedback and notes",
    "Show all feedback": "Show all feedback",
    "Show all notes": "Show all notes",
    "Feedback": "Feedback",
    "Page Notes": "Page Notes",
    "Orphans": "Orphans",
    "There are no page notes in this group.": "There are no page notes in this group.",
    "There is no feedback in this group.": "There is no feedback in this group.",
    "Share the link below to show anyone these annotations and invite them to contribute their own.": "Share the link below to show anyone these annotations and invite them to contribute their own.",
    "This feedback is not available.": "This feedback is not available.",
    "You do not have permission to view this feedback.": "You do not have permission to view this feedback.",
    "How to get started": "How to get started",
    "Start annotating": "Start annotating",
    "Create page level notes": "Create page level notes",
    "View feedback through your profile": "View feedback through your profile",
    "Sort by": "Sort by",
    "Filter the feedback list": "Filter the feedback list",
    "Share this page": "Share this page",
    "Show one annotation": "Show one annotation"
}
},{}],49:[function(require,module,exports){
module.exports={
    "Feedback": "注釈タリングする",
    "Filter the feedback list": "アノテーションリストをフィルタリングする",
    "This feedback is visible only to you.": "このフィードバックはあなたにしか見えません。",
    "Change the selected group": "選択したグループを変更する",
    "Change the language": "言語を変更する",
    "Only me": "Only me",
    "This is a highlight. Click \\": "This is a highlight. Click \\",
    "Share": "Share",
    "Tweet link": "Tweet link",
    "Share on Facebook": "Share on Facebook",
    "Post on Google Plus": "Post on Google Plus",
    "Share via email": "Share via email",
    "Group.": "Group.",
    "Only group members will be able to view this annotation.": "Only group members will be able to view this annotation.",
    "Only me.": "Only me.",
    "No one else will be able to view this annotation.": "No one else will be able to view this annotation.",
    "Expand": "Expand",
    "Message not available.": "Message not available.",
    "You must be logged in to leave feedback.": "You must be logged in to leave feedback.",
    "View more information about the Creative Commons Public Domain dedication": "View more information about the Creative Commons Public Domain dedication",
    "Feedback can be freely reused by anyone for any purpose.": "Feedback can be freely reused by anyone for any purpose.",
    "Show replies": "Show replies",
    "Saving...": "Saving...",
    "Edit": "編集します",
    "Delete": "削除",
    "Show the full excerpt": "Show the full excerpt",
    "More": "More",
    "Show the first few lines only": "Show the first few lines only",
    "Less": "Less",
    "Show public annotations": "Show public annotations",
    "View group activity and invite others": "View group activity and invite others",
    "Create a new group to share annotations": "Create a new group to share annotations",
    "New group": "New group",
    "Send us an email": "Send us an email",
    "Close": "Close",
    "Help": "Help",
    "About this version": "About this version",
    "Version": "Version",
    "User agent": "User agent",
    "URL": "URL",
    "PDF fingerprint": "PDF fingerprint",
    "Username": "Username",
    "Date": "Date",
    "Select the language": "Select the language",
    "This is a public annotation created with Hypothesis.": "This is a public annotation created with Hypothesis.",
    "Sign up": "Sign up",
    "Log in": "Log in",
    "View all your annotations": "View all your annotations",
    "account.settings": "account.settings",
    "Log out": "Log out",
    "My Annotations": "My Annotations",
    "Parsed as Markdown": "Parsed as Markdown",
    "Preview": "Preview",
    "Write": "Write",
    "Embolden text": "Embolden text",
    "Italicize text": "Italicize text",
    "Quote text": "Quote text",
    "Insert link": "Insert link",
    "Insert image": "Insert image",
    "Insert mathematical notation (LaTex is supported)": "Insert mathematical notation (LaTex is supported)",
    "Insert numbered list": "Insert numbered list",
    "Insert list": "Insert list",
    "Hidden from users.": "Hidden from users.",
    "Hide this feedback from non-moderators": "Hide this feedback from non-moderators",
    "Hide": "Hide",
    "Make this feedback visible to everyone": "Make this feedback visible to everyone",
    "Unhide": "Unhide",
    "New note": "New note",
    "Publish this feedback to": "Publish this feedback to",
    "Change annotation sharing setting": "Change annotation sharing setting",
    "Cancel changes to this feedback": "Cancel changes to this feedback",
    "Cancel": "Cancel",
    "Loading": "Loading",
    "Clear the search filter and show all feedback": "Clear the search filter and show all feedback",
    "Clear search": "Clear search",
    "Show all feedback and notes": "Show all feedback and notes",
    "Show all feedback": "Show all feedback",
    "Show all notes": "Show all notes",
    "Page Notes": "Page Notes",
    "Orphans": "Orphans",
    "There are no page notes in this group.": "There are no page notes in this group.",
    "There is no feedback in this group.": "There is no feedback in this group.",
    "Share the link below to show anyone these annotations and invite them to contribute their own.": "Share the link below to show anyone these annotations and invite them to contribute their own.",
    "This feedback is not available.": "This feedback is not available.",
    "You do not have permission to view this feedback.": "You do not have permission to view this feedback.",
    "How to get started": "How to get started",
    "Start annotating": "Start annotating",
    "Create page level notes": "Create page level notes",
    "View feedback through your profile": "View feedback through your profile",
    "Sort by": "Sort by",
    "Share this page": "Share this page",
    "Show one annotation": "1つの注釈を表示する",
    "Show feedback": "%{bucketLength} つのフィードバックを表示",
    "Toggle or Resize Sidebar":"サイドバーの表示/非表示"
}
},{}],50:[function(require,module,exports){
"use strict";function analytics(e,t,a){var o=t?globalGAOptions(t,a):{};return{track:function(t,a,E){e.eventTrack(t,Object.assign({},{label:a||void 0,metricValue:isNaN(E)?void 0:E},o))},events:{ANNOTATION_CREATED:"annotationCreated",ANNOTATION_DELETED:"annotationDeleted",ANNOTATION_FLAGGED:"annotationFlagged",ANNOTATION_SHARED:"annotationShared",ANNOTATION_UPDATED:"annotationUpdated",DOCUMENT_SHARED:"documentShared",GROUP_LEAVE:"groupLeave",GROUP_SWITCH:"groupSwitch",GROUP_VIEW_ACTIVITY:"groupViewActivity",HIGHLIGHT_CREATED:"highlightCreated",HIGHLIGHT_UPDATED:"highlightUpdated",HIGHLIGHT_DELETED:"highlightDeleted",LOGIN_FAILURE:"loginFailure",LOGIN_SUCCESS:"loginSuccessful",LOGOUT_FAILURE:"logoutFailure",LOGOUT_SUCCESS:"logoutSuccessful",PAGE_NOTE_CREATED:"pageNoteCreated",PAGE_NOTE_UPDATED:"pageNoteUpdated",PAGE_NOTE_DELETED:"pageNoteDeleted",REPLY_CREATED:"replyCreated",REPLY_UPDATED:"replyUpdated",REPLY_DELETED:"replyDeleted",SIDEBAR_OPENED:"sidebarOpened",SIGN_UP_REQUESTED:"signUpRequested"}}}analytics.$inject=["$analytics","$window","settings"];var VIA_REFERRER=/^https:\/\/(qa-)?via.hypothes.is\//,globalGAOptions=function(e,t){t=t||{};var a={category:""};return["chrome-extension","firefox-extension","embed","bookmarklet","via"].indexOf((t.appType||"").toLowerCase())>-1?a.category=t.appType.toLowerCase():"chrome-extension:"===e.location.protocol?a.category="chrome-extension":VIA_REFERRER.test(e.document.referrer)?a.category="via":a.category="embed",a};module.exports=analytics;

},{}],51:[function(require,module,exports){
"use strict";function getExistingAnnotation(n,t){return n.getState().annotations.find(function(n){return n.id===t})}function annotationMapper(n,t,o){function a(o,a){o=o.concat(a||[]);var e=[];o.forEach(function(o){if(getExistingAnnotation(t,o.id))return void n.$broadcast(events.ANNOTATION_UPDATED,o);e.push(o)}),n.$broadcast(events.ANNOTATIONS_LOADED,e)}function e(o){var a=o.map(function(n){var o=getExistingAnnotation(t,n.id);return o&&n!==o&&(n=angular.copy(n,o)),n});n.$broadcast(events.ANNOTATIONS_UNLOADED,a)}function i(t){return n.$broadcast(events.BEFORE_ANNOTATION_CREATED,t),t}function r(t){return o.annotation.delete({id:t.id}).then(function(){return n.$broadcast(events.ANNOTATION_DELETED,t),t})}function u(t){return o.annotation.flag({id:t.id}).then(function(){return n.$broadcast(events.ANNOTATION_FLAGGED,t),t})}return{loadAnnotations:a,unloadAnnotations:e,createAnnotation:i,deleteAnnotation:r,flagAnnotation:u}}annotationMapper.$inject=["$rootScope","annotationUI","store"];var angular=require("angular"),events=require("./events");module.exports=annotationMapper;

},{"./events":96,"angular":"angular"}],52:[function(require,module,exports){
"use strict";function documentMetadata(t){var n=t.uri,i=new URL(n).hostname,e=i;return t.document&&t.document.title&&(e=t.document.title[0]),"localhost"===i&&(i=""),{uri:n,domain:i,title:e}}function domainAndTitle(t){return{domain:domainTextFromAnnotation(t),titleText:titleTextFromAnnotation(t),titleLink:titleLinkFromAnnotation(t)}}function titleLinkFromAnnotation(t){var n=t.uri;return n&&0!==n.indexOf("http://")&&0!==n.indexOf("https://")&&(n=null),t.links&&t.links.incontext&&(n=t.links.incontext),n}function domainTextFromAnnotation(t){var n=documentMetadata(t),i="";if(n.uri&&0===n.uri.indexOf("file://")&&n.title){var e=n.uri.split("/"),o=e[e.length-1];o&&(i=o)}else n.domain&&n.domain!==n.title&&(i=n.domain);return i}function titleTextFromAnnotation(t){var n=documentMetadata(t),i=n.title;return i.length>30&&(i=i.slice(0,30)+"…"),i}function isReply(t){return(t.references||[]).length>0}function isNew(t){return!t.id}function isPublic(t){var n=!1;return t.permissions?(t.permissions.read.forEach(function(t){var i=t.split(":");2===i.length&&"group"===i[0]&&(n=!0)}),n):n}function hasSelector(t){return!!(t.target&&t.target.length>0&&t.target[0].selector)}function isWaitingToAnchor(t){return hasSelector(t)&&void 0===t.$orphan&&!t.$anchorTimeout}function isOrphan(t){return hasSelector(t)&&t.$orphan}function isPageNote(t){return!hasSelector(t)&&!isReply(t)}function isAnnotation(t){return!(!hasSelector(t)||isOrphan(t))}function location(t){if(t)for(var n=t.target||[],i=0;i<n.length;i++)for(var e=n[i].selector||[],o=0;o<e.length;o++)if("TextPositionSelector"===e[o].type)return e[o].start;return Number.POSITIVE_INFINITY}function flagCount(t){return t.moderation?t.moderation.flagCount:null}module.exports={documentMetadata:documentMetadata,domainAndTitle:domainAndTitle,flagCount:flagCount,isAnnotation:isAnnotation,isNew:isNew,isOrphan:isOrphan,isPageNote:isPageNote,isPublic:isPublic,isReply:isReply,isWaitingToAnchor:isWaitingToAnchor,location:location};

},{}],53:[function(require,module,exports){
"use strict";function angularDigestMiddleware(e){return function(r){return function(n){r(n),e.$$phase||e.$applyAsync(function(){})}}}var redux=require("redux"),thunk=require("redux-thunk").default,reducers=require("./reducers"),annotationsReducer=require("./reducers/annotations"),framesReducer=require("./reducers/frames"),linksReducer=require("./reducers/links"),selectionReducer=require("./reducers/selection"),sessionReducer=require("./reducers/session"),viewerReducer=require("./reducers/viewer"),util=require("./reducers/util"),debugMiddleware=require("./reducers/debug-middleware");module.exports=function(e,r){var n=redux.applyMiddleware(thunk,debugMiddleware,angularDigestMiddleware.bind(null,e)),s=redux.createStore(reducers.update,reducers.init(r),n),i=redux.bindActionCreators(Object.assign({},annotationsReducer.actions,framesReducer.actions,linksReducer.actions,selectionReducer.actions,sessionReducer.actions,viewerReducer.actions),s.dispatch),t=util.bindSelectors({isAnnotationSelected:selectionReducer.isAnnotationSelected,hasSelectedAnnotations:selectionReducer.hasSelectedAnnotations,annotationExists:annotationsReducer.annotationExists,findAnnotationByID:annotationsReducer.findAnnotationByID,findIDsForTags:annotationsReducer.findIDsForTags,savedAnnotations:annotationsReducer.savedAnnotations,frames:framesReducer.frames,searchUris:framesReducer.searchUris,isSidebar:viewerReducer.isSidebar,isFeatureEnabled:sessionReducer.isFeatureEnabled,profile:sessionReducer.profile},s.getState);return Object.assign(s,i,t)},module.exports.$inject=["$rootScope","settings"];

},{"./reducers":117,"./reducers/annotations":114,"./reducers/debug-middleware":115,"./reducers/frames":116,"./reducers/links":118,"./reducers/selection":119,"./reducers/session":120,"./reducers/util":121,"./reducers/viewer":122,"redux":30,"redux-thunk":24}],54:[function(require,module,exports){
"use strict";function apiRoutes(r,t){function e(t){return r.get(t).then(function(r){var e=r.status,n=r.data;if(200!==e)throw new Error("Fetching "+t+" failed");return n})}function n(){return u||(u=retryPromiseOperation(function(){return e(t.apiUrl)}).then(function(r){return r.links})),u}function i(){return o||(o=n().then(function(r){return e(r.links.url)})),o}var u,o;return{routes:n,links:i}}apiRoutes.$inject=["$http","settings"];var _require=require("./retry-util"),retryPromiseOperation=_require.retryPromiseOperation;module.exports=apiRoutes;

},{"./retry-util":124}],55:[function(require,module,exports){
"use strict";function id(n){return n.id||n.$tag}function setParentID(n,e,t){if(!n[e].parent&&t.length){var i=t[t.length-1];n[i]||(n[i]=Object.assign({},DEFAULT_THREAD_STATE,{id:i,children:[]}),setParentID(n,i,t.slice(0,-1)));for(var r=n[i].parent;r;){if(r===e)return;r=n[r].parent}n[e].parent=i,n[i].children.push(n[e])}}function threadAnnotations(n){var e={};n.forEach(function(n){e[id(n)]=Object.assign({},DEFAULT_THREAD_STATE,{id:id(n),annotation:n,children:[]})}),n.forEach(function(n){n.references&&setParentID(e,id(n),n.references)});var t=[];return Object.keys(e).forEach(function(n){e[n].parent||(e[n].collapsed=!0,t.push(e[n]))}),{annotation:void 0,children:t,visible:!0,collapsed:!1,totalChildren:t.length}}function mapThread(n,e){return Object.assign({},e(n),{children:n.children.map(function(n){return mapThread(n,e)})})}function sort(n,e){return n.slice().sort(function(n,t){return n.annotation&&t.annotation?e(n.annotation,t.annotation)?-1:e(t.annotation,n.annotation)?1:0:n.annotation||t.annotation?n.annotation?1:-1:0})}function sortThread(n,e,t){var i=n.children.map(function(n){return sortThread(n,t,t)});return Object.assign({},n,{children:sort(i,e)})}function countRepliesAndDepth(n,e){var t=n.children.map(function(n){return countRepliesAndDepth(n,e+1)});return Object.assign({},n,{children:t,depth:e,replyCount:t.reduce(function(n,e){return n+1+e.replyCount},0)})}function hasVisibleChildren(n){return n.children.some(function(n){return n.visible||hasVisibleChildren(n)})}function buildThread(n,e){e=Object.assign({},defaultOpts,e);var t=threadAnnotations(n),i=function(n){return!(!e.forceVisible||-1===e.forceVisible.indexOf(id(n)))||!(e.filterFn&&!e.filterFn(n))};return e.selected.length>0&&(t=Object.assign({},t,{children:t.children.filter(function(n){return-1!==e.selected.indexOf(n.id)})})),t=mapThread(t,function(n){var t;if(e.highlighted.length>0){t=n.annotation&&-1!==e.highlighted.indexOf(n.id)?"highlight":"dim"}return Object.assign({},n,{highlightState:t,visible:n.visible&&n.annotation&&i(n.annotation)})}),t=mapThread(t,function(n){var t=n.id;if(e.expanded.hasOwnProperty(t))return Object.assign({},n,{collapsed:!e.expanded[t]});var i=e.filterFn&&hasVisibleChildren(n);return Object.assign({},n,{collapsed:n.collapsed&&!i})}),t.children=t.children.filter(function(n){return n.visible||hasVisibleChildren(n)}),e.threadFilterFn&&(t.children=t.children.filter(e.threadFilterFn)),t=sortThread(t,e.sortCompareFn,e.replySortCompareFn),t=countRepliesAndDepth(t,-1)}var DEFAULT_THREAD_STATE={id:void 0,annotation:void 0,parent:void 0,collapsed:!1,visible:!0,children:[],totalChildren:0,highlightState:void 0},defaultOpts={selected:[],forceVisible:void 0,filterFn:void 0,threadFilterFn:void 0,expanded:{},highlighted:[],sortCompareFn:function(n,e){return n.id<e.id},replySortCompareFn:function(n,e){return n.created<e.created}};module.exports=buildThread;

},{}],56:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",bindings:{icon:"<",isDisabled:"<",label:"<",onClick:"&"},template:require("../templates/annotation-action-button.html")};

},{"../templates/annotation-action-button.html":136}],57:[function(require,module,exports){
"use strict";function AnnotationHeaderController(n,t,e,i){var r=this,a=this;this.user=function(){return a.annotation.user},this.displayName=function(){var t=r.annotation.user_info,i=isThirdPartyUser(r.annotation.user,e.authDomain);return(n.flagEnabled("client_display_names")||i)&&t&&t.display_name?t.display_name:username(r.annotation.user)},this.isThirdPartyUser=function(){return isThirdPartyUser(a.annotation.user,e.authDomain)},this.thirdPartyUsernameLink=function(){return e.usernameUrl?e.usernameUrl+username(this.annotation.user):null},this.serviceUrl=i,this.group=function(){return t.get(a.annotation.group)};var o=memoize(annotationMetadata.domainAndTitle);this.documentMeta=function(){return o(a.annotation)},this.updated=function(){return a.annotation.updated},this.htmlLink=function(){return a.annotation.links&&a.annotation.links.html?a.annotation.links.html:""}}AnnotationHeaderController.$inject=["features","groups","settings","serviceUrl"];var annotationMetadata=require("../annotation-metadata"),memoize=require("../util/memoize"),_require=require("../util/account-id"),isThirdPartyUser=_require.isThirdPartyUser,username=_require.username;module.exports={controller:AnnotationHeaderController,controllerAs:"vm",bindings:{annotation:"<",isPrivate:"<",isEditing:"<",isHighlight:"<",onReplyCountClick:"&",replyCount:"<",showDocumentInfo:"<"},template:require("../templates/annotation-header.html")};

},{"../annotation-metadata":52,"../templates/annotation-header.html":137,"../util/account-id":170,"../util/memoize":175}],58:[function(require,module,exports){
"use strict";function AnnotationShareDialogController(e,o,t){var n=this,i=e.find("input")[0];o.$watch("vm.isOpen",function(e){e&&scopeTimeout(o,function(){i.focus(),i.select()})}),this.copyToClipboard=function(e){var t=angular.element(e.currentTarget).parent(),i=t.find("input")[0];try{if(i.select(),!document.execCommand("copy"))throw new Error("Copying link failed");n.copyToClipboardMessage="Link copied to clipboard!"}catch(e){n.copyToClipboardMessage="Select and copy to share."}finally{setTimeout(function(){n.copyToClipboardMessage=null,o.$digest()},1e3)}},this.onShareClick=function(e){e&&t.track(t.events.ANNOTATION_SHARED,e)}}AnnotationShareDialogController.$inject=["$element","$scope","analytics"];var angular=require("angular"),scopeTimeout=require("../util/scope-timeout");module.exports={controller:AnnotationShareDialogController,controllerAs:"vm",bindings:{group:"<",uri:"<",isPrivate:"<",isOpen:"<",onClose:"&"},template:require("../templates/annotation-share-dialog.html")};

},{"../templates/annotation-share-dialog.html":138,"../util/scope-timeout":178,"angular":"angular"}],59:[function(require,module,exports){
"use strict";function hiddenCount(t){var n=t.annotation&&!t.visible;return t.children.reduce(function(t,n){return t+hiddenCount(n)},n?1:0)}function visibleCount(t){var n=t.annotation&&t.visible;return t.children.reduce(function(t,n){return t+visibleCount(n)},n?1:0)}function showAllChildren(t,n){t.children.forEach(function(t){n({thread:t}),showAllChildren(t,n)})}function showAllParents(t,n){for(;t.parent&&t.parent.annotation;)n({thread:t.parent}),t=t.parent}function AnnotationThreadController(){this.annotationHovered=!1,this.toggleCollapsed=function(){this.onChangeCollapsed({id:this.thread.id,collapsed:!this.thread.collapsed})},this.threadClasses=function(){return{"annotation-thread":!0,"annotation-thread--reply":this.thread.depth>0,"annotation-thread--top-reply":1===this.thread.depth}},this.threadToggleClasses=function(){return{"annotation-thread__collapse-toggle":!0,"is-open":!this.thread.collapsed,"is-hovered":this.annotationHovered}},this.annotationClasses=function(){return{annotation:!0,"annotation--reply":this.thread.depth>0,"is-collapsed":this.thread.collapsed,"is-highlighted":"highlight"===this.thread.highlightState,"is-dimmed":"dim"===this.thread.highlightState}},this.showThreadAndReplies=function(){showAllParents(this.thread,this.onForceVisible),this.onForceVisible({thread:this.thread}),showAllChildren(this.thread,this.onForceVisible)},this.isTopLevelThread=function(){return!this.thread.parent},this.hiddenCount=function(){return hiddenCount(this.thread)},this.shouldShowReply=function(t){return visibleCount(t)>0}}module.exports={controllerAs:"vm",controller:AnnotationThreadController,bindings:{thread:"<",showDocumentInfo:"<",onChangeCollapsed:"&",onForceVisible:"&"},template:require("../templates/annotation-thread.html")};

},{"../templates/annotation-thread.html":139}],60:[function(require,module,exports){
"use strict";function fetchThread(e,t){var n;return e.annotation.get({id:t}).then(function(t){return t.references&&t.references.length?e.annotation.get({id:t.references[0]}):t}).then(function(t){return n=t,e.search({references:n.id})}).then(function(e){return[n].concat(e.rows)})}function AnnotationViewerContentController(e,t,n,r,o,i,a,s){var c=this;n.setAppIsSidebar(!1);var l=t.id;this.search.update=function(t){e.path("/stream").search("q",t)},n.subscribe(function(){c.rootThread=r.thread(n.getState())}),this.setCollapsed=function(e,t){n.setCollapsed(e,t)},this.ready=fetchThread(i,l).then(function(e){s.loadAnnotations(e);var t=e.filter(function(e){return 0===(e.references||[]).length})[0];t&&(a.setMatchPolicyIncludeAny().addClause("/references","one_of",t.id,!0).addClause("/id","equals",t.id,!0),o.setConfig("filter",{filter:a.getFilter()}),o.connect(),e.forEach(function(e){n.setCollapsed(e.id,!1)}),t.id!==l&&n.highlightAnnotations([l]))})}AnnotationViewerContentController.$inject=["$location","$routeParams","annotationUI","rootThread","streamer","store","streamFilter","annotationMapper"],module.exports={controller:AnnotationViewerContentController,controllerAs:"vm",bindings:{search:"<"},template:require("../templates/annotation-viewer-content.html")};

},{"../templates/annotation-viewer-content.html":140}],61:[function(require,module,exports){
"use strict";function updateModel(t,n,a){var e=t.user;return Object.assign({},t,{tags:n.tags,text:n.text,permissions:n.isPrivate?a.private(e):a.shared(e,t.group)})}function AnnotationController(t,n,a,e,o,i,s,r,u,l,c,d,g,h,f,p,v,T){function E(t){var n,a=!!t.id;return n=a?p.annotation.update({id:t.id},t):p.annotation.create({},t),n.then(function(n){var e;return n.$tag=t.$tag,Object.keys(t).forEach(function(a){"$"===a[0]&&(n[a]=t[a])}),e=N.isReply()?a?i.events.REPLY_UPDATED:i.events.REPLY_CREATED:N.isHighlight()?a?i.events.HIGHLIGHT_UPDATED:i.events.HIGHLIGHT_CREATED:isPageNote(N.annotation)?a?i.events.PAGE_NOTE_UPDATED:i.events.PAGE_NOTE_CREATED:a?i.events.ANNOTATION_UPDATED:i.events.ANNOTATION_CREATED,i.track(e),n})}function A(){isNew(N.annotation)&&N.isHighlight()&&(N.annotation.user?(N.annotation.permissions=d.private(N.annotation.user),E(N.annotation).then(function(t){t.$tag=N.annotation.$tag,n.$broadcast(events.ANNOTATION_CREATED,t)})):u.update(N.annotation,N.state()))}var y,N=this;this.isThemeCustom="custom"===f.theme,this.authorize=function(t){return d.permits(N.annotation.permissions,t,h.state.userid)},this.flag=function(){if(!h.state.userid){var t=T("translate")("You must be logged in to report an annotation to the moderators. Login to flag annotations");return void l.error(t)}var n=function(t){var n=T("translate")("Flagging annotation failed");l.error(t.message,n)};r.flagAnnotation(N.annotation).then(function(){i.track(i.events.ANNOTATION_FLAGGED),s.updateFlagStatus(N.annotation.id,!0)},n)},this.delete=function(){return e(function(){var t=T("translate")("Are you sure you want to delete this annotation?");if(o.confirm(t)){var n=function(t){var n=T("translate")("Deleting annotation failed");l.error(t.message,n)};a.$apply(function(){r.deleteAnnotation(N.annotation).then(function(){var t;t=N.isReply()?i.events.REPLY_DELETED:N.isHighlight()?i.events.HIGHLIGHT_DELETED:isPageNote(N.annotation)?i.events.PAGE_NOTE_DELETED:i.events.ANNOTATION_DELETED,i.track(t)},n)})}},!0)},this.edit=function(){u.get(N.annotation)||u.update(N.annotation,N.state())},this.editing=function(){return u.get(N.annotation)&&!N.isSaving},this.group=function(){return c.get(N.annotation.group)},this.hasContent=function(){return N.state().text.length>0||N.state().tags.length>0},this.quote=function(){if(0===N.annotation.target.length)return null;var t=N.annotation.target[0];if(!t.selector)return null;var n=t.selector.find(function(t){return"TextQuoteSelector"===t.type});return n?n.exact:null},this.id=function(){return N.annotation.id},this.isHighlight=function(){return!!y||!isNew(N.annotation)&&(!isPageNote(N.annotation)&&!isReply(N.annotation)&&(!N.annotation.hidden&&!N.hasContent()))},this.isShared=function(){return!N.state().isPrivate},this.onKeydown=function(t){13===t.keyCode&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),N.save())},this.toggleCollapseBody=function(t){t.stopPropagation(),N.collapseBody=!N.collapseBody},this.reply=function(){var t,n=(N.annotation.references||[]).concat(N.annotation.id),a=N.annotation.group,e=h.state.userid;e&&(t=N.state().isPrivate?d.private(e):d.shared(e,a)),r.createAnnotation({group:a,references:n,permissions:t,target:[{source:N.annotation.target[0].source}],uri:N.annotation.uri})},this.revert=function(){u.remove(N.annotation),isNew(N.annotation)&&n.$broadcast(events.ANNOTATION_DELETED,N.annotation)},this.save=function(){var t;if(!N.annotation.user)return t=T("translate")("Please log in to save your annotations."),l.info(t),Promise.resolve();if(!N.hasContent()&&N.isShared())return t=T("translate")("Please add text or a tag before publishing."),l.info(t),Promise.resolve();var a=updateModel(N.annotation,N.state(),d);return N.isSaving=!0,E(a).then(function(t){Object.assign(a,t),N.isSaving=!1;var e=isNew(N.annotation)?events.ANNOTATION_CREATED:events.ANNOTATION_UPDATED;u.remove(N.annotation),n.$broadcast(e,a)}).catch(function(t){N.isSaving=!1,N.edit();var n=T("translate")("Saving annotation failed");l.error(t.message,n)})},this.setPrivacy=function(t){isReply(N.annotation)||d.setDefault(t),u.update(N.annotation,{tags:N.state().tags,text:N.state().text,isPrivate:"private"===t})},this.tagSearchURL=function(t){return this.isThirdPartyUser()?null:g("search.tag",{tag:t})},this.isOrphan=function(){return void 0===N.annotation.$orphan?N.annotation.$anchorTimeout:N.annotation.$orphan},this.user=function(){return N.annotation.user},this.isThirdPartyUser=function(){return isThirdPartyUser(N.annotation.user,f.authDomain)},this.isDeleted=function(){return v.hasPendingDeletion(N.annotation.id)},this.isHiddenByModerator=function(){return N.annotation.hidden},this.canFlag=function(){return h.state.userid!==N.annotation.user},this.isFlagged=function(){return N.annotation.flagged},this.isReply=function(){return isReply(N.annotation)},this.incontextLink=function(){return N.annotation.links?N.annotation.links.incontext||N.annotation.links.html||"":""},this.setBodyCollapsible=function(t){t!==N.canCollapseBody&&(N.canCollapseBody=t,a.$digest())},this.setText=function(t){u.update(N.annotation,{isPrivate:N.state().isPrivate,tags:N.state().tags,text:t})},this.setTags=function(t){u.update(N.annotation,{isPrivate:N.state().isPrivate,tags:t,text:N.state().text})},this.state=function(){var t=u.get(N.annotation);return t||{tags:N.annotation.tags,text:N.annotation.text,isPrivate:!d.isShared(N.annotation.permissions,N.annotation.user)}},this.shouldShowLicense=function(){return!(!N.editing()||!N.isShared())&&N.group().public},function(){N.canCollapseBody=!1,N.collapseBody=!0,N.isSaving=!1,N.showShareDialog=!1,y=N.annotation.$highlight||!1,N.annotation.user=N.annotation.user||h.state.userid,N.annotation.user_info=N.annotation.user_info||h.state.user_info,N.annotation.group=N.annotation.group||c.focused().id,N.annotation.permissions||(N.annotation.permissions=d.default(N.annotation.user,N.annotation.group)),N.annotation.text=N.annotation.text||"",Array.isArray(N.annotation.tags)||(N.annotation.tags=[]),A(),y||(isNew(N.annotation)||u.get(N.annotation))&&N.edit()}()}AnnotationController.$inject=["$document","$rootScope","$scope","$timeout","$window","analytics","annotationUI","annotationMapper","drafts","flash","groups","permissions","serviceUrl","session","settings","store","streamer","$filter"];var annotationMetadata=require("../annotation-metadata"),events=require("../events"),_require=require("../util/account-id"),isThirdPartyUser=_require.isThirdPartyUser,isNew=annotationMetadata.isNew,isReply=annotationMetadata.isReply,isPageNote=annotationMetadata.isPageNote;module.exports={controller:AnnotationController,controllerAs:"vm",bindings:{annotation:"<",showDocumentInfo:"<",onReplyCountClick:"&",replyCount:"<",isCollapsed:"<"},template:require("../templates/annotation.html"),updateModel:updateModel};

},{"../annotation-metadata":52,"../events":96,"../templates/annotation.html":141,"../util/account-id":170}],62:[function(require,module,exports){
"use strict";function DropdownMenuBtnController(o){var n=this;this.toggleDropdown=function(t){t.stopPropagation(),o(function(){n.onToggleDropdown()},0)}}DropdownMenuBtnController.$inject=["$timeout"],module.exports={controller:DropdownMenuBtnController,controllerAs:"vm",bindings:{isDisabled:"<",label:"<",dropdownMenuLabel:"@",onClick:"&",onToggleDropdown:"&"},template:require("../templates/dropdown-menu-btn.html")};

},{"../templates/dropdown-menu-btn.html":142}],63:[function(require,module,exports){
"use strict";function ExcerptController(e,t,n){function o(){for(var t=e[0];t;){if(t.classList.contains("ng-hide"))return!0;t=t.parentElement}return!1}var i=this;void 0===this.collapse&&(this.collapse=!0),void 0===this.animate&&(this.animate=!0),void 0===this.enabled&&(this.enabled=!0),this.isExpandable=function(){return this.overflowing&&this.collapse},this.isCollapsible=function(){return this.overflowing&&!this.collapse},this.toggle=function(e){e.stopPropagation(),this.collapse=!this.collapse},this.expand=function(){this.collapse=!1},this.showInlineControls=function(){return this.overflowing&&this.inlineControls},this.bottomShadowStyles=function(){return{excerpt__shadow:!0,"excerpt__shadow--transparent":this.inlineControls,"is-hidden":!this.isExpandable()}};var l=new n({getState:function(){return{enabled:i.enabled,animate:i.animate,collapsedHeight:i.collapsedHeight,collapse:i.collapse,overflowHysteresis:i.overflowHysteresis}},contentHeight:function(){var t=e[0].querySelector(".excerpt");return t?t.scrollHeight:null},onOverflowChanged:function(e){i.overflowing=e,i.onCollapsibleChanged&&i.onCollapsibleChanged({collapsible:e}),t.$digest()}},window.requestAnimationFrame);this.contentStyle=l.contentStyle,e[0].addEventListener("load",l.check,!1),window.addEventListener("resize",l.check),t.$on("$destroy",function(){window.removeEventListener("resize",l.check)}),t.$watch(o,function(e){e||l.check()}),t.$watch("vm.contentData",l.check),t.$watch("vm.enabled",l.check),l.check()}ExcerptController.$inject=["$element","$scope","ExcerptOverflowMonitor"],module.exports={controller:ExcerptController,controllerAs:"vm",bindings:{animate:"<?",contentData:"<",enabled:"<?",inlineControls:"<",collapse:"=?",onCollapsibleChanged:"&?",collapsedHeight:"<",overflowHysteresis:"<?"},transclude:!0,template:require("../templates/excerpt.html")};

},{"../templates/excerpt.html":143}],64:[function(require,module,exports){
"use strict";function GroupListController(r,e,t,i,o){this.groups=t,this.createNewGroup=function(){r.open(o("groups.new"),"_blank")},this.isThirdPartyUser=function(){return isThirdPartyUser(this.auth.userid,i.authDomain)},this.leaveGroup=function(i){var o=t.get(i).name,s='Are you sure you want to leave the group "'+o+'"?';r.confirm(s)&&(e.track(e.events.GROUP_LEAVE),t.leave(i))},this.viewGroupActivity=function(){e.track(e.events.GROUP_VIEW_ACTIVITY)},this.focusGroup=function(r){e.track(e.events.GROUP_SWITCH),t.focus(r)};var s=serviceConfig(i);s&&s.icon&&(this.thirdPartyGroupIcon=s.icon)}GroupListController.$inject=["$window","analytics","groups","settings","serviceUrl"];var _require=require("../util/account-id"),isThirdPartyUser=_require.isThirdPartyUser,serviceConfig=require("../service-config");module.exports={controller:GroupListController,controllerAs:"vm",bindings:{auth:"<"},template:require("../templates/group-list.html")};

},{"../service-config":128,"../templates/group-list.html":144,"../util/account-id":170}],65:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",template:require("../templates/help-link.html"),controller:function(){},scope:{version:"<",userAgent:"<",url:"<",documentFingerprint:"<",auth:"<",dateTime:"<"}};

},{"../templates/help-link.html":145}],66:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",controller:["$scope","$window","annotationUI","serviceUrl",function(t,e,n,i){this.userAgent=e.navigator.userAgent,this.version="1.64.0",this.dateTime=new Date,this.serviceUrl=i,t.$watch(function(){return n.frames()},function(t){0!==t.length&&(this.url=t[0].uri,this.documentFingerprint=t[0].metadata.documentFingerprint)}.bind(this))}],template:require("../templates/help-panel.html"),bindings:{auth:"<",onClose:"&"}};

},{"../templates/help-panel.html":146}],67:[function(require,module,exports){
"use strict";function authStateFromProfile(e){if(e.userid){var t=parseAccountID(e.userid),i=t.username;return e.user_info&&e.user_info.display_name&&(i=e.user_info.display_name),{status:"logged-in",displayName:i,userid:e.userid,username:t.username,provider:t.provider}}return{status:"logged-out"}}function HypothesisAppController(e,t,i,n,r,o,s,a,u,l,c,d,h,p,f,v,g,E,y){function m(t){scopeTimeout(r,function(){scrollIntoView(e[0].querySelector(t))},0)}var S=this;this.auth={status:"unknown"},this.shareDialog={visible:!1},this.helpPanel={visible:!1},this.isSidebar=o.top!==o,this.isSidebar&&p.connect(),this.sortKey=function(){return a.getState().sortKey},this.sortKeysAvailable=function(){return a.getState().sortKeysAvailable},this.setSortKey=a.setSortKey,r.$on(events.USER_CHANGED,function(e,t){S.auth=authStateFromProfile(t.profile)}),g.load().then(function(e){S.auth=authStateFromProfile(e)}),this.login=function(){return serviceConfig(E)?(l.call(bridgeEvents.LOGIN_REQUESTED),Promise.resolve()):u.login().then(function(){g.reload()}).catch(function(e){h.error(e.message)})},this.signUp=function(){if(s.track(s.events.SIGN_UP_REQUESTED),serviceConfig(E))return void l.call(bridgeEvents.SIGNUP_REQUESTED);o.open(v("signup"))},this.share=function(){this.shareDialog.visible=!0,m("share-dialog")},this.showHelpPanel=function(){if((serviceConfig(E)||{}).onHelpRequestProvided)return void l.call(bridgeEvents.HELP_REQUESTED);this.helpPanel.visible=!0};var U=function(){var e="";return 1===c.count()?e="You have an unsaved annotation.\nDo you really want to discard this draft?":c.count()>1&&(e="You have "+c.count()+" unsaved annotations.\nDo you really want to discard these drafts?"),0===c.count()||o.confirm(e)};this.logout=function(){if(U()){if(c.unsaved().forEach(function(e){i.$emit(events.ANNOTATION_DELETED,e)}),c.discard(),serviceConfig(E))return void l.call(bridgeEvents.LOGOUT_REQUESTED);g.logout()}},this.search={query:function(){return a.getState().filterQuery},update:function(e){a.setFilterQuery(e)}},this.countPendingUpdates=y.countPendingUpdates,this.applyPendingUpdates=y.applyPendingUpdates}HypothesisAppController.$inject=["$document","$location","$rootScope","$route","$scope","$window","analytics","annotationUI","auth","bridge","drafts","features","flash","frameSync","groups","serviceUrl","session","settings","streamer"];var scrollIntoView=require("scroll-into-view"),events=require("../events"),_require=require("../util/account-id"),parseAccountID=_require.parseAccountID,scopeTimeout=require("../util/scope-timeout"),serviceConfig=require("../service-config"),bridgeEvents=require("../../shared/bridge-events");module.exports={controller:HypothesisAppController,controllerAs:"vm",template:require("../templates/hypothesis-app.html")};

},{"../../shared/bridge-events":43,"../events":96,"../service-config":128,"../templates/hypothesis-app.html":147,"../util/account-id":170,"../util/scope-timeout":178,"scroll-into-view":35}],68:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",controller:["serviceUrl",function(e){this.serviceUrl=e}],bindings:{onLogin:"&"},template:require("../templates/loggedout-message.html")};

},{"../templates/loggedout-message.html":148}],69:[function(require,module,exports){
"use strict";var bridgeEvents=require("../../shared/bridge-events"),_require=require("../util/account-id"),isThirdPartyUser=_require.isThirdPartyUser,serviceConfig=require("../service-config");module.exports={controllerAs:"vm",controller:["bridge","serviceUrl","settings","$window",function(e,r,i,t){this.serviceUrl=r,this.isThirdPartyUser=function(){return isThirdPartyUser(this.auth.userid,i.authDomain)},this.shouldShowLogOutButton=function(){if("logged-in"!==this.auth.status)return!1;var e=serviceConfig(i);return!(e&&!e.onLogoutRequestProvided)},this.shouldEnableProfileButton=function(){var e=serviceConfig(i);return!e||e.onProfileRequestProvided},this.showProfile=function(){if(this.isThirdPartyUser())return void e.call(bridgeEvents.PROFILE_REQUESTED);t.open(this.serviceUrl("user",{user:this.auth.username}))}}],bindings:{auth:"<",onShowHelpPanel:"&",onLogin:"&",onSignUp:"&",onLogout:"&",newStyle:"<"},template:require("../templates/login-control.html")};

},{"../../shared/bridge-events":43,"../service-config":128,"../templates/login-control.html":149,"../util/account-id":170}],70:[function(require,module,exports){
"use strict";function MarkdownController(e,t,n){function o(e){var t=e({text:r.value,selectionStart:r.selectionStart,selectionEnd:r.selectionEnd});r.value=t.text,r.selectionStart=t.selectionStart,r.selectionEnd=t.selectionEnd,r.focus(),s.onEditText({text:r.value})}function i(){scopeTimeout(n,function(){r.focus()},0)}var r=e[0].querySelector(".js-markdown-input"),c=e[0].querySelector(".js-markdown-preview"),s=this;this.insertBold=function(){o(function(e){return commands.toggleSpanStyle(e,"**","**","Bold")})},this.insertItalic=function(){o(function(e){return commands.toggleSpanStyle(e,"*","*","Italic")})},this.insertMath=function(){o(function(e){var t=e.text.slice(0,e.selectionStart);return 0===t.length||"\n"===t.slice(-1)||"$$"===t.slice(-2)?commands.toggleSpanStyle(e,"$$","$$","Insert LaTeX"):commands.toggleSpanStyle(e,"\\(","\\)","Insert LaTeX")})},this.insertLink=function(){o(function(e){return commands.convertSelectionToLink(e)})},this.insertIMG=function(){o(function(e){return commands.convertSelectionToLink(e,commands.LinkType.IMAGE_LINK)})},this.insertList=function(){o(function(e){return commands.toggleBlockStyle(e,"* ")})},this.insertNumList=function(){o(function(e){return commands.toggleBlockStyle(e,"1. ")})},this.insertQuote=function(){o(function(e){return commands.toggleBlockStyle(e,"> ")})},e.on("keydown",function(e){var t={66:s.insertBold,73:s.insertItalic,75:s.insertLink},n=t[e.keyCode];n&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),n())}),this.preview=!1,this.togglePreview=function(){s.preview=!s.preview};var l=debounce(function(){n.$apply(function(){s.onEditText({text:r.value})})},100);r.addEventListener("input",l),n.$watch("vm.text",function(){c.innerHTML=renderMarkdown(s.text||"",t),mediaEmbedder.replaceLinksWithEmbeds(c)}),this.showEditor=function(){return!s.readOnly&&!s.preview},n.$watch("vm.readOnly",function(){s.preview=!1}),n.$watch("vm.showEditor()",function(e){e&&(r.value=s.text||"",i())})}MarkdownController.$inject=["$element","$sanitize","$scope"];var debounce=require("lodash.debounce"),commands=require("../markdown-commands"),mediaEmbedder=require("../media-embedder"),renderMarkdown=require("../render-markdown"),scopeTimeout=require("../util/scope-timeout");module.exports={controller:MarkdownController,controllerAs:"vm",bindings:{customTextClass:"<?",readOnly:"<",text:"<?",onEditText:"&"},template:require("../templates/markdown.html")};

},{"../markdown-commands":108,"../media-embedder":109,"../render-markdown":123,"../templates/markdown.html":150,"../util/scope-timeout":178,"lodash.debounce":6}],71:[function(require,module,exports){
"use strict";function ModerationBannerController(n,t,o,a){var i=this;this.flagCount=function(){return annotationMetadata.flagCount(i.annotation)},this.isHidden=function(){return i.annotation.hidden},this.isHiddenOrFlagged=function(){var n=i.flagCount();return null!==n&&(n>0||i.isHidden())},this.isReply=function(){return annotationMetadata.isReply(i.annotation)},this.hideAnnotation=function(){o.annotation.hide({id:i.annotation.id}).then(function(){n.hideAnnotation(i.annotation.id)}).catch(function(){var n=a("translate")("Failed to hide annotation");t.error(n)})},this.unhideAnnotation=function(){o.annotation.unhide({id:i.annotation.id}).then(function(){n.unhideAnnotation(i.annotation.id)}).catch(function(){var n=a("translate")("Failed to unhide annotation");t.error(n)})}}ModerationBannerController.$inject=["annotationUI","flash","store","$filter"];var annotationMetadata=require("../annotation-metadata");module.exports={controller:ModerationBannerController,controllerAs:"vm",bindings:{annotation:"<"},template:require("../templates/moderation-banner.html")};

},{"../annotation-metadata":52,"../templates/moderation-banner.html":151}],72:[function(require,module,exports){
"use strict";var events=require("../events");module.exports={controllerAs:"vm",controller:["$rootScope","annotationUI",function(t,e){this.onNewNoteBtnClick=function(){var n=e.frames().find(function(t){return!t.id}),r={target:[],uri:n.uri};t.$broadcast(events.BEFORE_ANNOTATION_CREATED,r)}}],bindings:{},template:require("../templates/new-note-btn.html")};

},{"../events":96,"../templates/new-note-btn.html":152}],73:[function(require,module,exports){
"use strict";module.exports={controller:function(){this.showDropdown=!1,this.privateLabel="Only Me",this.publishDestination=function(){return this.isShared?this.group.name:this.privateLabel},this.groupType=function(){return this.group.public?"public":"group"},this.setPrivacy=function(t){this.onSetPrivacy({level:t})}},controllerAs:"vm",bindings:{group:"<",canPost:"<",isShared:"<",onCancel:"&",onSave:"&",onSetPrivacy:"&"},template:require("../templates/publish-annotation-btn.html")};

},{"../templates/publish-annotation-btn.html":153}],74:[function(require,module,exports){
"use strict";function SearchInputController(n,e,t){var r=this,u=n.find("button"),o=n.find("input")[0],i=n.find("form")[0];u.on("click",function(){o.focus()}),t.$watch(function(){return e.pendingRequests.length},function(n){r.loading=n>0}),i.onsubmit=function(n){n.preventDefault(),r.onSearch({$query:o.value})},this.inputClasses=function(){return{"is-expanded":r.alwaysExpanded||r.query}},this.$onChanges=function(n){n.query&&(o.value=n.query.currentValue)}}SearchInputController.$inject=["$element","$http","$scope"],module.exports={controller:SearchInputController,controllerAs:"vm",bindings:{alwaysExpanded:"<",query:"<",onSearch:"&"},template:require("../templates/search-input.html")};

},{"../templates/search-input.html":154}],75:[function(require,module,exports){
"use strict";var uiConstants=require("../ui-constants");module.exports={controllerAs:"vm",controller:function(){this.TAB_ANNOTATIONS=uiConstants.TAB_ANNOTATIONS,this.TAB_NOTES=uiConstants.TAB_NOTES,this.TAB_ORPHANS=uiConstants.TAB_ORPHANS},bindings:{filterActive:"<",filterMatchCount:"<",onClearSelection:"&",searchQuery:"<",selectedTab:"<",selectionCount:"<",totalAnnotations:"<",totalNotes:"<"},template:require("../templates/search-status-bar.html")};

},{"../templates/search-status-bar.html":155,"../ui-constants":168}],76:[function(require,module,exports){
"use strict";var sessionUtil=require("../util/session-util"),uiConstants=require("../ui-constants");module.exports={controllerAs:"vm",controller:["$element","annotationUI","features","session","settings",function(t,e,s,n,i){this.TAB_ANNOTATIONS=uiConstants.TAB_ANNOTATIONS,this.TAB_NOTES=uiConstants.TAB_NOTES,this.TAB_ORPHANS=uiConstants.TAB_ORPHANS,this.isThemeClean="clean"===i.theme,this.isThemeCustom="custom"===i.theme,this.enableExperimentalNewNoteButton=i.enableExperimentalNewNoteButton,this.selectTab=function(t){e.clearSelectedAnnotations(),e.selectTab(t)},this.showAnnotationsUnavailableMessage=function(){return this.selectedTab===this.TAB_ANNOTATIONS&&0===this.totalAnnotations&&!this.isWaitingToAnchorAnnotations},this.showNotesUnavailableMessage=function(){return this.selectedTab===this.TAB_NOTES&&0===this.totalNotes},this.showSidebarTutorial=function(){return sessionUtil.shouldShowSidebarTutorial(n.state)}}],bindings:{isLoading:"<",isWaitingToAnchorAnnotations:"<",selectedTab:"<",totalAnnotations:"<",totalNotes:"<",totalOrphans:"<"},template:require("../templates/selection-tabs.html")};

},{"../templates/selection-tabs.html":156,"../ui-constants":168,"../util/session-util":179}],77:[function(require,module,exports){
"use strict";function ShareDialogController(e,t,i,r){function n(e){if(!e.length)return void(o.viaPageLink="");0===e[0].uri.indexOf(VIA_PREFIX)?o.viaPageLink=e[0].uri:o.viaPageLink=VIA_PREFIX+e[0].uri}var o=this,a=t[0].querySelector(".js-via");a.focus(),a.select(),e.$watch(function(){return r.frames()},n),e.onShareClick=function(e){e&&i.track(i.events.DOCUMENT_SHARED,e)}}ShareDialogController.$inject=["$scope","$element","analytics","annotationUI"];var VIA_PREFIX="https://via.hypothes.is/";module.exports={controller:ShareDialogController,controllerAs:"vm",bindings:{onClose:"&"},template:require("../templates/share-dialog.html")};

},{"../templates/share-dialog.html":157}],78:[function(require,module,exports){
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function firstKey(t){for(var e in t)if(t.hasOwnProperty(e))return e;return null}function groupIDFromSelection(t,e){var n=firstKey(t),r=e.find(function(t){return t.id===n});return r?r.group:null}function SidebarContentController(t,e,n,r,o,i,a,s,c,u,l,d,f){function h(){return c.thread(n.getState())}function g(t){var e=[];t&&(e=[t.$tag]),a.focusAnnotations(e)}function A(t){if(t){1!==document.querySelectorAll(".default__card-selected").length?document.getElementById(t.id).classList.add("default__card-selected"):document.getElementById(t.id).classList.toggle("default__card-selected"),document.querySelectorAll(".default__card-selected").forEach(function(e){e.id!==t.id&&document.getElementById(e.id).classList.remove("default__card-selected")}),a.scrollToAnnotation(t.$tag)}}function v(){if(n.getState().selectedAnnotationMap){var t=Object.keys(n.getState().selectedAnnotationMap)[0];return n.getState().annotations.find(function(e){return e.id===t})}return null}function S(){r.unloadAnnotations(n.savedAnnotations())}function m(e,o){var i=new SearchClient(f.search,{incremental:!!o});C.push(i),i.on("results",function(t){if(n.hasSelectedAnnotations()){var e=groupIDFromSelection(n.getState().selectedAnnotationMap,t);e||(e=s.focused().id),t=t.filter(function(t){return t.group===e}),s.focus(e)}t.length&&r.loadAnnotations(t)}),i.on("end",function(){t.$evalAsync(function(){C.splice(C.indexOf(i),1)}),n.frames().forEach(function(t){0<=e.indexOf(t.uri)&&n.updateFrameAnnotationFetchStatus(t.uri,!0)})}),i.get({uri:e,group:o})}function y(){return!n.frames().some(function(t){return t.uri})||C.length>0}function p(){S(),C.forEach(function(t){t.cancel()});var t=n.hasSelectedAnnotations()?null:s.focused().id,e=n.searchUris();e.length>0&&(m(e,t),d.resetFilter().addClause("/uri","one_of",e),l.setConfig("filter",{filter:d.getFilter()}))}var b=this,T=n.subscribe(function(){var t=n.getState();b.rootThread=h(),b.selectedTab=t.selectedTab;var e=tabs.counts(t.annotations);Object.assign(b,{totalNotes:e.notes,totalAnnotations:e.annotations,totalOrphans:e.orphans,waitingToAnchorAnnotations:e.anchoring>0})});t.$on("$destroy",T);var C=[];t.$on("sidebarOpened",function(){e.track(e.events.SIDEBAR_OPENED),l.connect()}),"logged-in"===this.auth.status&&l.connect(),t.$on(events.USER_CHANGED,function(){l.reconnect()}),t.$on(events.ANNOTATIONS_SYNCED,function(t,e){var r=v();if(r){e.some(function(t){return t===r.$tag})&&(g(r),A(r),n.selectTab(tabs.tabForAnnotation(r)))}}),t.$watch(function(){return[s.focused().id,n.profile().userid].concat(_toConsumableArray(n.searchUris()))},function(t,e){if(_slicedToArray(t,1)[0]!==_slicedToArray(e,1)[0]){if(y())return;n.clearSelectedAnnotations()}p()},!0),this.setCollapsed=function(t,e){n.setCollapsed(t,e)},this.forceVisible=function(t){n.setForceVisible(t.id,!0),t.parent&&n.setCollapsed(t.parent.id,!1)},this.focus=g,this.scrollTo=A,this.selectedAnnotationCount=function(){var t=n.getState().selectedAnnotationMap;return t?Object.keys(t).length:0},this.selectedAnnotationUnavailable=function(){var t=firstKey(n.getState().selectedAnnotationMap);return!y()&&!!t&&!n.annotationExists(t)},this.shouldShowLoggedOutMessage=function(){if("logged-out"!==b.auth.status)return!1;if(!u.annotations)return!1;if(isThirdPartyService(u))return!1;var t=firstKey(n.getState().selectedAnnotationMap);return!y()&&!!t&&n.annotationExists(t)},this.isLoading=y;var _=memoize(function(t){return t.children.reduce(function(t,e){return t+_(e)},t.visible?1:0)});this.visibleCount=function(){return _(h())},this.topLevelThreadCount=function(){return h().totalChildren},this.clearSelection=function(){var t=n.getState().selectedTab;n.getState().selectedTab&&n.getState().selectedTab!==uiConstants.TAB_ORPHANS||(t=uiConstants.TAB_ANNOTATIONS),n.clearSelectedAnnotations(),n.selectTab(t)}}SidebarContentController.$inject=["$scope","analytics","annotationUI","annotationMapper","drafts","features","frameSync","groups","rootThread","settings","streamer","streamFilter","store"];var _slicedToArray=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),SearchClient=require("../search-client"),events=require("../events"),isThirdPartyService=require("../util/is-third-party-service"),memoize=require("../util/memoize"),tabs=require("../tabs"),uiConstants=require("../ui-constants");module.exports={controller:SidebarContentController,controllerAs:"vm",bindings:{auth:"<",search:"<"},template:require("../templates/sidebar-content.html")};

},{"../events":96,"../search-client":126,"../tabs":134,"../templates/sidebar-content.html":158,"../ui-constants":168,"../util/is-third-party-service":174,"../util/memoize":175}],79:[function(require,module,exports){
"use strict";function SidebarTutorialController(i,t){this.isThemeClean="clean"===t.theme,this.showSidebarTutorial=function(){return sessionUtil.shouldShowSidebarTutorial(i.state)},this.dismiss=function(){i.dismissSidebarTutorial()}}SidebarTutorialController.$inject=["session","settings"];var sessionUtil=require("../util/session-util");module.exports={controller:SidebarTutorialController,controllerAs:"vm",bindings:{},template:require("../templates/sidebar-tutorial.html")};

},{"../templates/sidebar-tutorial.html":159,"../util/session-util":179}],80:[function(require,module,exports){
"use strict";module.exports={controllerAs:"vm",controller:function(){},bindings:{sortKey:"<",sortKeysAvailable:"<",onChangeSortKey:"&"},template:require("../templates/sort-dropdown.html")};

},{"../templates/sort-dropdown.html":160}],81:[function(require,module,exports){
"use strict";function StreamContentController(e,t,r,o,n,s,a,i,l,c,u,h){var p=this;s.setAppIsSidebar(!1);var d=0,f=function(e){d+=e.rows.length,n.loadAnnotations(e.rows,e.replies)},m=function(e){var t=Object.assign({_separate_replies:!0,offset:d,limit:e},l.toObject(o.q));c.search(t).then(f).catch(function(e){console.error(e)})},b=o.q;e.$on("$routeUpdate",function(){o.q!==b&&(s.clearAnnotations(),r.reload())}),u.resetFilter().setMatchPolicyIncludeAll();var q=l.generateFacetedFilter(o.q);a.populateFilter(u,q),h.setConfig("filter",{filter:u.getFilter()}),h.connect(),m(20),this.setCollapsed=s.setCollapsed,this.forceVisible=function(e){s.setForceVisible(e,!0)},Object.assign(this.search,{query:function(){return o.q||""},update:function(e){t.search({q:e})}}),s.subscribe(function(){p.rootThread=i.thread(s.getState())}),s.setSortKey("Newest"),this.loadMore=m}StreamContentController.$inject=["$scope","$location","$route","$routeParams","annotationMapper","annotationUI","queryParser","rootThread","searchFilter","store","streamFilter","streamer"],module.exports={controller:StreamContentController,controllerAs:"vm",bindings:{search:"<"},template:require("../templates/stream-content.html")};

},{"../templates/stream-content.html":161}],82:[function(require,module,exports){
"use strict";function SvgIconController(n){if(!icons[this.name])throw new Error("Unknown icon: "+this.name);n[0].innerHTML=icons[this.name]}SvgIconController.$inject=["$element"];var icons={refresh:require("../../images/icons/refresh.svg"),cursor:require("../../images/icons/cursor.svg")};module.exports={controllerAs:"vm",controller:SvgIconController,bindings:{name:"<"}};

},{"../../images/icons/cursor.svg":41,"../../images/icons/refresh.svg":42}],83:[function(require,module,exports){
"use strict";function TagEditorController(t){this.onTagsChanged=function(){t.store(this.tagList);var e=this.tagList.map(function(t){return t.text});this.onEditTags({tags:e})},this.autocomplete=function(e){return Promise.resolve(t.filter(e))},this.$onChanges=function(t){t.tags&&(this.tagList=t.tags.currentValue.map(function(t){return{text:t}}))}}TagEditorController.$inject=["tags"],module.exports={controller:TagEditorController,controllerAs:"vm",bindings:{tags:"<",onEditTags:"&"},template:require("../templates/tag-editor.html")};

},{"../templates/tag-editor.html":162}],84:[function(require,module,exports){
"use strict";function getThreadHeight(e){var t=document.getElementById(e);if(!t)return null;var o=window.getComputedStyle(t);return o?t.getBoundingClientRect().height+(parseFloat(o.marginTop)+parseFloat(o.marginBottom)):null}function ThreadListController(e,t,o,n){function r(e){var t=a.scrollRoot.scrollHeight-a.scrollRoot.clientHeight;return Math.min(t,c.yOffsetOf(e))}function i(e){var o=r(e);a.scrollRoot.scrollTop=o,scopeTimeout(t,function(){r(e)!==o&&i(e)},200)}function l(e,t){var o=e.length,n=document.querySelectorAll(".default__card-selected").length;t.forEach(function(e){document.getElementById(e).classList.remove("default__card-selected")}),e.forEach(function(e){o!==d?document.getElementById(e).classList.add("default__card-selected"):o!==n?document.getElementById(e).classList.add("default__card-selected"):document.getElementById(e).classList.toggle("default__card-selected")}),d=o}var a=this;this.scrollRoot=document.querySelector(".js-thread-list-scroll-root"),this.isThemeClean="clean"===o.theme;var s=Object.assign({scrollRoot:this.scrollRoot},virtualThreadOptions),c=new n(t,window,this.thread,s);c.on("changed",function(e){a.virtualThreadList={visibleThreads:e.visibleThreads,invisibleThreads:e.invisibleThreads,offscreenUpperHeight:e.offscreenUpperHeight+"px",offscreenLowerHeight:e.offscreenLowerHeight+"px"},scopeTimeout(t,function(){e.visibleThreads.forEach(function(e){var t=getThreadHeight(e.id);t&&c.setThreadHeight(e.id,t)})},50)});var d=0;t.$on(events.SHOW_BUCKET_LIST,function(e,t){var o=[];document.querySelectorAll(".thread-list__card").forEach(function(e){o.push(e.id)});var n=o.filter(function(e){return!t.includes(e)});l(t,n)}),t.$on(events.BEFORE_ANNOTATION_CREATED,function(e,t){t.$highlight||metadata.isReply(t)||(a.onClearSelection(),i(t.$tag))}),this.$onChanges=function(e){e.thread&&c.setRootThread(e.thread.currentValue)},this.$onDestroy=function(){c.detach()}}ThreadListController.$inject=["$element","$scope","settings","VirtualThreadList"];var events=require("../events"),metadata=require("../annotation-metadata"),scopeTimeout=require("../util/scope-timeout"),virtualThreadOptions={invisibleThreadFilter:function(e){return e.annotation.$highlight&&metadata.isNew(e.annotation)}};module.exports={controller:ThreadListController,controllerAs:"vm",bindings:{thread:"<",showDocumentInfo:"<",onForceVisible:"&",onFocus:"&",onSelect:"&",onChangeCollapsed:"&",onClearSelection:"&"},template:require("../templates/thread-list.html")};

},{"../annotation-metadata":52,"../events":96,"../templates/thread-list.html":163,"../util/scope-timeout":178}],85:[function(require,module,exports){
"use strict";function TimestampController(t,e){function i(){s.relativeTimestamp=e.toFuzzyString(s.timestamp),s.absoluteTimestamp=dateUtil.format(new Date(s.timestamp)),s.timestamp&&(m&&m(),m=e.decayingInterval(s.timestamp,function(){i(),t.$digest()}))}this.relativeTimestamp=null,this.absoluteTimestamp="";var m,s=this;this.$onChanges=function(t){t.timestamp&&i()},this.$onDestroy=function(){m&&m()}}TimestampController.$inject=["$scope","time"];var dateUtil=require("../date-util");module.exports={controller:TimestampController,controllerAs:"vm",bindings:{className:"<",href:"<",timestamp:"<"},template:require("../templates/timestamp.html")};

},{"../date-util":88,"../templates/timestamp.html":164}],86:[function(require,module,exports){
"use strict";var isThirdPartyService=require("../util/is-third-party-service");module.exports={controllerAs:"vm",controller:["settings",function(e){e.theme?(this.isThemeClean="clean"===e.theme,this.isThemeCustom="custom"===e.theme):(this.isThemeClean=!1,this.isThemeCustom=!1),this.showSharePageButton=function(){return!isThirdPartyService(e)}}],bindings:{auth:"<",isSidebar:"<",onShowHelpPanel:"&",onLogin:"&",onLogout:"&",onSharePage:"&",onSignUp:"&",searchController:"<",sortKey:"<",sortKeysAvailable:"<",onChangeSortKey:"&",pendingUpdateCount:"<",onApplyPendingUpdates:"&"},template:require("../templates/top-bar.html")};

},{"../templates/top-bar.html":165,"../util/is-third-party-service":174}],87:[function(require,module,exports){
"use strict";function start(t,e,r){function s(e){var r={searchUris:t.searchUris},s=r[e.method],n={jsonrpc:"2.0",id:e.id};return s?n.result=s():n.error={code:-32601,message:"Method not found"},n}r.addEventListener("message",function(t){if((e.rpcAllowedOrigins||[]).includes(t.origin)){var r=t.data;t.source.postMessage(s(r),t.origin)}})}start.$inject=["annotationUI","settings","$window"],module.exports={server:{start:start}};

},{}],88:[function(require,module,exports){
"use strict";function format(t){return"undefined"!=typeof Intl&&Intl.DateTimeFormat?(formatter||(formatter=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})),formatter.format(t)):t.toDateString()+" "+t.toLocaleTimeString()}var formatter;module.exports={format:format};

},{}],89:[function(require,module,exports){
"use strict";module.exports=function(){return{restrict:"A",link:function(t,n){n[0].focus()}}};

},{}],90:[function(require,module,exports){
"use strict";function BrandingDirective(n){var r=!!n.branding,o={accentColor:"color",appBackgroundColor:"backgroundColor",ctaBackgroundColor:"backgroundColor",ctaTextColor:"color",selectionFontFamily:"fontFamily",annotationFontFamily:"fontFamily"},t=function(n){return n.split(",").map(function(n){return n.trim()}).filter(function(n){return n in o})};return{restrict:"A",link:function(i,a,c){r&&t(c.hBranding).forEach(function(r){var t=n.branding[r];t&&(a[0].style[o[r]]=t)})}}}BrandingDirective.$inject=["settings"],module.exports=BrandingDirective;

},{}],91:[function(require,module,exports){
"use strict";function addEventHandler(n,t,e,o){var r=function(t){n.$apply(function(){o(n,{$event:t})})};e.forEach(function(n){t.addEventListener(n,r)})}module.exports=function(n){return{restrict:"A",link:function(t,e,o){var r=n(o.hOnTouch,null);addEventHandler(t,e[0],["click","mousedown","touchstart"],r)}}},module.exports.$inject=["$parse"];

},{}],92:[function(require,module,exports){
"use strict";function Tooltip(t){this.setState=function(t){this.state=Object.freeze(Object.assign({},this.state,t)),this.render()},this.render=function(){if(!this.state.target)return void(this._el.style.visibility="hidden");var t=this.state.target,e=t.getAttribute("aria-label");this._labelEl.textContent=e;var i,o=this._el.getBoundingClientRect(),s=t.getBoundingClientRect();i="up"===this.state.direction?s.bottom+7:s.top-o.height-7;var l=s.right-o.width;this._el.classList.toggle("tooltip--up","up"===this.state.direction),this._el.classList.toggle("tooltip--down","down"===this.state.direction),Object.assign(this._el.style,{visibility:"",top:i+"px",left:l+"px"})},this._el=t.ownerDocument.createElement("div"),this._el.innerHTML='<span class="tooltip-label js-tooltip-label"></span>',this._el.className="tooltip",t.appendChild(this._el),this._labelEl=this._el.querySelector(".js-tooltip-label"),this.setState({direction:"down"})}var theTooltip;module.exports=function(){return theTooltip||(theTooltip=new Tooltip(document.body)),{restrict:"A",link:function(t,e){var i=e[0];i.addEventListener("mouseover",function(){var t=i.getAttribute("tooltip-direction")||"down";theTooltip.setState({direction:t,target:i})}),i.addEventListener("mouseout",function(){theTooltip.setState({target:null})}),t.$on("$destroy",function(){theTooltip.state.target===i&&theTooltip.setState({target:null})})}}};

},{}],93:[function(require,module,exports){
"use strict";module.exports=["$animate",function(n){return{link:function(t,e){n.enabled(!1,e)},restrict:"C",template:"<span><span></span></span>"}}];

},{}],94:[function(require,module,exports){
"use strict";module.exports=function(){return{link:function(e,n,o){function t(){var n=l.clientHeight,t=l.scrollHeight;c.scrollY+n>=t-n?r&&(r=!1,e.$apply(o.windowScroll)):r=!0}var r=!0,l=n.prop("ownerDocument").documentElement,c=n.prop("ownerDocument").defaultView;c.addEventListener("scroll",t,!1),e.$on("$destroy",function(){c.removeEventListener("scroll",t)})}}};

},{}],95:[function(require,module,exports){
"use strict";function isEmpty(t){return!t||!t.text&&0===t.tags.length}function DraftStore(){function t(t,i){return t.model.$tag&&i.$tag===t.model.$tag||t.model.id&&i.id===t.model.id}this._drafts=[],this.count=function(){return this._drafts.length},this.unsaved=function(){return this._drafts.filter(function(t){return!t.model.id}).map(function(t){return t.model})},this.get=function(i){for(var r=0;r<this._drafts.length;r++){var e=this._drafts[r];if(t(e,i))return{isPrivate:e.isPrivate,tags:e.tags,text:e.text}}return null},this.getIfNotEmpty=function(t){var i=this.get(t);return isEmpty(i)?null:i},this.update=function(t,i){var r={model:{id:t.id,$tag:t.$tag},isPrivate:i.isPrivate,tags:i.tags,text:i.text};this.remove(t),this._drafts.push(r)},this.remove=function(i){this._drafts=this._drafts.filter(function(r){return!t(r,i)})},this.discard=function(){this._drafts=[]}}module.exports=function(){return new DraftStore};

},{}],96:[function(require,module,exports){
"use strict";module.exports={FRAME_CONNECTED:"frameConnected",GROUPS_CHANGED:"groupsChanged",USER_CHANGED:"userChanged",OAUTH_TOKENS_CHANGED:"oauthTokensChanged",GROUP_FOCUSED:"groupFocused",BEFORE_ANNOTATION_CREATED:"beforeAnnotationCreated",ANNOTATIONS_SYNCED:"sync",ANNOTATION_CREATED:"annotationCreated",ANNOTATION_DELETED:"annotationDeleted",ANNOTATION_FLAGGED:"annotationFlagged",ANNOTATION_UPDATED:"annotationUpdated",ANNOTATIONS_LOADED:"annotationsLoaded",ANNOTATIONS_UNLOADED:"annotationsUnloaded"};

},{}],97:[function(require,module,exports){
"use strict";function features(e,t,r,n){function s(t){if(n.load(),!n.state.features)return!1;var r=n.state.features;return t in r?r[t]:(e.warn("looked up unknown feature",t),!1)}var a=function(){var e=n.state.features;r.call(bridgeEvents.FEATURE_FLAGS_UPDATED,e||{})};return t.$on(events.USER_CHANGED,a),t.$on(events.FRAME_CONNECTED,a),{flagEnabled:s}}features.$inject=["$log","$rootScope","bridge","session"];var events=require("./events"),bridgeEvents=require("../shared/bridge-events");module.exports=features;

},{"../shared/bridge-events":43,"./events":96}],98:[function(require,module,exports){
"use strict";function encode(e){return e?window.encodeURIComponent(e):""}module.exports={encode:encode};

},{}],99:[function(require,module,exports){
"use strict";function flash(n){return{info:n.info.bind(n),success:n.success.bind(n),warning:n.warning.bind(n),error:n.error.bind(n)}}flash.$inject=["toastr"],module.exports=flash;

},{}],100:[function(require,module,exports){
"use strict";function formatAnnot(n){return{tag:n.$tag,msg:{document:n.document,target:n.target,uri:n.uri}}}function FrameSync(n,t,o,e,a){function i(){var n=[],t=[],o=0;e.subscribe(function(){var i=e.getState();if(i.annotations!==n||i.frames!==t){var r=0,s=new Set,c=[];i.annotations.forEach(function(n){metadata.isReply(n)||(metadata.isPublic(n)&&++r,s.add(n.$tag),u.has(n.$tag)||c.push(n))});var d=n.filter(function(n){return!s.has(n.$tag)});n=i.annotations,t=i.frames,c.length>0&&(a.call("loadAnnotations",c.map(formatAnnot)),c.forEach(function(n){u.add(n.$tag)})),d.forEach(function(n){a.call("deleteAnnotation",formatAnnot(n)),u.delete(n.$tag)});var f=e.frames();f.length>0&&f.every(function(n){return n.isAnnotationFetchComplete})&&(0!==r&&r===o||(a.call(bridgeEvents.PUBLIC_ANNOTATION_COUNT_CHANGED,r),o=r))}})}function r(){a.on("beforeCreateAnnotation",function(t){u.add(t.tag);var o=Object.assign({},t.msg,{$tag:t.tag});n.$broadcast(events.BEFORE_ANNOTATION_CREATED,o)}),a.on("destroyFrame",c.bind(this));var t={},o=debounce(function(){e.updateAnchorStatus(t),n.$broadcast(events.ANNOTATIONS_SYNCED,Object.keys(t)),t={}},10);a.on("sync",function(n){n.forEach(function(n){u.add(n.tag),t[n.tag]=n.msg.$orphan?"orphan":"anchored",o()})}),a.on("showAnnotations",function(n){e.selectAnnotations(e.findIDsForTags(n)),e.selectTab(uiConstants.TAB_ANNOTATIONS)}),a.on("showBucketList",function(t){n.$broadcast(events.SHOW_BUCKET_LIST,e.findIDsForTags(t))}),a.on("focusAnnotations",function(n){e.focusAnnotations(n||[])}),a.on("toggleAnnotationSelection",function(n){e.toggleSelectedAnnotations(e.findIDsForTags(n))}),a.on("sidebarOpened",function(){n.$broadcast("sidebarOpened")}),a.on("showSidebar",function(){a.call("showSidebar")}),a.on("hideSidebar",function(){a.call("hideSidebar")}),a.on("setVisibleHighlights",function(n){a.call("setVisibleHighlights",n)})}function s(t){t.call("getDocumentInfo",function(o,a){if(o)return void t.destroy();n.$broadcast(events.FRAME_CONNECTED),e.connectFrame({id:a.frameIdentifier,metadata:a.metadata,uri:a.uri})})}function c(n){var t=e.frames(),o=t.find(function(t){return t.id===n});o&&e.destroyFrame(o)}var u=new Set;this.connect=function(){new o(window,{server:!0}).startDiscovery(a.createChannel.bind(a)),a.onConnect(s),i(),r()},this.focusAnnotations=function(n){a.call("focusAnnotations",n)},this.scrollToAnnotation=function(n){a.call("scrollToAnnotation",n)}}FrameSync.$inject=["$rootScope","$window","Discovery","annotationUI","bridge"];var debounce=require("lodash.debounce"),events=require("./events"),bridgeEvents=require("../shared/bridge-events"),metadata=require("./annotation-metadata"),uiConstants=require("./ui-constants");module.exports={default:FrameSync,formatAnnot:formatAnnot};

},{"../shared/bridge-events":43,"./annotation-metadata":52,"./events":96,"./ui-constants":168,"lodash.debounce":6}],101:[function(require,module,exports){
"use strict";var loaded=!1;module.exports=function(e){loaded||(loaded=!0,function(e,t,a,o,c,n,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,n=t.createElement(a),s=t.getElementsByTagName(a)[0],n.async=1,n.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(n,s)}(window,document,"script",0,"ga"),ga("create",e,"auto"),ga("set","checkProtocolTask",null))};

},{}],102:[function(require,module,exports){
"use strict";function getApiUrl(r){var e=serviceConfig(r);if(e){if(e.apiUrl)return e.apiUrl;throw new Error("Service should contain an apiUrl value.")}return r.apiUrl}var serviceConfig=require("./service-config");module.exports=getApiUrl;

},{"./service-config":128}],103:[function(require,module,exports){
"use strict";function groups(e,r,t,n,o){function u(){return t.state.groups||[]}function s(e){for(var r=u(),t=0,n=r.length;t<n;t++)if(r[t].id===e)return r[t];return null}function i(e){return o.group.member.delete({pubid:e,user:"me"})}function c(){if(f)return f;var r=s(e.getItem(STORAGE_KEY));return r?f=r:u()[0]}function a(r){var t=c(),o=s(r);o&&(f=o,e.setItem(STORAGE_KEY,o.id),t.id!==o.id&&n.$broadcast(events.GROUP_FOCUSED,o.id))}var f;return n.$on(events.GROUPS_CHANGED,function(){f&&((f=s(f.id))||n.$broadcast(events.GROUP_FOCUSED,c()))}),{all:u,get:s,leave:i,focused:c,focus:a}}groups.$inject=["localStorage","serviceUrl","session","$rootScope","store"];var STORAGE_KEY="hypothesis.groups.focus",events=require("./events");module.exports=groups;

},{"./events":96}],104:[function(require,module,exports){
"use strict";function hostPageConfig(e){var n=queryString.parse(e.location.search).config,r=JSON.parse(n||"{}"),i=["annotations","query","appType","openSidebar","showHighlights","services","branding","onElementClick","isHighlightBtnVisible","locale","enableExperimentalNewNoteButton","theme","usernameUrl"];return Object.keys(r).reduce(function(e,n){return-1!==i.indexOf(n)&&null!==r[n]&&(e[n]=r[n]),e},{})}var queryString=require("query-string");module.exports=hostPageConfig;

},{"query-string":20}],105:[function(require,module,exports){
"use strict";function configureLocation(e){return e.html5Mode(!0)}function configureRoutes(e){e.when("/a/:id",{template:'<annotation-viewer-content search="vm.search"></annotation-viewer-content>',reloadOnSearch:!1,resolve:resolve}),e.when("/stream",{template:'<stream-content search="vm.search"></stream-content>',reloadOnSearch:!1,resolve:resolve}),e.otherwise({template:'<sidebar-content search="vm.search" auth="vm.auth"></sidebar-content>',reloadOnSearch:!1,resolve:resolve})}function configureToastr(e){angular.extend(e,{preventOpenDuplicates:!0})}function configureTranslate(e){translateProvider.translate(e),e.preferredLanguage(settings.locale)}function setupHttp(e,r){e.defaults.headers.common["X-Client-Id"]=r.clientId}function processAppOpts(){settings.liveReloadServer&&require("./live-reload-client").connect(settings.liveReloadServer)}configureLocation.$inject=["$locationProvider"],configureRoutes.$inject=["$routeProvider"],configureToastr.$inject=["toastrConfig"],configureTranslate.$inject=["$translateProvider"],setupHttp.$inject=["$http","streamer"];var addAnalytics=require("./ga"),disableOpenerForExternalLinks=require("./util/disable-opener-for-external-links"),getApiUrl=require("./get-api-url"),serviceConfig=require("./service-config"),crossOriginRPC=require("./cross-origin-rpc.js"),translateProvider=require("./translate-provider.js");require("../shared/polyfills");var raven,settings=require("../shared/settings").jsonConfigsFrom(document);settings.raven&&(raven=require("./raven"),raven.init(settings.raven));var hostPageConfig=require("./host-config");Object.assign(settings,hostPageConfig(window)),settings.apiUrl=getApiUrl(settings),document.body.setAttribute("ng-csp",""),disableOpenerForExternalLinks(document.body);var angular=require("angular");require("autofill-event"),settings.raven?raven.angularModule(angular):angular.module("ngRaven",[]),settings.googleAnalytics&&addAnalytics(settings.googleAnalytics);var resolve={sessionState:["session",function(e){return e.load()}]};module.exports=angular.module("h",[require("angular-route"),require("angular-sanitize"),require("angular-toastr"),require("angular-translate"),["angulartics",require("angulartics")][0],["angulartics.google.analytics",require("angulartics/src/angulartics-ga")][0],["ngTagsInput",require("ng-tags-input")][0],["ui.bootstrap",require("./vendor/ui-bootstrap-custom-tpls-0.13.4")][0],"ngRaven"]).component("hypothesisApp",require("./components/hypothesis-app")).component("annotation",require("./components/annotation")).component("annotationHeader",require("./components/annotation-header")).component("annotationActionButton",require("./components/annotation-action-button")).component("annotationShareDialog",require("./components/annotation-share-dialog")).component("annotationThread",require("./components/annotation-thread")).component("annotationViewerContent",require("./components/annotation-viewer-content")).component("dropdownMenuBtn",require("./components/dropdown-menu-btn")).component("excerpt",require("./components/excerpt")).component("groupList",require("./components/group-list")).component("helpLink",require("./components/help-link")).component("helpPanel",require("./components/help-panel")).component("loggedoutMessage",require("./components/loggedout-message")).component("loginControl",require("./components/login-control")).component("markdown",require("./components/markdown")).component("moderationBanner",require("./components/moderation-banner")).component("newNoteBtn",require("./components/new-note-btn")).component("publishAnnotationBtn",require("./components/publish-annotation-btn")).component("searchInput",require("./components/search-input")).component("searchStatusBar",require("./components/search-status-bar")).component("selectionTabs",require("./components/selection-tabs")).component("sidebarContent",require("./components/sidebar-content")).component("sidebarTutorial",require("./components/sidebar-tutorial")).component("shareDialog",require("./components/share-dialog")).component("sortDropdown",require("./components/sort-dropdown")).component("streamContent",require("./components/stream-content")).component("svgIcon",require("./components/svg-icon")).component("tagEditor",require("./components/tag-editor")).component("threadList",require("./components/thread-list")).component("timestamp",require("./components/timestamp")).component("topBar",require("./components/top-bar")).directive("hAutofocus",require("./directive/h-autofocus")).directive("hBranding",require("./directive/h-branding")).directive("hOnTouch",require("./directive/h-on-touch")).directive("hTooltip",require("./directive/h-tooltip")).directive("spinner",require("./directive/spinner")).directive("windowScroll",require("./directive/window-scroll")).service("analytics",require("./analytics")).service("annotationMapper",require("./annotation-mapper")).service("annotationUI",require("./annotation-ui")).service("apiRoutes",require("./api-routes")).service("auth",require("./oauth-auth")).service("bridge",require("../shared/bridge")).service("drafts",require("./drafts")).service("features",require("./features")).service("flash",require("./flash")).service("frameSync",require("./frame-sync").default).service("groups",require("./groups")).service("localStorage",require("./local-storage")).service("permissions",require("./permissions")).service("queryParser",require("./query-parser")).service("rootThread",require("./root-thread")).service("searchFilter",require("./search-filter")).service("serviceUrl",require("./service-url")).service("session",require("./session")).service("streamer",require("./streamer")).service("streamFilter",require("./stream-filter")).service("tags",require("./tags")).service("unicode",require("./unicode")).service("viewFilter",require("./view-filter")).factory("store",require("./store")).value("Discovery",require("../shared/discovery")).value("ExcerptOverflowMonitor",require("./util/excerpt-overflow-monitor")).value("OAuthClient",require("./util/oauth-client")).value("VirtualThreadList",require("./virtual-thread-list")).value("random",require("./util/random")).value("raven",require("./raven")).value("serviceConfig",serviceConfig).value("settings",settings).value("time",require("./time")).value("urlEncodeFilter",require("./filter/url").encode).config(configureLocation).config(configureRoutes).config(configureToastr).config(configureTranslate).run(setupHttp).run(crossOriginRPC.server.start),processAppOpts(),window.chrome&&!window.chrome.app&&(window.chrome.app={dummyAddedByHypothesisClient:!0});var appEl=document.querySelector("hypothesis-app");angular.bootstrap(appEl,["h"],{strictDi:!0});

},{"../shared/bridge":44,"../shared/discovery":45,"../shared/polyfills":"/src/shared/polyfills.js","../shared/settings":47,"./analytics":50,"./annotation-mapper":51,"./annotation-ui":53,"./api-routes":54,"./components/annotation":61,"./components/annotation-action-button":56,"./components/annotation-header":57,"./components/annotation-share-dialog":58,"./components/annotation-thread":59,"./components/annotation-viewer-content":60,"./components/dropdown-menu-btn":62,"./components/excerpt":63,"./components/group-list":64,"./components/help-link":65,"./components/help-panel":66,"./components/hypothesis-app":67,"./components/loggedout-message":68,"./components/login-control":69,"./components/markdown":70,"./components/moderation-banner":71,"./components/new-note-btn":72,"./components/publish-annotation-btn":73,"./components/search-input":74,"./components/search-status-bar":75,"./components/selection-tabs":76,"./components/share-dialog":77,"./components/sidebar-content":78,"./components/sidebar-tutorial":79,"./components/sort-dropdown":80,"./components/stream-content":81,"./components/svg-icon":82,"./components/tag-editor":83,"./components/thread-list":84,"./components/timestamp":85,"./components/top-bar":86,"./cross-origin-rpc.js":87,"./directive/h-autofocus":89,"./directive/h-branding":90,"./directive/h-on-touch":91,"./directive/h-tooltip":92,"./directive/spinner":93,"./directive/window-scroll":94,"./drafts":95,"./features":97,"./filter/url":98,"./flash":99,"./frame-sync":100,"./ga":101,"./get-api-url":102,"./groups":103,"./host-config":104,"./live-reload-client":106,"./local-storage":107,"./oauth-auth":110,"./permissions":111,"./query-parser":112,"./raven":113,"./root-thread":125,"./search-filter":127,"./service-config":128,"./service-url":129,"./session":130,"./store":131,"./stream-filter":132,"./streamer":133,"./tags":135,"./time":166,"./translate-provider.js":167,"./unicode":169,"./util/disable-opener-for-external-links":172,"./util/excerpt-overflow-monitor":173,"./util/oauth-client":176,"./util/random":177,"./vendor/ui-bootstrap-custom-tpls-0.13.4":181,"./view-filter":182,"./virtual-thread-list":183,"angular":"angular","angular-route":"angular-route","angular-sanitize":"angular-sanitize","angular-toastr":"angular-toastr","angular-translate":"angular-translate","angulartics":1,"angulartics/src/angulartics-ga":"angulartics/src/angulartics-ga","autofill-event":2,"ng-tags-input":"ng-tags-input"}],106:[function(require,module,exports){
"use strict";function cacheBustURL(e){var n=e,t=queryString.parse({timestamp:Date.now()});return-1!==e.indexOf("?")?n+="&"+t:n+="?"+t,n}function didAssetChange(e,n){return n.some(function(n){return-1!==e.indexOf(n)})}function maybeReloadElement(e,n){var t=e.parentNode,r=e.cloneNode();["href","src"].forEach(function(t){t in e&&didAssetChange(e[t],n)&&(r[t]=cacheBustURL(e[t]))}),t.replaceChild(r,e)}function reloadExternalStyleSheets(e){[].slice.apply(document.querySelectorAll("link")).forEach(function(n){maybeReloadElement(n,e)})}function connect(e){var n=new Socket(e);n.on("open",function(){console.log("Live reload client listening")}),n.on("message",function(e){var n=JSON.parse(e.data);if("assets-changed"===n.type){var t=n.changed.some(function(e){return e.match(/\.(html|js)$/)}),r=n.changed.some(function(e){return e.match(/\.css$/)});if(t)return void window.top.postMessage({type:"reloadrequest"},"*");r&&reloadExternalStyleSheets(n.changed)}}),n.on("error",function(e){console.error("Error connecting to live reload server:",e)})}var queryString=require("query-string"),Socket=require("./websocket");module.exports={connect:connect};

},{"./websocket":184,"query-string":20}],107:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function localStorage(e){var t=void 0,n="hypothesis.testKey";try{t=e.localStorage,e.localStorage.setItem(n,n),e.localStorage.getItem(n),e.localStorage.removeItem(n)}catch(e){t=new InMemoryStorage}return{getItem:function(e){return t.getItem(e)},getObject:function(e){var n=t.getItem(e);return n?JSON.parse(n):null},setItem:function(e,n){t.setItem(e,n)},setObject:function(e,n){var r=JSON.stringify(n);t.setItem(e,r)},removeItem:function(e){t.removeItem(e)}}}localStorage.$inject=["$window"];var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),InMemoryStorage=function(){function e(){_classCallCheck(this,e),this._store={}}return _createClass(e,[{key:"getItem",value:function(e){return e in this._store?this._store[e]:null}},{key:"setItem",value:function(e,t){this._store[e]=t}},{key:"removeItem",value:function(e){delete this._store[e]}}]),e}();module.exports=localStorage;

},{}],108:[function(require,module,exports){
"use strict";function replaceText(e,t,n,l){var r=e.selectionStart,i=e.selectionEnd;return r>=t+n?(r+=l.length-n,i+=l.length-n):i<=t||(r<=t&&i>=t+n?i+=l.length-n:r<t&&i<t+n?r=t:r<t+n&&i>t+n?i+=l.length-n:t<r&&t+n>i&&(r=t,i=t+n)),{text:e.text.slice(0,t)+l+e.text.slice(t+n),selectionStart:r,selectionEnd:i}}function convertSelectionToLink(e,t){void 0===t&&(t=LinkType.ANCHOR_LINK);var n=e.text.slice(e.selectionStart,e.selectionEnd),l="";t===LinkType.IMAGE_LINK&&(l="!");var r;if(n.match(/[a-z]+:\/\/.*/)){return r=replaceText(e,e.selectionStart,n.length,l+"[Description]("+n+")"),r.selectionStart=e.selectionStart+l.length+1,r.selectionEnd=r.selectionStart+"Description".length,r}var i=l+"["+n+"](",c="http://insert-your-link-here.com";return r=replaceText(e,e.selectionStart,n.length,i+c+")"),r.selectionStart=e.selectionStart+i.length,r.selectionEnd=r.selectionStart+c.length,r}function toggleSpanStyle(e,t,n,l){void 0===n&&(n=t);var r=e.text.slice(e.selectionStart-t.length,e.selectionStart),i=e.text.slice(e.selectionEnd,e.selectionEnd+t.length),c=e;return e.selectionStart===e.selectionEnd&&l&&(c=replaceText(e,e.selectionStart,0,l),c.selectionStart=c.selectionEnd-l.length),r===t&&i===n?(c=replaceText(c,c.selectionStart-t.length,t.length,""),c=replaceText(c,c.selectionEnd,n.length,"")):(c=replaceText(c,c.selectionStart,0,t),c=replaceText(c,c.selectionEnd,0,n)),c}function startOfLine(e,t){var n=e.lastIndexOf("\n",t);return n<0?0:n+1}function endOfLine(e,t){var n=e.indexOf("\n",t);return n<0?e.length:n}function transformLines(e,t,n,l){for(var r=startOfLine(e.text,t),i=endOfLine(e.text,t);i<=endOfLine(e.text,n);){var c=i===e.text.length,o=i-r;e=l(e,r,i);var s=endOfLine(e.text,r)-r;if(n+=s-o,c)break;r=r+s+1,i=endOfLine(e.text,r)}return e}function toggleBlockStyle(e,t){var n=e.selectionStart,l=e.selectionEnd,r=!0;return transformLines(e,n,l,function(e,n){return e.text.slice(n,n+t.length)!==t&&(r=!1),e}),r?transformLines(e,n,l,function(e,n){return replaceText(e,n,t.length,"")}):transformLines(e,n,l,function(e,n){return e.text.slice(n,n+t.length)===t?e:replaceText(e,n,0,t)})}var LinkType={ANCHOR_LINK:0,IMAGE_LINK:1};module.exports={toggleSpanStyle:toggleSpanStyle,toggleBlockStyle:toggleBlockStyle,convertSelectionToLink:convertSelectionToLink,LinkType:LinkType};

},{}],109:[function(require,module,exports){
"use strict";function audioElement(e){var r=document.createElement("audio");return r.controls=!0,r.src=e,r}function iframe(e){var r=document.createElement("iframe");return r.src=e,r.classList.add("annotation-media-embed"),r.setAttribute("frameborder","0"),r.setAttribute("allowfullscreen",""),r}function parseTimeString(e){for(var r,t=/(\d+)([hms]?)/g,n={h:3600,m:60,s:1},a=0;null!==(r=t.exec(e));)r[2]?a+=r[1]*n[r[2]]:a+=+r[1];return a.toString()}function youTubeQueryParams(e){var r,t=["end","start","t"],n=queryString.parse(e.search),a={};return Object.keys(n).filter(function(e){return t.includes(e)}).forEach(function(e){"t"===e?a.start=parseTimeString(n[e]):a[e]=n[e]}),r=queryString.stringify(a),r&&(r="?"+r),r}function youTubeEmbed(e,r){return iframe("https://www.youtube.com/embed/"+e+youTubeQueryParams(r))}function vimeoEmbed(e){return iframe("https://player.vimeo.com/video/"+e)}function embedForLink(e){var r,t;for(t=0;t<embedGenerators.length;t++)if(r=embedGenerators[t](e))return r;return null}function replaceLinkWithEmbed(e){if(e.href===e.textContent){var r=embedForLink(e);r&&e.parentElement.replaceChild(r,e)}}function replaceLinksWithEmbeds(e){var r=e.getElementsByTagName("a");r=Array.prototype.slice.call(r,0);var t;for(t=0;t<r.length;t++)replaceLinkWithEmbed(r[t])}var queryString=require("query-string"),embedGenerators=[function(e){if("www.youtube.com"!==e.hostname)return null;if(!/\/watch\/?/.test(e.pathname))return null;var r=/[&\?]v=([^&#]+)/.exec(e.search);return r?youTubeEmbed(r[1],e):null},function(e){if("youtu.be"!==e.hostname)return null;var r=/^\/([^\/]+)\/?$/.exec(e.pathname);return r?youTubeEmbed(r[1],e):null},function(e){if("vimeo.com"!==e.hostname)return null;var r=/^\/([^\/\?#]+)\/?$/.exec(e.pathname);return r?vimeoEmbed(r[1]):null},function(e){if("vimeo.com"!==e.hostname)return null;var r=/^\/channels\/[^\/]+\/([^\/?#]+)\/?$/.exec(e.pathname);return r?vimeoEmbed(r[1]):null},function(e){if("archive.org"!==e.hostname)return null;var r=/^\/(embed|details)\/(.+)/.exec(e.pathname);if(!r)return null;var t=r[2],n=queryString.parse(e.search),a=n.start,u=n.end;if(!a){var i=t.match(/\/start\/([^\/]+)/);i&&(a=i[1],t=t.replace(i[0],""))}if(!u){var m=t.match(/\/end\/([^\/]+)/);m&&(u=m[1],t=t.replace(m[0],""))}var o=new URL("https://archive.org/embed/"+t);return a&&o.searchParams.append("start",a),u&&o.searchParams.append("end",u),iframe(o.href)},function(e){return e.pathname.endsWith(".mp3")||e.pathname.endsWith(".ogg")||e.pathname.endsWith(".wav")?audioElement(e.href):null}];module.exports={replaceLinksWithEmbeds:replaceLinksWithEmbeds};

},{"query-string":20}],110:[function(require,module,exports){
"use strict";function auth(e,n,t,r,o,i,u,s,a){function c(e){var n=a("translate")("Hypothesis login lost");i.error(e,n,{extendedTimeOut:0,tapToDismiss:!1,timeOut:0})}function l(){var e=new URL(s.apiUrl).hostname;return"hypothesis.oauth."+(e=e.replace(/\./g,"%2E"))+".token"}function f(){var e=u.getObject(l());return e&&"string"==typeof e.accessToken&&"string"==typeof e.refreshToken&&"number"==typeof e.expiresAt?{accessToken:e.accessToken,refreshToken:e.refreshToken,expiresAt:e.expiresAt}:null}function h(e){u.setObject(l(),e)}function v(e,n){return p().then(function(n){return n.refreshToken(e)}).then(function(e){return n.persist&&h(e),e})}function p(){return y?Promise.resolve(y):o.links().then(function(n){return y=new r(e,{clientId:s.oauthClientId,authorizationEndpoint:n["oauth.authorize"],revokeEndpoint:n["oauth.revoke"],tokenEndpoint:A})})}function k(){if(!m){var e=serviceConfig(s);if(e&&void 0!==e.grantToken)m=e.grantToken?p().then(function(n){return n.exchangeGrantToken(e.grantToken)}).catch(function(e){throw c("You must reload the page to annotate."),e}):Promise.resolve(null);else if(g){var n=g;g=null,m=p().then(function(e){return e.exchangeAuthCode(n)}).then(function(e){return h(e),e})}else m=Promise.resolve(f())}var t=m;return m.then(function(e){if(!e)return null;if(t!==m)return k();if(Date.now()>e.expiresAt){var n=!0,r=serviceConfig(s);return r&&void 0!==r.grantToken&&(n=!1),m=v(e.refreshToken,{persist:n}).then(function(e){if(Date.now()>e.expiresAt)throw new Error("Refreshed token expired in the past");return e}).catch(function(){return null}),k()}return e.accessToken})}function d(){var e=r.openAuthPopupWindow(t);return p().then(function(n){return n.authorize(t,e)}).then(function(e){g=e,m=null})}function T(){return Promise.all([m,p()]).then(function(e){var n=_slicedToArray(e,2),t=n[0];return n[1].revokeToken(t.accessToken)}).then(function(){m=Promise.resolve(null),u.removeItem(l())})}var g,m,y,A=resolve("token",s.apiUrl);return function(){t.addEventListener("storage",function(e){e.key===l()&&(m=null,n.$broadcast(events.OAUTH_TOKENS_CHANGED))})}(),{login:d,logout:T,tokenGetter:k}}auth.$inject=["$http","$rootScope","$window","OAuthClient","apiRoutes","flash","localStorage","settings","$filter"];var _slicedToArray=function(){function e(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(t.push(u.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),events=require("./events"),resolve=require("./util/url-util").resolve,serviceConfig=require("./service-config");module.exports=auth;

},{"./events":96,"./service-config":128,"./util/url-util":180}],111:[function(require,module,exports){
"use strict";function Permissions(e){function t(){var t=e.getItem(STORAGE_KEY);switch(t){case"private":case"shared":return t;default:return"shared"}}var r=this;this.private=function(e){return{read:[e],update:[e],delete:[e]}},this.shared=function(e,t){return Object.assign(r.private(e),{read:["group:"+t]})},this.default=function(e,i){return"private"===t()?r.private(e):r.shared(e,i)},this.setDefault=function(t){e.setItem(STORAGE_KEY,t)},this.isShared=function(e){return e.read.some(function(e){return 0===e.indexOf("group:")})},this.permits=function(e,t,r){return-1!==e[t].indexOf(r)}}Permissions.$inject=["localStorage"];var STORAGE_KEY="hypothesis.privacy";module.exports=Permissions;

},{}],112:[function(require,module,exports){
var QueryParser,bind=function(t,r){return function(){return t.apply(r,arguments)}};module.exports=QueryParser=function(){function t(){this.populateFilter=bind(this.populateFilter,this)}return t.prototype.rules={user:{path:"/user",and_or:"or"},text:{path:"/text",and_or:"and"},tag:{path:"/tags",and_or:"and"},quote:{path:"/quote",and_or:"and"},uri:{formatter:function(t){return t.toLowerCase()},path:"/uri",and_or:"or",options:{es:{query_type:"match",cutoff_frequency:.001,and_or:"and"}}},since:{formatter:function(t){var r;return r=function(){switch(t){case"5 min":return 300;case"30 min":return 1800;case"1 hour":return 3600;case"12 hours":return 43200;case"1 day":return 86400;case"1 week":return 604800;case"1 month":return 2592e3;case"1 year":return 31536e3}}(),new Date((new Date).valueOf()-1e3*r)},path:"/created",and_or:"and",operator:"ge"},any:{and_or:"and",path:["/quote","/tags","/text","/uri","/user"],options:{es:{query_type:"multi_match",match_type:"cross_fields",and_or:"and",fields:["quote","tags","text","uri.parts","user"]}}}},t.prototype.populateFilter=function(t,r){var e,a,n,o,u,s,i,p,l,c,h,d,f,_,m;p=[];for(n in r)if(_=r[n],null!=this.rules[n]&&(d=_.terms,d.length))if(l=this.rules[n],a=null!=l.case_sensitive&&l.case_sensitive,e=null!=l.and_or?l.and_or:"or",s=null!=l.path?l.path:"/"+n,"or"===e){for(i=null!=l.operator?l.operator:"match_of",m=[],o=0,u=d.length;o<u;o++)h=d[o],c=l.formatter?l.formatter(h):h,m.push(c);p.push(t.addClause(s,i,m,a,l.options))}else i=null!=l.operator?l.operator:"matches",p.push(function(){var r,e,n;for(n=[],r=0,e=d.length;r<e;r++)f=d[r],m=l.formatter?l.formatter(f):f,n.push(t.addClause(s,i,m,a,l.options));return n}());return p},t}();

},{}],113:[function(require,module,exports){
"use strict";function convertLocalURLsToFilenames(e){return e?e.match(/https?:/)?e:e.replace(/\?.*/,"").split("/").slice(-1)[0]:e}function translateSourceURLs(e){try{var n=e.exception.values[0].stacktrace.frames;n.forEach(function(e){e.filename=convertLocalURLsToFilenames(e.filename)}),e.culprit=n[0].filename}catch(n){console.warn("Failed to normalize error stack trace",n,e)}return e}function init(e){Raven.config(e.dsn,{release:"1.64.0",dataCallback:translateSourceURLs}).install(),installUnhandledPromiseErrorHandler()}function setUserInfo(e){e?Raven.setUserContext(e):Raven.setUserContext()}function angularModule(e){var n=Raven._globalOptions.dataCallback;angularPlugin(Raven,e);var a=Raven._globalOptions.dataCallback;return Raven.setDataCallback(function(e){return a(n(e))}),e.module("ngRaven")}function report(e,n,a){e instanceof Error||"object"===(void 0===e?"undefined":_typeof(e))&&e.message&&(e=e.message);var t=Object.assign({when:n},a);Raven.captureException(e,{extra:t})}function installUnhandledPromiseErrorHandler(){window.addEventListener("unhandledrejection",function(e){e.reason&&report(e.reason,"Unhandled Promise rejection")})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Raven=require("raven-js"),angularPlugin=require("raven-js/plugins/angular");module.exports={init:init,angularModule:angularModule,setUserInfo:setUserInfo,report:report};

},{"raven-js":"raven-js","raven-js/plugins/angular":21}],114:[function(require,module,exports){
"use strict";function excludeAnnotations(n,t){var a={},i={};return t.forEach(function(n){n.id&&(a[n.id]=!0),n.$tag&&(i[n.$tag]=!0)}),n.filter(function(n){return!(n.id&&n.id in a||n.$tag&&n.$tag in i)})}function findByID(n,t){return n.find(function(n){return n.id===t})}function findByTag(n,t){return n.find(function(n){return n.$tag===t})}function initializeAnnot(n,t){var a=n.$orphan;return n.id||(a=!1),Object.assign({},n,{$anchorTimeout:!1,$tag:n.$tag||t,$orphan:a})}function init(){return{annotations:[],nextTag:1}}function updateFlagStatus(n,t){return{type:actions.UPDATE_FLAG_STATUS,id:n,isFlagged:t}}function addAnnotations(n,t){return t=t||new Date,n=n.map(function(n){return n.id?n:Object.assign({created:t.toISOString(),updated:t.toISOString()},n)}),function(t,a){var i=n.filter(function(n){return!findByID(a().annotations,n.id)});if(t({type:actions.ADD_ANNOTATIONS,annotations:n}),a().isSidebar){var o=i.filter(metadata.isWaitingToAnchor).map(function(n){return n.id});o.length>0&&setTimeout(function(){var n=a().annotations,i=o.map(function(t){return findByID(n,t)}).filter(function(n){return n&&metadata.isWaitingToAnchor(n)}),e=i.reduce(function(n,t){return n[t.$tag]="timeout",n},{});t(updateAnchorStatus(e))},500)}}}function removeAnnotations(n){return{type:actions.REMOVE_ANNOTATIONS,annotations:n}}function clearAnnotations(){return{type:actions.CLEAR_ANNOTATIONS}}function updateAnchorStatus(n){return{type:actions.UPDATE_ANCHOR_STATUS,statusUpdates:n}}function hideAnnotation(n){return{type:actions.HIDE_ANNOTATION,id:n}}function unhideAnnotation(n){return{type:actions.UNHIDE_ANNOTATION,id:n}}function savedAnnotations(n){return n.annotations.filter(function(n){return!metadata.isNew(n)})}function annotationExists(n,t){return n.annotations.some(function(n){return n.id===t})}function findIDsForTags(n,t){var a=[];return t.forEach(function(t){var i=findByTag(n.annotations,t);i&&i.id&&a.push(i.id)}),a}function findAnnotationByID(n,t){return findByID(n.annotations,t)}var arrayUtil=require("../util/array-util"),metadata=require("../annotation-metadata"),uiConstants=require("../ui-constants"),selection=require("./selection"),util=require("./util"),update={ADD_ANNOTATIONS:function(n,t){var a={},i={},o=[],e=[],r=[],u=n.nextTag;return t.annotations.forEach(function(t){var e;t.id&&(e=findByID(n.annotations,t.id)),!e&&t.$tag&&(e=findByTag(n.annotations,t.$tag)),e?(r.push(Object.assign({},e,t)),t.id&&(a[t.id]=!0),e.$tag&&(i[e.$tag]=!0)):(o.push(initializeAnnot(t,"t"+u)),++u)}),n.annotations.forEach(function(n){a[n.id]||i[n.$tag]||e.push(n)}),{annotations:o.concat(r).concat(e),nextTag:u}},REMOVE_ANNOTATIONS:function(n,t){var a=excludeAnnotations(n.annotations,t.annotations),i=n.selectedTab;i===uiConstants.TAB_ORPHANS&&0===arrayUtil.countIf(a,metadata.isOrphan)&&(i=uiConstants.TAB_ANNOTATIONS);var o=selection.update.SELECT_TAB;return Object.assign({annotations:a},o(n,selection.actions.selectTab(i)))},CLEAR_ANNOTATIONS:function(){return{annotations:[]}},UPDATE_FLAG_STATUS:function(n,t){return{annotations:n.annotations.map(function(n){if(n.id&&n.id===t.id){if(n.flagged===t.isFlagged)return n;var a=Object.assign({},n,{flagged:t.isFlagged});if(a.moderation){var i=t.isFlagged?1:-1;a.moderation=Object.assign({},n.moderation,{flagCount:n.moderation.flagCount+i})}return a}return n})}},UPDATE_ANCHOR_STATUS:function(n,t){return{annotations:n.annotations.map(function(n){if(!t.statusUpdates.hasOwnProperty(n.$tag))return n;var a=t.statusUpdates[n.$tag];return"timeout"===a?Object.assign({},n,{$anchorTimeout:!0}):Object.assign({},n,{$orphan:"orphan"===a})})}},HIDE_ANNOTATION:function(n,t){return{annotations:n.annotations.map(function(n){return n.id!==t.id?n:Object.assign({},n,{hidden:!0})})}},UNHIDE_ANNOTATION:function(n,t){return{annotations:n.annotations.map(function(n){return n.id!==t.id?n:Object.assign({},n,{hidden:!1})})}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{addAnnotations:addAnnotations,clearAnnotations:clearAnnotations,removeAnnotations:removeAnnotations,updateAnchorStatus:updateAnchorStatus,updateFlagStatus:updateFlagStatus,hideAnnotation:hideAnnotation,unhideAnnotation:unhideAnnotation},annotationExists:annotationExists,findAnnotationByID:findAnnotationByID,findIDsForTags:findIDsForTags,savedAnnotations:savedAnnotations};

},{"../annotation-metadata":52,"../ui-constants":168,"../util/array-util":171,"./selection":119,"./util":121}],115:[function(require,module,exports){
"use strict";function debugMiddleware(e){var o=0;return function(t){return function(n){if(!window.debug)return void t(n);++o;var r=n.type+" ("+o.toString()+")";console.group(r),console.log("Prev State:",e.getState()),console.log("Action:",n),t(n),console.log("Next State:",e.getState()),console.groupEnd(r)}}}module.exports=debugMiddleware;

},{}],116:[function(require,module,exports){
"use strict";function init(){return{frames:[]}}function connectFrame(t){return{type:actions.CONNECT_FRAME,frame:t}}function destroyFrame(t){return{type:actions.DESTROY_FRAME,frame:t}}function updateFrameAnnotationFetchStatus(t,e){return{type:actions.UPDATE_FRAME_ANNOTATION_FETCH_STATUS,isAnnotationFetchComplete:e,uri:t}}function frames(t){return t.frames}function searchUrisForFrame(t){var e=[t.uri];return t.metadata&&t.metadata.documentFingerprint&&(e=t.metadata.link.map(function(t){return t.href})),t.metadata&&t.metadata.link&&t.metadata.link.forEach(function(t){t.href.startsWith("doi:")&&e.push(t.href)}),e}function searchUris(t){return t.frames.reduce(function(t,e){return t.concat(searchUrisForFrame(e))},[])}var util=require("./util"),update={CONNECT_FRAME:function(t,e){return{frames:t.frames.concat(e.frame)}},DESTROY_FRAME:function(t,e){return{frames:t.frames.filter(function(t){return t!==e.frame})}},UPDATE_FRAME_ANNOTATION_FETCH_STATUS:function(t,e){return{frames:t.frames.map(function(t){return t.uri&&t.uri===e.uri?Object.assign({},t,{isAnnotationFetchComplete:e.isAnnotationFetchComplete}):t})}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{connectFrame:connectFrame,destroyFrame:destroyFrame,updateFrameAnnotationFetchStatus:updateFrameAnnotationFetchStatus},frames:frames,searchUris:searchUris};

},{"./util":121}],117:[function(require,module,exports){
"use strict";function init(e){return Object.assign({},annotations.init(),frames.init(),links.init(),selection.init(e),session.init(),viewer.init())}var annotations=require("./annotations"),frames=require("./frames"),links=require("./links"),selection=require("./selection"),session=require("./session"),viewer=require("./viewer"),util=require("./util"),update=util.createReducer(Object.assign(annotations.update,frames.update,links.update,selection.update,session.update,viewer.update));module.exports={init:init,update:update};

},{"./annotations":114,"./frames":116,"./links":118,"./selection":119,"./session":120,"./util":121,"./viewer":122}],118:[function(require,module,exports){
"use strict";function init(){return{links:null}}function updateLinks(n,i){return{links:i.newLinks}}function updateLinksAction(n){return{type:"UPDATE_LINKS",newLinks:n}}module.exports={init:init,update:{UPDATE_LINKS:updateLinks},actions:{updateLinks:updateLinksAction}};

},{}],119:[function(require,module,exports){
"use strict";function initialSelection(t){var e={};return t.annotations&&!t.query&&(e[t.annotations]=!0),freeze(e)}function freeze(t){return Object.keys(t).length?immutable(t):null}function init(t){return{focusedAnnotationMap:null,selectedAnnotationMap:initialSelection(t),expanded:initialSelection(t)||{},forceVisible:{},highlighted:[],filterQuery:t.query||null,selectedTab:TAB_DEFAULT,sortKey:TAB_SORTKEY_DEFAULT[TAB_DEFAULT],sortKeysAvailable:TAB_SORTKEYS_AVAILABLE[TAB_DEFAULT]}}function select(t){return{type:actions.SELECT_ANNOTATIONS,selection:freeze(t)}}function selectAnnotations(t){return select(toSet(t))}function toggleSelectedAnnotations(t){return function(e,n){for(var o=Object.assign({},n().selectedAnnotationMap),i=0;i<t.length;i++){var s=t[i];o[s]?delete o[s]:o[s]=!0}e(select(o))}}function setForceVisible(t,e){return function(n,o){var i=Object.assign({},o().forceVisible);i[t]=e,n({type:actions.SET_FORCE_VISIBLE,forceVisible:i})}}function focusAnnotations(t){return{type:actions.FOCUS_ANNOTATIONS,focused:freeze(toSet(t))}}function setCollapsed(t,e){return function(n,o){var i=Object.assign({},o().expanded);i[t]=!e,n({type:actions.SET_EXPANDED,expanded:i})}}function highlightAnnotations(t){return{type:actions.HIGHLIGHT_ANNOTATIONS,highlighted:t}}function selectTab(t){return{type:actions.SELECT_TAB,tab:t}}function setFilterQuery(t){return{type:actions.SET_FILTER_QUERY,query:t}}function setSortKey(t){return{type:actions.SET_SORT_KEY,key:t}}function isAnnotationSelected(t,e){return(t.selectedAnnotationMap||{}).hasOwnProperty(e)}function hasSelectedAnnotations(t){return!!t.selectedAnnotationMap}function removeSelectedAnnotation(t){return function(e,n){var o=Object.assign({},n().selectedAnnotationMap);o&&t&&(delete o[t],e(select(o)))}}function clearSelectedAnnotations(){return{type:actions.CLEAR_SELECTION}}var immutable=require("seamless-immutable"),toSet=require("../util/array-util").toSet,uiConstants=require("../ui-constants"),util=require("./util"),TAB_DEFAULT=uiConstants.TAB_ANNOTATIONS,TAB_SORTKEY_DEFAULT={};TAB_SORTKEY_DEFAULT[uiConstants.TAB_ANNOTATIONS]="Location",TAB_SORTKEY_DEFAULT[uiConstants.TAB_NOTES]="Oldest",TAB_SORTKEY_DEFAULT[uiConstants.TAB_ORPHANS]="Location";var TAB_SORTKEYS_AVAILABLE={};TAB_SORTKEYS_AVAILABLE[uiConstants.TAB_ANNOTATIONS]=["Newest","Oldest","Location"],TAB_SORTKEYS_AVAILABLE[uiConstants.TAB_NOTES]=["Newest","Oldest"],TAB_SORTKEYS_AVAILABLE[uiConstants.TAB_ORPHANS]=["Newest","Oldest","Location"];var update={CLEAR_SELECTION:function(){return{filterQuery:null,selectedAnnotationMap:null}},SELECT_ANNOTATIONS:function(t,e){return{selectedAnnotationMap:e.selection}},FOCUS_ANNOTATIONS:function(t,e){return{focusedAnnotationMap:e.focused}},SET_FORCE_VISIBLE:function(t,e){return{forceVisible:e.forceVisible}},SET_EXPANDED:function(t,e){return{expanded:e.expanded}},HIGHLIGHT_ANNOTATIONS:function(t,e){return{highlighted:e.highlighted}},SELECT_TAB:function(t,e){return-1===[uiConstants.TAB_ANNOTATIONS,uiConstants.TAB_NOTES,uiConstants.TAB_ORPHANS].indexOf(e.tab)?{}:t.selectedTab===e.tab?{}:{selectedTab:e.tab,sortKey:TAB_SORTKEY_DEFAULT[e.tab],sortKeysAvailable:TAB_SORTKEYS_AVAILABLE[e.tab]}},SET_FILTER_QUERY:function(t,e){return{filterQuery:e.query,forceVisible:{},expanded:{}}},SET_SORT_KEY:function(t,e){return{sortKey:e.key}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{clearSelectedAnnotations:clearSelectedAnnotations,focusAnnotations:focusAnnotations,highlightAnnotations:highlightAnnotations,removeSelectedAnnotation:removeSelectedAnnotation,selectAnnotations:selectAnnotations,selectTab:selectTab,setCollapsed:setCollapsed,setFilterQuery:setFilterQuery,setForceVisible:setForceVisible,setSortKey:setSortKey,toggleSelectedAnnotations:toggleSelectedAnnotations},hasSelectedAnnotations:hasSelectedAnnotations,isAnnotationSelected:isAnnotationSelected};

},{"../ui-constants":168,"../util/array-util":171,"./util":121,"seamless-immutable":36}],120:[function(require,module,exports){
"use strict";function init(){return{session:{features:{},groups:[],preferences:{},userid:null}}}function updateSession(e){return{type:actions.UPDATE_SESSION,session:e}}function isFeatureEnabled(e,s){return!!e.session.features[s]}function profile(e){return e.session}var util=require("./util"),update={UPDATE_SESSION:function(e,s){return{session:s.session}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{updateSession:updateSession},isFeatureEnabled:isFeatureEnabled,profile:profile};

},{"./util":121}],121:[function(require,module,exports){
"use strict";function actionTypes(e){return Object.keys(e).reduce(function(e,t){return e[t]=t,e},{})}function createReducer(e){return function(t,n){var r=e[n.type];return r?Object.assign({},t,r(t,n)):t}}function bindSelectors(e,t){return Object.keys(e).reduce(function(n,r){var c=e[r];return n[r]=function(){var e=[].slice.apply(arguments);return e.unshift(t()),c.apply(null,e)},n},{})}module.exports={actionTypes:actionTypes,bindSelectors:bindSelectors,createReducer:createReducer};

},{}],122:[function(require,module,exports){
"use strict";function init(){return{isSidebar:!0,visibleHighlights:!1}}function setAppIsSidebar(i){return{type:actions.SET_SIDEBAR,isSidebar:i}}function setShowHighlights(i){return{type:actions.SET_HIGHLIGHTS_VISIBLE,visible:i}}function isSidebar(i){return i.isSidebar}var util=require("./util"),update={SET_SIDEBAR:function(i,t){return{isSidebar:t.isSidebar}},SET_HIGHLIGHTS_VISIBLE:function(i,t){return{visibleHighlights:t.visible}}},actions=util.actionTypes(update);module.exports={init:init,update:update,actions:{setAppIsSidebar:setAppIsSidebar,setShowHighlights:setShowHighlights},isSidebar:isSidebar};

},{"./util":121}],123:[function(require,module,exports){
"use strict";function targetBlank(){function e(e){return e.replace(/<a href=/g,'<a target="_blank" href=')}return[{type:"output",filter:e}]}function renderMarkdown(e){return converter||(converter=new showdown.Converter({extensions:[targetBlank],simplifiedAutoLink:!0,literalMidWordUnderscores:!0})),converter.makeHtml(e)}function mathPlaceholder(e){return"{math:"+e.toString()+"}"}function extractMath(e){for(var r=[],n=0,t=e;;){var a=t.indexOf("$$",n),o=t.indexOf("\\(",n);if(-1===a&&-1===o)break;var i,c;if(-1!==a&&(-1===o||a<o)?(i=a,c=t.indexOf("$$",i+2)):(i=o,c=t.indexOf("\\)",i+2)),-1===c)break;c+=2;var d=r.length+1,s=mathPlaceholder(d);r.push({id:d,expression:t.slice(i+2,c-2),inline:-1!==o});var l;l=-1!==o?s:"\n\n"+s+"\n\n",t=t.slice(0,i)+l+t.slice(c),n=i+l.length}return{mathBlocks:r,content:t}}function insertMath(e,r){return r.reduce(function(e,r){var n;try{n=r.inline?katex.renderToString(r.expression):katex.renderToString(r.expression,{displayMode:!0})}catch(e){n=escapeHtml(r.expression)}return e.replace(mathPlaceholder(r.id),n)},e)}function renderMathAndMarkdown(e,r){var n=extractMath(e);return insertMath(r(renderMarkdown(n.content)),n.mathBlocks)}var escapeHtml=require("escape-html"),katex=require("katex"),showdown=require("showdown"),converter;module.exports=renderMathAndMarkdown;

},{"escape-html":3,"katex":"katex","showdown":"showdown"}],124:[function(require,module,exports){
"use strict";function retryPromiseOperation(r,t){return new Promise(function(e,n){var o=retry.operation(t);o.attempt(function(){r().then(function(r){o.retry(),e(r)}).catch(function(r){o.retry(r)||n(r)})})})}var retry=require("retry");module.exports={retryPromiseOperation:retryPromiseOperation};

},{"retry":32}],125:[function(require,module,exports){
"use strict";function truthyKeys(t){return Object.keys(t).filter(function(e){return!!t[e]})}function RootThread(t,e,n,a,o){function i(t){var e,n=sortFns[t.sortKey];if(t.filterQuery){var i=a.generateFacetedFilter(t.filterQuery);e=function(t){return o.filter([t],i).length>0}}var r;return t.isSidebar&&!t.filterQuery&&(r=function(e){return!!e.annotation&&tabs.shouldShowInTab(e.annotation,t.selectedTab)}),buildThread(t.annotations,{forceVisible:truthyKeys(t.forceVisible),expanded:t.expanded,highlighted:t.highlighted,selected:truthyKeys(t.selectedAnnotationMap||{}),sortCompareFn:n,filterFn:e,threadFilterFn:r})}function r(){e.getState().annotations.filter(function(t){return metadata.isNew(t)&&!n.getIfNotEmpty(t)}).forEach(function(e){n.remove(e),t.$broadcast(events.ANNOTATION_DELETED,e)})}[events.ANNOTATION_CREATED,events.ANNOTATION_UPDATED,events.ANNOTATIONS_LOADED].forEach(function(n){t.$on(n,function(t,n){e.addAnnotations([].concat(n))})}),t.$on(events.BEFORE_ANNOTATION_CREATED,function(t,n){r(),e.addAnnotations([n]),metadata.isPageNote(n)?e.selectTab(uiConstants.TAB_NOTES):metadata.isAnnotation(n)&&e.selectTab(uiConstants.TAB_ANNOTATIONS),(n.references||[]).forEach(function(t){e.setCollapsed(t,!1)})}),t.$on(events.ANNOTATION_DELETED,function(t,n){e.removeAnnotations([n]),n.id&&e.removeSelectedAnnotation(n.id)}),t.$on(events.ANNOTATIONS_UNLOADED,function(t,n){e.removeAnnotations(n)}),t.$on(events.GROUP_FOCUSED,function(t,n){var a=e.getState().annotations.filter(function(t){return metadata.isNew(t)&&!metadata.isReply(t)}).map(function(t){return Object.assign(t,{group:n})});a.length>0&&e.addAnnotations(a)}),this.thread=memoize(i)}RootThread.$inject=["$rootScope","annotationUI","drafts","searchFilter","viewFilter"];var buildThread=require("./build-thread"),events=require("./events"),memoize=require("./util/memoize"),metadata=require("./annotation-metadata"),tabs=require("./tabs"),uiConstants=require("./ui-constants"),sortFns={Newest:function(t,e){return t.updated>e.updated},Oldest:function(t,e){return t.updated<e.updated},Location:function(t,e){return metadata.location(t)<metadata.location(e)}};module.exports=RootThread;

},{"./annotation-metadata":52,"./build-thread":55,"./events":96,"./tabs":134,"./ui-constants":168,"./util/memoize":175}],126:[function(require,module,exports){
"use strict";function SearchClient(e,t){t=t||{};this._searchFn=e,this._chunkSize=t.chunkSize||200,void 0!==t.incremental?this._incremental=t.incremental:this._incremental=!0,this._canceled=!1}var EventEmitter=require("tiny-emitter"),inherits=require("inherits");inherits(SearchClient,EventEmitter),SearchClient.prototype._getBatch=function(e,t){var i=Object.assign({limit:this._chunkSize,offset:t,sort:"created",order:"asc",_separate_replies:!0},e),n=this;this._searchFn(i).then(function(i){if(!n._canceled){var r=i.rows.concat(i.replies||[]);n._incremental?n.emit("results",r):n._results=n._results.concat(r);var c=t+i.rows.length;i.total>c&&r.length>0?n._getBatch(e,c):(n._incremental||n.emit("results",n._results),n.emit("end"))}}).catch(function(e){n._canceled||n.emit("error",e)}).then(function(){n._canceled||n.emit("end")})},SearchClient.prototype.get=function(e){this._results=[],this._getBatch(e,0)},SearchClient.prototype.cancel=function(){this._canceled=!0,this.emit("end")},module.exports=SearchClient;

},{"inherits":5,"tiny-emitter":40}],127:[function(require,module,exports){
"use strict";function splitTerm(e){var r=e.slice(0,e.indexOf(":"));if(!r)return[null,e];if(["group","quote","result","since","tag","text","uri","user"].includes(r)){return[r,e.slice(r.length+1)]}return[null,e]}function tokenize(e){if(!e)return[];var r=function(e){var r=e.slice(0,1),t=e.slice(-1);return'"'!==r&&"'"!==r||r!==t||(e=e.slice(1,e.length-1)),e},t=e.match(/(?:[^\s"']+|"[^"]*"|'[^']*')+/g);t=t.map(r);for(var a=0;a<t.length;a++){var n=t[a],i=splitTerm(n),c=_slicedToArray(i,2),o=c[0],s=c[1];o&&(t[a]=o+":"+r(s))}return t}function toObject(e){var r={};if(e){var t=tokenize(e),a=!0,n=!1,i=void 0;try{for(var c,o=t[Symbol.iterator]();!(a=(c=o.next()).done);a=!0){var s=c.value,u=splitTerm(s),l=_slicedToArray(u,2),h=l[0],d=l[1];h||(h="any",d=s),function(e,t){r[e]?r[e].push(t):r[e]=[t]}(function(e){return"tag"===e?"tags":e}(h),d)}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}}return r}function generateFacetedFilter(e){var r,t=[],a=[],n=[],i=[],c=[],o=[],s=[],u=[];if(e){r=tokenize(e);var l=!0,h=!1,d=void 0;try{for(var f,p=r[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var m,y=f.value;switch(y.slice(0,y.indexOf(":"))){case"quote":a.push(y.slice(6));break;case"result":n.push(y.slice(7));break;case"since":var v=y.slice(6).toLowerCase();v.match(/^\d+$/)&&i.push(1*v),v.match(/^\d+sec$/)&&(m=/^(\d+)sec$/.exec(v)[1],i.push(1*m)),v.match(/^\d+min$/)&&(m=/^(\d+)min$/.exec(v)[1],i.push(60*m)),v.match(/^\d+hour$/)&&(m=/^(\d+)hour$/.exec(v)[1],i.push(60*m*60)),v.match(/^\d+day$/)&&(m=/^(\d+)day$/.exec(v)[1],i.push(60*m*60*24)),v.match(/^\d+week$/)&&(m=/^(\d+)week$/.exec(v)[1],i.push(60*m*60*24*7)),v.match(/^\d+month$/)&&(m=/^(\d+)month$/.exec(v)[1],i.push(60*m*60*24*30)),v.match(/^\d+year$/)&&(m=/^(\d+)year$/.exec(v)[1],i.push(60*m*60*24*365));break;case"tag":c.push(y.slice(4));break;case"text":o.push(y.slice(5));break;case"uri":s.push(y.slice(4));break;case"user":u.push(y.slice(5));break;default:t.push(y)}}}catch(e){h=!0,d=e}finally{try{!l&&p.return&&p.return()}finally{if(h)throw d}}}return{any:{terms:t,operator:"and"},quote:{terms:a,operator:"and"},result:{terms:n,operator:"min"},since:{terms:i,operator:"and"},tag:{terms:c,operator:"and"},text:{terms:o,operator:"and"},uri:{terms:s,operator:"or"},user:{terms:u,operator:"or"}}}function searchFilter(){return{toObject:toObject,generateFacetedFilter:generateFacetedFilter}}var _slicedToArray=function(){function e(e,r){var t=[],a=!0,n=!1,i=void 0;try{for(var c,o=e[Symbol.iterator]();!(a=(c=o.next()).done)&&(t.push(c.value),!r||t.length!==r);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();module.exports=searchFilter;

},{}],128:[function(require,module,exports){
"use strict";function serviceConfig(e){return Array.isArray(e.services)&&0!==e.services.length?e.services[0]:null}module.exports=serviceConfig;

},{}],129:[function(require,module,exports){
"use strict";function serviceUrl(r,e){return e.links().then(r.updateLinks).catch(function(r){console.warn("The links API request was rejected: "+r.message)}),function(e,n){var t=r.getState().links;if(null===t)return"";var i=t[e];if(!i)throw new Error("Unknown link "+e);n=n||{};var l=urlUtil.replaceURLParams(i,n),a=Object.keys(l.params);if(a.length>0)throw new Error("Unknown link parameters: "+a.join(", "));return l.url}}serviceUrl.$inject=["annotationUI","apiRoutes"];var urlUtil=require("./util/url-util");module.exports=serviceUrl;

},{"./util/url-util":180}],130:[function(require,module,exports){
"use strict";function session(e,t,r,n,o,u,i,s,a,c){function l(){var e=a(s);return null===e?null:e.authority}function f(){return(!U||Date.now()-U>CACHE_TTL)&&(U=Date.now(),h=retryUtil.retryPromiseOperation(function(){var e=l(),t={};return e&&(t.authority=e),c.profile.read(t)},S).then(function(e){return v(e),U=Date.now(),e}).catch(function(e){throw U=null,e})),h}function d(){return c.profile.update({},{preferences:{show_sidebar_tutorial:!1}}).then(v)}function v(e){var r=n.getState().session,o=e.userid!==r.userid,u=!angular.equals(e.groups,r.groups);return n.updateSession(e),h=Promise.resolve(e),U=Date.now(),o&&(t.$broadcast(events.USER_CHANGED,{profile:e}),e.userid?i.setUserInfo({id:e.userid}):i.setUserInfo(void 0)),u&&t.$broadcast(events.GROUPS_CHANGED),e}function p(){return o.logout().then(function(){return g()}).catch(function(t){return u.error("Log out failed"),r.track(r.events.LOGOUT_FAILURE),e.reject(new Error(t))}).then(function(){r.track(r.events.LOGOUT_SUCCESS)})}function g(){return h=null,U=null,f()}var h,U,S={};return t.$on(events.OAUTH_TOKENS_CHANGED,function(){g()}),{dismissSidebarTutorial:d,load:f,logout:p,reload:g,profileFetchRetryOpts:S,get state(){return n.getState().session},update:v}}session.$inject=["$q","$rootScope","analytics","annotationUI","auth","flash","raven","settings","serviceConfig","store"];var angular=require("angular"),events=require("./events"),retryUtil=require("./retry-util"),CACHE_TTL=3e5;module.exports=session;

},{"./events":96,"./retry-util":124,"angular":"angular"}],131:[function(require,module,exports){
"use strict";function translateResponseToError(e){var r;e.status<=0?r="Service unreachable.":(r=e.status+" "+e.statusText,e.data&&e.data.reason&&(r=r+": "+e.data.reason));var t=new Error(r);return t.response=e,t}function stripInternalProperties(e){var r={};for(var t in e)e.hasOwnProperty(t)&&"$"!==t[0]&&(r[t]=e[t]);return r}function forEachSorted(e,r,t){for(var n=Object.keys(e).sort(),a=0;a<n.length;a++)r.call(t,e[n[a]],n[a]);return n}function serializeValue(e){return"object"===(void 0===e?"undefined":_typeof(e))?e instanceof Date?e.toISOString():JSON.stringify(e):e}function encodeUriQuery(e){return encodeURIComponent(e).replace(/%20/g,"+")}function serializeParams(e){if(!e)return"";var r=[];return forEachSorted(e,function(e,t){null!==e&&void 0!==e&&(Array.isArray(e)?e.forEach(function(e){r.push(encodeUriQuery(t)+"="+encodeUriQuery(serializeValue(e)))}):r.push(encodeUriQuery(t)+"="+encodeUriQuery(serializeValue(e))))}),r.join("&")}function createAPICall(e,r,t,n,a){return function(o,i){return r.all([t,a()]).then(function(r){var t=r[0],a=r[1],u=get(t,n),l=urlUtil.replaceURLParams(u.url,o),s={};a&&(s.Authorization="Bearer "+a);var c={data:i?stripInternalProperties(i):null,headers:s,method:u.method,params:l.params,paramSerializer:serializeParams,url:l.url};return e(c)}).then(function(e){return e.data}).catch(function(e){return r.reject(translateResponseToError(e))})}}function store(e,r,t,n){function a(t){return createAPICall(e,r,o,t,n.tokenGetter)}var o=t.routes();return{search:a("search"),annotation:{create:a("annotation.create"),delete:a("annotation.delete"),get:a("annotation.read"),update:a("annotation.update"),flag:a("annotation.flag"),hide:a("annotation.hide"),unhide:a("annotation.unhide")},group:{member:{delete:a("group.member.delete")}},profile:{read:a("profile.read"),update:a("profile.update")}}}store.$inject=["$http","$q","apiRoutes","auth"];var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},get=require("lodash.get"),urlUtil=require("./util/url-util");module.exports=store;

},{"./util/url-util":180,"lodash.get":7}],132:[function(require,module,exports){
var StreamFilter;module.exports=StreamFilter=function(){function t(){}return t.prototype.strategies=["include_any","include_all","exclude_any","exclude_all"],t.prototype.filter={match_policy:"include_any",clauses:[],actions:{create:!0,update:!0,delete:!0}},t.prototype.getFilter=function(){return this.filter},t.prototype.getMatchPolicy=function(){return this.filter.match_policy},t.prototype.getClauses=function(){return this.filter.clauses},t.prototype.getActions=function(){return this.filter.actions},t.prototype.getActionCreate=function(){return this.filter.actions.create},t.prototype.getActionUpdate=function(){return this.filter.actions.update},t.prototype.getActionDelete=function(){return this.filter.actions.delete},t.prototype.setMatchPolicy=function(t){return this.filter.match_policy=t,this},t.prototype.setMatchPolicyIncludeAny=function(){return this.filter.match_policy="include_any",this},t.prototype.setMatchPolicyIncludeAll=function(){return this.filter.match_policy="include_all",this},t.prototype.setMatchPolicyExcludeAny=function(){return this.filter.match_policy="exclude_any",this},t.prototype.setMatchPolicyExcludeAll=function(){return this.filter.match_policy="exclude_all",this},t.prototype.setActions=function(t){return this.filter.actions=t,this},t.prototype.setActionCreate=function(t){return this.filter.actions.create=t,this},t.prototype.setActionUpdate=function(t){return this.filter.actions.update=t,this},t.prototype.setActionDelete=function(t){return this.filter.actions.delete=t,this},t.prototype.noClauses=function(){return this.filter.clauses=[],this},t.prototype.addClause=function(t,e,i,o,n){return null==o&&(o=!1),null==n&&(n={}),this.filter.clauses.push({field:t,operator:e,value:i,case_sensitive:o,options:n}),this},t.prototype.resetFilter=function(){return this.setMatchPolicyIncludeAny(),this.setActionCreate(!0),this.setActionUpdate(!0),this.setActionDelete(!0),this.noClauses(),this},t}();

},{}],133:[function(require,module,exports){
"use strict";function Streamer(e,n,t,o,i,r,s){function c(e){var n=e.options.action,o=e.payload;switch(n){case"create":case"update":case"past":o.forEach(function(e){e.group!==i.focused().id&&t.isSidebar()||(m[e.id]=e)});break;case"delete":o.forEach(function(e){delete m[e.id],t.annotationExists(e.id)&&(E[e.id]=!0)})}t.isSidebar()||g()}function a(e){r.update(e.model)}function u(e){console.warn("Error connecting to H push notification service:",e),-1!==["localhost","127.0.0.1"].indexOf(new URL(s.websocketUrl).hostname)&&console.warn("Check that your H service is configured to allow WebSocket connections from "+window.location.origin)}function d(n){e.$apply(function(){var e=JSON.parse(n.data);if(e)if("annotation-notification"===e.type)c(e);else if("session-change"===e.type)a(e);else if("whoyouare"===e.type){var o=t.getState().session.userid;e.userid!==o&&console.warn('WebSocket user ID "%s" does not match logged-in ID "%s"',e.userid,o)}else console.warn("received unsupported notification",e.type)})}function f(){Object.keys(b).forEach(function(e){b[e]&&S.send(b[e])})}function l(e,n){b[e]=n,S&&S.isConnected()&&S.send(n)}function h(){return S?Promise.resolve():U()}function p(){return S&&S.close(),U()}function g(){var e=Object.values(m),t=Object.keys(E).map(function(e){return{id:e}});e.length&&n.loadAnnotations(e),t.length&&n.unloadAnnotations(t),m={},E={}}function y(){return Object.keys(m).length+Object.keys(E).length}function v(e){return E.hasOwnProperty(e)}function k(e,n){Array.isArray(n)||(n=[n]),n.forEach(function(e){delete m[e.id],delete E[e.id]})}function w(){m={},E={}}var S,O=uuid.v4(),b={},m={},E={},U=function(){return s.websocketUrl?o.tokenGetter().then(function(e){var n;if(e){var t=new URL(s.websocketUrl),o=queryString.parse(t.search);o.access_token=e,t.search=queryString.stringify(o),n=t.toString()}else n=s.websocketUrl;S=new Socket(n),S.on("open",f),S.on("error",u),S.on("message",d),l("client-id",{messageType:"client_id",value:O}),l("auth-check",{type:"whoami",id:1})}).catch(function(e){console.error("Failed to fetch token for WebSocket authentication",e)}):Promise.resolve()};[events.ANNOTATION_DELETED,events.ANNOTATION_UPDATED,events.ANNOTATIONS_UNLOADED].forEach(function(n){e.$on(n,k)}),e.$on(events.GROUP_FOCUSED,w),this.applyPendingUpdates=g,this.countPendingUpdates=y,this.hasPendingDeletion=v,this.clientId=O,this.configMessages=b,this.connect=h,this.reconnect=p,this.setConfig=l}Streamer.$inject=["$rootScope","annotationMapper","annotationUI","auth","groups","session","settings"];var queryString=require("query-string"),uuid=require("node-uuid"),events=require("./events"),Socket=require("./websocket");module.exports=Streamer;

},{"./events":96,"./websocket":184,"node-uuid":18,"query-string":20}],134:[function(require,module,exports){
"use strict";function tabForAnnotation(t){return metadata.isOrphan(t)?uiConstants.TAB_ORPHANS:metadata.isPageNote(t)?uiConstants.TAB_NOTES:uiConstants.TAB_ANNOTATIONS}function shouldShowInTab(t,n){return!metadata.isWaitingToAnchor(t)&&tabForAnnotation(t)===n}function counts(t){return{notes:countIf(t,metadata.isPageNote),annotations:countIf(t,metadata.isAnnotation),orphans:countIf(t,metadata.isOrphan),anchoring:countIf(t,metadata.isWaitingToAnchor)}}var countIf=require("./util/array-util").countIf,metadata=require("./annotation-metadata"),uiConstants=require("./ui-constants");module.exports={counts:counts,shouldShowInTab:shouldShowInTab,tabForAnnotation:tabForAnnotation};

},{"./annotation-metadata":52,"./ui-constants":168,"./util/array-util":171}],135:[function(require,module,exports){
"use strict";function tags(t){function e(e){return(t.getObject(n)||[]).filter(function(t){return-1!==t.toLowerCase().indexOf(e.toLowerCase())})}function o(e){var o=t.getObject(r)||{};e.forEach(function(t){o[t.text]?(o[t.text].count+=1,o[t.text].updated=Date.now()):o[t.text]={text:t.text,count:1,updated:Date.now()}}),t.setObject(r,o);var c=Object.keys(o).sort(function(t,e){return o[t].count!==o[e].count?o[e].count-o[t].count:t.localeCompare(e)});t.setObject(n,c)}var n="hypothesis.user.tags.list",r="hypothesis.user.tags.map";return{filter:e,store:o}}tags.$inject=["localStorage"],module.exports=tags;

},{}],136:[function(require,module,exports){
module.exports='<button class="btn btn-clean annotation-action-btn"\n  ng-click="vm.onClick()"\n  ng-disabled="vm.isDisabled"\n  aria-label="{{ vm.label }}"\n  h-tooltip>\n  <i class="{{ vm.icon }} btn-icon"></i>\n</button>\n';

},{}],137:[function(require,module,exports){
module.exports='<header class="annotation-header">\n  \x3c!-- User --\x3e\n  <span ng-if="vm.user()">\n    <a class="annotation-header__user"\n      target="_blank"\n      ng-if="!vm.isThirdPartyUser()"\n      ng-href="{{vm.serviceUrl(\'user\',{user:vm.user()})}}"\n      ><i class="h-icon-visibility-off"></i>{{vm.displayName()}}</a>\n    <a class="annotation-header__user"\n      target="_blank"\n      ng-if="vm.isThirdPartyUser() && vm.thirdPartyUsernameLink()"\n      href="{{ vm.thirdPartyUsernameLink() }}"\n      ><i class="h-icon-visibility-off"></i>{{vm.displayName()}}</a>\n    <span class="annotation-header__user"\n      ng-if="vm.isThirdPartyUser() && !vm.thirdPartyUsernameLink()"\n      >{{vm.displayName()}}</span>\n    <span class="annotation-collapsed-replies">\n      <a class="annotation-link" href=""\n        ng-click="vm.onReplyCountClick()"\n        ng-pluralize count="vm.replyCount"\n        when="{\'0\': \'\', \'one\': \'1 reply\', \'other\': \'{} replies\'}"></a>\n    </span>\n    <br>\n    <span class="annotation-header__share-info">\n      <a class="annotation-header__group"\n        target="_blank" ng-if="vm.group() && vm.group().url" href="{{vm.group().url}}">\n        <i class="h-icon-group"></i><span class="annotation-header__group-name">{{vm.group().name}}</span>\n      </a>\n      <span ng-show="vm.isPrivate"\n        title="{{\'This feedback is visible only to you.\' | translate}}">\n        <i class="h-icon-lock"></i><span class="annotation-header__group-name" ng-show="!vm.group().url">{{\'Only me\' | translate}}</span>\n      </span>\n      <i class="h-icon-border-color" ng-show="vm.isHighlight && !vm.isEditing" title="{{\'This is a highlight. Click \\\'edit\\\' to add a note or tag.\'| translate}}"></i>\n      <span ng-if="::vm.showDocumentInfo">\n        <span class="annotation-citation" ng-if="vm.documentMeta().titleLink">\n          on "<a ng-href="{{vm.documentMeta().titleLink}}">{{vm.documentMeta().titleText}}</a>"\n        </span>\n        <span class="annotation-citation" ng-if="!vm.documentMeta().titleLink">\n          on "{{vm.documentMeta().titleText}}"\n        </span>\n        <span class="annotation-citation-domain"\n              ng-if="vm.documentMeta().domain">({{vm.documentMeta().domain}})</span>\n      </span>\n    </span>\n  </span>\n\n  <span class="u-flex-spacer"></span>\n\n  <timestamp\n    class-name="\'annotation-header__timestamp\'"\n    timestamp="vm.updated()"\n    href="vm.htmlLink()"\n    ng-if="!vm.editing() && vm.updated()"></timestamp>\n</header>\n';

},{}],138:[function(require,module,exports){
module.exports='<div class="annotation-share-dialog__backdrop"\n     ng-if="vm.isOpen"\n     ng-click="vm.onClose()"></div>\n<div class="annotation-share-dialog" ng-class="{\'is-open\': vm.isOpen}">\n  <div class="annotation-share-dialog-target">\n    <span class="annotation-share-dialog-target__label">{{\'Share\' | translate}}:</span>\n    <a href="https://twitter.com/intent/tweet?url={{vm.uri | urlEncode}}&hashtags=annotated"\n      target="_blank"\n      title="{{\'Tweet link\' | translate}}"\n      class="annotation-share-dialog-target__icon h-icon-twitter"\n      ng-click="vm.onShareClick(\'twitter\')"></a>\n    <a href="https://www.facebook.com/sharer/sharer.php?u={{vm.uri | urlEncode}}"\n      target="_blank"\n      title="{{\'Share on Facebook\' | translate}}"\n      class="annotation-share-dialog-target__icon h-icon-facebook"\n      ng-click="vm.onShareClick(\'facebook\')"></a>\n    <a href="https://plus.google.com/share?url={{vm.uri | urlEncode}}"\n      target="_blank"\n      title="{{\'Post on Google Plus\' | translate}}"\n      class="annotation-share-dialog-target__icon h-icon-google-plus"\n      ng-click="vm.onShareClick(\'googlePlus\')"></a>\n    <a href="mailto:?subject=Let\'s%20Annotate&amp;body={{vm.uri}}"\n      target="_blank"\n      title="{{\'Share via email\' | translate}}"\n      class="annotation-share-dialog-target__icon h-icon-mail"\n      ng-click="vm.onShareClick(\'email\')"></a>\n  </div>\n  <div class="annotation-share-dialog-link" type="text">\n    <input class="annotation-share-dialog-link__text"\n      value="{{vm.uri}}" readonly>\n    <span class="annotation-share-dialog-link__feedback" ng-if="vm.copyToClipboardMessage">\n      {{vm.copyToClipboardMessage}}\n    </span>\n    <button class="btn btn-clean annotation-share-dialog-link__btn"\n      ng-click="vm.copyToClipboard($event)">\n      <i class="h-icon-clipboard btn-icon"></i>\n    </button>\n  </div>\n  <div class="annotation-share-dialog-msg" ng-if="vm.group && !vm.group.public && !vm.isPrivate">\n    <span class="annotation-share-dialog-msg__audience">\n      {{\'Group.\' | translate}}\n    </span>\n    {{\'Only group members will be able to view this annotation.\' | translate}}\n  </div>\n  <div class="annotation-share-dialog-msg" ng-if="vm.isPrivate">\n    <span class="annotation-share-dialog-msg__audience">\n      {{\'Only me.\' | translate}}\n    </span>\n    {{\'No one else will be able to view this annotation.\' | translate}}\n  </div>\n</div>\n';

},{}],139:[function(require,module,exports){
module.exports='<div ng-class="vm.threadClasses()">\n  <div class="annotation-thread__thread-edge" ng-if="!vm.isTopLevelThread()">\n    <a href=""\n       ng-class="vm.threadToggleClasses()"\n       title="{{(vm.thread.collapsed && \'Expand\' | translate) || (\'Collapse\' | translate)}}"\n       ng-click="vm.toggleCollapsed()">\n       <span ng-class="{\'h-icon-arrow-right\': vm.thread.collapsed,\n                        \'h-icon-arrow-drop-down\': !vm.thread.collapsed}"></span>\n    </a>\n    <div class="annotation-thread__thread-line"></div>\n  </div>\n  <div class="annotation-thread__content">\n    <moderation-banner annotation="vm.thread.annotation"\n                       ng-if="vm.thread.annotation">\n    </moderation-banner>\n    <annotation ng-class="vm.annotationClasses()"\n             annotation="vm.thread.annotation"\n             is-collapsed="vm.thread.collapsed"\n             name="annotation"\n             ng-mouseenter="vm.annotationHovered = true"\n             ng-mouseleave="vm.annotationHovered = false"\n             ng-if="vm.thread.annotation"\n             ng-show="vm.thread.visible"\n             show-document-info="vm.showDocumentInfo"\n             on-reply-count-click="vm.toggleCollapsed()"\n             reply-count="vm.thread.replyCount">\n    </annotation>\n\n    <div ng-if="!vm.thread.annotation" class="thread-deleted">\n      <p><em>{{\'Message not available.\' | translate}}</em></p>\n    </div>\n\n    <div ng-if="vm.hiddenCount() > 0">\n      <a class="small"\n         href=""\n         ng-click="vm.showThreadAndReplies()"\n         ng-pluralize\n         count="vm.hiddenCount()"\n         when="{\'0\': \'\',\n               one: \'View one more in conversation\',\n               other: \'View {} more in conversation\'}"\n         ></a>\n    </div>\n\n    \x3c!-- Replies --\x3e\n    <ul ng-show="!vm.thread.collapsed">\n      <li ng-repeat="child in vm.thread.children track by child.id"\n          ng-show="vm.shouldShowReply(child)">\n        <annotation-thread\n          show-document-info="false"\n          thread="child"\n          on-change-collapsed="vm.onChangeCollapsed({id:id, collapsed:collapsed})"\n          on-force-visible="vm.onForceVisible({thread:thread})">\n        </annotation-thread>\n      </li>\n    </ul>\n  </div>\n</div>\n';

},{}],140:[function(require,module,exports){
module.exports='<thread-list\n  on-change-collapsed="vm.setCollapsed(id, collapsed)"\n  on-force-visible="vm.forceVisible(thread)"\n  show-document-info="true"\n  thread="vm.rootThread">\n</thread-list>\n';

},{}],141:[function(require,module,exports){
module.exports='<header class="annotation-header" ng-if="!vm.user()">\n  <strong>{{\'You must be logged in to leave feedback.\' | translate}}</strong>\n</header>\n\n<div ng-keydown="vm.onKeydown($event)" ng-if="vm.user()">\n\n\n\n  \x3c!-- Excerpts --\x3e\n  <section class="annotation-quote-list"\n    ng-class="{\'is-orphan\' : vm.isOrphan()}"\n    ng-if="vm.quote()">\n    <excerpt collapsed-height="35"\n      inline-controls="true"\n      overflow-hysteresis="20"\n      content-data="selector.exact">\n      <blockquote class="annotation-quote"\n        h-branding="selectionFontFamily"\n        ng-bind="vm.quote()"></blockquote>\n    </excerpt>\n  </section>\n\n  \x3c!-- / Excerpts --\x3e\n\n  \x3c!-- Body --\x3e\n  <section name="text" class="annotation-body">\n    <excerpt enabled="!vm.editing()"\n      inline-controls="false"\n      on-collapsible-changed="vm.setBodyCollapsible(collapsible)"\n      collapse="vm.collapseBody"\n      collapsed-height="400"\n      overflow-hysteresis="20"\n      content-data="vm.state().text">\n      <markdown text="vm.state().text"\n                custom-text-class="{\'annotation-body is-hidden\':vm.isHiddenByModerator(),\n                                    \'has-content\':vm.hasContent()}"\n                on-edit-text="vm.setText(text)"\n                read-only="!vm.editing()">\n      </markdown>\n    </excerpt>\n  </section>\n  \x3c!-- / Body --\x3e\n  <annotation-header annotation="vm.annotation"\n                     is-editing="vm.editing()"\n                     is-highlight="vm.isHighlight()"\n                     is-private="vm.state().isPrivate"\n                     on-reply-count-click="vm.onReplyCountClick()"\n                     reply-count="vm.replyCount"\n                     show-document-info="vm.showDocumentInfo">\n  </annotation-header>\n\n  \x3c!-- Tags --\x3e\n  <div class="annotation-body form-field" ng-if="vm.editing() && !vm.isThemeCustom">\n    <tag-editor tags="vm.state().tags"\n                on-edit-tags="vm.setTags(tags)"></tag-editor>\n  </div>\n\n  <div class="annotation-body u-layout-row tags tags-read-only"\n       ng-if="(vm.canCollapseBody || vm.state().tags.length) && !vm.editing()">\n    <ul class="tag-list" ng-if="vm.isThemeCustom">\n      <li class="tag-item" ng-repeat="tag in vm.state().tags">\n        <a ng-href="{{vm.tagSearchURL(tag)}}" target="_blank">{{tag}}</a>\n      </li>\n    </ul>\n    <div class="u-stretch"></div>\n    <a class="annotation-link u-strong" ng-show="vm.canCollapseBody"\n      ng-click="vm.toggleCollapseBody($event)"\n      ng-title="vm.collapseBody ? (\'Show the full annotation text\' | translate): (\'Show the first few lines only\' | translate)"\n      ng-bind="vm.collapseBody ? (\'More\' | translate) : (\'Less\' | translate)"\n      h-branding="accentColor"></a>\n  </div>\n  \x3c!-- / Tags --\x3e\n\n  <footer class="annotation-footer">\n    <div class="annotation-form-actions" ng-if="vm.editing()">\n      <publish-annotation-btn\n        class="publish-annotation-btn"\n        group="vm.group()"\n        can-post="vm.hasContent()"\n        is-shared="vm.isShared()"\n        on-cancel="vm.revert()"\n        on-save="vm.save()"\n        on-set-privacy="vm.setPrivacy(level)"></publish-annotation-btn>\n    </div>\n\n    <div class="annotation-section annotation-license"\n         ng-show="vm.shouldShowLicense()">\n      <a class="annotation-license__link" href="http://creativecommons.org/publicdomain/zero/1.0/"\n        title="{{\'View more information about the Creative Commons Public Domain dedication\' | translate}}"\n        target="_blank">\n        <i class="h-icon-cc-logo"></i><i class="h-icon-cc-zero"></i>\n        {{\'Feedback can be freely reused by anyone for any purpose.\' | translate}}\n      </a>\n    </div>\n\n    <div class="annotation-replies" ng-if="!vm.isReply() && vm.replyCount > 0">\n      <a href=""\n        ng-click="vm.onReplyCountClick()">\n        <span class="annotation-replies__link">{{ vm.isCollapsed ? (\'Show replies\' | translate) : (\'Hide replies\' | translate)}}</span>\n        <span class="annotation-replies__count">({{ vm.replyCount }})</span>\n      </a>\n    </div>\n\n    <div class="annotation-actions" ng-if="vm.isSaving">\n      {{\'Saving...\' | translate}}\n    </div>\n\n    <div class="annotation-actions" ng-if="!vm.isSaving && !vm.editing() && vm.id()">\n      <div ng-show="vm.isSaving">{{\'Saving...\' | translate}}</div>\n      <annotation-action-button\n        icon="\'h-icon-annotation-edit\'"\n        is-disabled="vm.isDeleted()"\n        label="\'Edit\' | translate"\n        ng-show="vm.authorize(\'update\') && !vm.isSaving"\n        on-click="vm.edit()"\n      ></annotation-action-button>\n      <annotation-action-button\n        icon="\'h-icon-annotation-delete\'"\n        is-disabled="vm.isDeleted()"\n        label="\'Delete\' | translate"\n        ng-show="vm.authorize(\'delete\')"\n        on-click="vm.delete()"\n      ></annotation-action-button>\n\n      \x3c!-- Reply Button - is only visible if the theme is not custom --\x3e\n      <annotation-action-button\n        ng-if="!vm.isThemeCustom"\n        icon="\'h-icon-annotation-reply\'"\n        is-disabled="vm.isDeleted()"\n        label="\'Reply\' | translate"\n        on-click="vm.reply()"\n      ></annotation-action-button>\n\n       \x3c!-- Share - is only visible if the theme is not custom --\x3e\n      <span class="annotation-share-dialog-wrapper" ng-if="vm.incontextLink() && !vm.isThemeCustom">\n        <annotation-action-button\n         icon="\'h-icon-annotation-share\'"\n         is-disabled="vm.isDeleted()"\n         label="\'Share\' | translate"\n         on-click="vm.showShareDialog = true"\n        ></annotation-action-button>\n        <annotation-share-dialog\n          group="vm.group()"\n          uri="vm.incontextLink()"\n          is-private="vm.state().isPrivate"\n          is-open="vm.showShareDialog"\n          on-close="vm.showShareDialog = false">\n        </annotation-share-dialog>\n      </span>\n\n      \x3c!-- Flag - is only visible if the theme is not custom --\x3e\n      <span ng-if="!vm.isThemeCustom">\n        <annotation-action-button\n         icon="\'h-icon-annotation-flag\'"\n         is-disabled="vm.isDeleted()"\n         label="\'Report this annotation to the moderators\' | translate"\n         ng-if="!vm.isFlagged()"\n         on-click="vm.flag()"\n        ></annotation-action-button>\n        <annotation-action-button\n         icon="\'h-icon-annotation-flag annotation--flagged\'"\n         is-disabled="vm.isDeleted()"\n         label="\'Feedback has been reported to the moderators\' | translate"\n         ng-if="vm.isFlagged()"\n         ></annotation-action-button>\n        </annotation-action-button>\n      </span>\n    </div>\n  </footer>\n</div>\n';

},{}],142:[function(require,module,exports){
module.exports='<div class="dropdown-menu-btn" >\n  <button\n    class="dropdown-menu-btn__btn"\n    ng-bind="vm.label"\n    ng-click="vm.onClick($event)"\n    ng-disabled="vm.isDisabled"\n    h-branding="ctaTextColor, ctaBackgroundColor">\n  </button>\n  <button\n    class="dropdown-menu-btn__dropdown-arrow"\n    title="{{vm.dropdownMenuLabel}}"\n    ng-click="vm.toggleDropdown($event)">\n    <div class="dropdown-menu-btn__dropdown-arrow-separator"></div>\n    <div\n      class="dropdown-menu-btn__dropdown-arrow-indicator"\n      h-branding="ctaTextColor, ctaBackgroundColor">\n      <div>▼</div>\n    </div>\n  </button>\n</div>\n';

},{}],143:[function(require,module,exports){
module.exports='<div ng-transclude ng-if="!vm.enabled"></div>\n<div class="excerpt__container" ng-if="vm.enabled">\n  <div class="excerpt" ng-style="vm.contentStyle()">\n    <div ng-transclude></div>\n    <div ng-click="vm.expand()"\n         ng-class="vm.bottomShadowStyles()"\n         title="{{\'Show the full excerpt\' | translate}}"></div>\n    <div class="excerpt__inline-controls"\n         ng-show="vm.showInlineControls()">\n      <span class="excerpt__toggle-link" ng-show="vm.isExpandable()">\n        … <a ng-click="vm.toggle($event)"\n            title="{{\'Show the full excerpt\' | translate}}"\n            h-branding="accentColor, selectionFontFamily">{{\'More\' | translate}}</a>\n      </span>\n      <span class="excerpt__toggle-link" ng-show="vm.isCollapsible()">\n        <a ng-click="vm.toggle($event)"\n            title="{{\'Show the first few lines only\' | translate}}"\n            h-branding="accentColor, selectionFontFamily">{{\'Less\' | translate}}</a>\n      </span>\n    </div>\n  </div>\n</div>\n';

},{}],144:[function(require,module,exports){
module.exports='<span ng-if="vm.auth.status === \'logged-out\'"\n      ng-switch on="vm.groups.focused().public">\n  <img class="group-list-label__icon group-list-label__icon--third-party"\n    ng-src="{{ vm.thirdPartyGroupIcon }}"\n    ng-if="vm.thirdPartyGroupIcon"\n    ng-switch-when="true">\x3c!-- nospace\n  !--\x3e<i class="group-list-label__icon h-icon-public"\n    ng-if="!vm.thirdPartyGroupIcon"\n    ng-switch-when="true"></i>\x3c!-- nospace\n  !--\x3e<i class="group-list-label__icon h-icon-group" ng-switch-default></i>\n  <span class="group-list-label__label">{{vm.groups.focused().name}}</span>\n</span>\n\n<div class="pull-right"\n     ng-if="vm.auth.status === \'logged-in\'"\n     dropdown\n     keyboard-nav>\n  <div class="dropdown-toggle"\n        dropdown-toggle\n        data-toggle="dropdown"\n        role="button"\n        ng-switch on="vm.groups.focused().public"\n        title="{{\'Change the selected group\' | translate}}">\n    <img class="group-list-label__icon group-list-label__icon--third-party"\n         ng-src="{{ vm.thirdPartyGroupIcon }}"\n         ng-if="vm.thirdPartyGroupIcon"\n         ng-switch-when="true">\x3c!-- nospace\n    !--\x3e<i class="group-list-label__icon h-icon-public"\n           ng-switch-when="true"\n           ng-if="!vm.thirdPartyGroupIcon"></i>\x3c!-- nospace\n    !--\x3e<i class="group-list-label__icon h-icon-group"\n           ng-switch-default></i>\n    <span class="group-list-label__label">{{vm.groups.focused().name}}</span>\x3c!-- nospace\n    !--\x3e<i class="h-icon-arrow-drop-down"></i>\n  </div>\n  <div class="dropdown-menu__top-arrow"></div>\n  <ul class="dropdown-menu pull-none" role="menu">\n    <li class="dropdown-menu__row dropdown-menu__row--unpadded "\n        ng-repeat="group in vm.groups.all()">\n      <div ng-class="{\'group-item\': true, selected: group.id == vm.groups.focused().id}"\n           ng-click="vm.focusGroup(group.id)">\n        \x3c!-- the group icon !--\x3e\n        <div class="group-icon-container" ng-switch on="group.public">\n          <img class="group-list-label__icon group-list-label__icon--third-party"\n               ng-src="{{ vm.thirdPartyGroupIcon }}"\n               ng-if="vm.thirdPartyGroupIcon"\n               ng-switch-when="true">\n          <i class="h-icon-public" ng-if="!vm.thirdPartyGroupIcon" ng-switch-when="true"></i>\n          <i class="h-icon-group" ng-switch-default></i>\n        </div>\n        \x3c!-- the group name and share link !--\x3e\n        <div class="group-details">\n          <div class="group-name-container">\n            <a class="group-name-link"\n               href=""\n               title="{{ group.public ? (\'Show public annotations\' | translate ) : (\'Show and create annotations in \' | translate) + group.name  }}">\n               {{group.name}}\n            </a>\n          </div>\n          <div class="share-link-container" ng-click="$event.stopPropagation()" ng-if="!group.public">\n            <a class="share-link"\n               href="{{group.url}}"\n               target="_blank"\n               ng-click="vm.viewGroupActivity()">\n              {{\'View group activity and invite others\' | translate}}\n            </a>\n          </div>\n        </div>\n        \x3c!-- the \'Leave group\' icon !--\x3e\n        <div class="group-cancel-icon-container" ng-click="$event.stopPropagation()">\n          <i class="h-icon-cancel-outline btn--cancel"\n             ng-if="!group.public"\n             ng-click="vm.leaveGroup(group.id)"\n             title="\'Leave\' | translate \'{{group.name}}\'"></i>\n        </div>\n      </div>\n    </li>\n    <li ng-if="!vm.isThirdPartyUser()" class="dropdown-menu__row dropdown-menu__row--unpadded new-group-btn">\n      <div class="group-item" ng-click="vm.createNewGroup()">\n        <div class="group-icon-container"><i class="h-icon-add"></i></div>\n        <div class="group-details">\n          <a href="" class="group-name-link" title="{{\'Create a new group to share annotations\' | translate}}">\n            {{\'New group\' | translate}}\n          </a>\n        </div>\n      </div>\n    </li>\n  </ul>\n</div>\n';

},{}],145:[function(require,module,exports){
module.exports="\n<a class=\"help-panel-content__link\"\n   href=\"mailto:support@hypothes.is?subject=Hypothesis%20support&amp;body=Version:%20{{ vm.version }}%0D%0AUser%20Agent:%20{{vm.userAgent}}%0D%0AURL:%20{{ vm.url }}%0D%0APDF%20fingerprint:%20{{ vm.documentFingerprint ? vm.documentFingerprint : '-' }}%0D%0AUsername:%20{{ vm.auth.username ? vm.auth.username : '-' }}%0D%0ADate:%20{{ vm.dateTime | date:'dd MMM yyyy HH:mm:ss Z' }} \"\n>{{'Send us an email' | translate}}</a>\n";

},{}],146:[function(require,module,exports){
module.exports='<div class="help-panel">\n  <i class="close h-icon-close"\n    role="button"\n    title="{{\'Close\' | translate}}"\n    ng-click="vm.onClose()"></i>\n\n  <header class="help-panel-title">\n    {{\'Help\' | translate}}\n  </header>\n  <div class="help-panel-content">\n    <help-link\n      version="vm.version"\n      user-agent="vm.userAgent"\n      url="vm.url"\n      document-fingerprint="vm.documentFingerprint"\n      auth="vm.auth"\n      date-time="vm.dateTime">\n    </help-link>\n    <p ng-bind-html="\'if you have any questions or want to give us feedback.\n    You can also send <a class=\\\'help-panel-content__link\\\' href=\\\'https://hypothesis.zendesk.com/hc/en-us/requests/new\\\' target=\\\'_blank\\\'>a support ticket</a>\n    or visit our <a class=\\\'help-panel-content__link\\\' href=\\\'https://hypothesis.zendesk.com/hc/en-us\\\' target=\\\'_blank\\\'> help documents</a>.\' | translate"\n    ></p>\n  </div>\n  <header class="help-panel-title">\n    {{\'About this version\' | translate}}\n  </header>\n  <dl class="help-panel-content">\n    <dt class="help-panel-content__key">{{\'Version\' | translate}}: </dt>\n    <dd class="help-panel-content__val">{{ vm.version }}</dd>\n    <dt class="help-panel-content__key">{{\'User agent\' | translate}}: </dt>\n    <dd class="help-panel-content__val">{{ vm.userAgent }}</dd>\n    <div ng-if="vm.url">\n      <dt class="help-panel-content__key">{{\'URL\' | translate}}: </dt>\n      <dd class="help-panel-content__val">{{ vm.url }}</dd>\n    </div>\n    <div ng-if="vm.documentFingerprint">\n      <dt class="help-panel-content__key">{{\'PDF fingerprint\' | translate}}: </dt>\n      <dd class="help-panel-content__val">{{ vm.documentFingerprint }}</dd>\n    </div>\n    <div ng-if="vm.auth.userid">\n      <dt class="help-panel-content__key">{{\'Username\' | translate}}: </dt>\n      <dd class="help-panel-content__val">{{ vm.auth.username }}</dd>\n    </div>\n    <dt class="help-panel-content__key">{{\'Date\' | translate}}: </dt>\n    <dd class="help-panel-content__val">{{ vm.dateTime | date:\'dd MMM yyyy HH:mm:ss Z\' }}</dd>\n  </div>\n</div>\n';

},{}],147:[function(require,module,exports){
module.exports='<div class="app-content-wrapper js-thread-list-scroll-root" h-branding="appBackgroundColor">\n  <top-bar\n    auth="vm.auth"\n    on-login="vm.login()"\n    on-sign-up="vm.signUp()"\n    on-logout="vm.logout()"\n    on-share-page="vm.share()"\n    on-show-help-panel="vm.showHelpPanel()"\n    is-sidebar="::vm.isSidebar"\n    pending-update-count="vm.countPendingUpdates()"\n    on-apply-pending-updates="vm.applyPendingUpdates()"\n    search-controller="vm.search"\n    sort-key="vm.sortKey()"\n    sort-keys-available="vm.sortKeysAvailable()"\n    on-change-sort-key="vm.setSortKey(sortKey)">\n  </top-bar>\n\n  <div class="content">\n    <sidebar-tutorial ng-if="vm.isSidebar"></sidebar-tutorial>\n    <share-dialog\n      ng-if="vm.shareDialog.visible"\n      on-close="vm.shareDialog.visible = false">\n    </share-dialog>\n    <help-panel ng-if="vm.helpPanel.visible"\n      on-close="vm.helpPanel.visible = false"\n      auth="vm.auth">\n    </help-panel>\n    <main ng-view=""></main>\n  </div>\n</div>\n';

},{}],148:[function(require,module,exports){
module.exports="\x3c!-- message to display to loggedout users when they visit direct linked annotations --\x3e\n<li class=\"loggedout-message\">\n  <span>\n    {{'This is a public annotation created with Hypothesis.' | translate}}\n    <br>\n    <p ng-bing-html=\"'To reply or make your own annotations on this document,\n    <a class=\\'loggedout-message__link\\' href=\\'{{vm.serviceUrl(\\'signup\\')}}\\' target=\\'_blank\\'>create a free account</a>\n    or\n    <a class=\\'loggedout-message__link\\' href=\\'\\' ng-click=\\'vm.onLogin()\\'>log in</a>.' | translate\"\n  </span>\n  <span class=\"loggedout-message-logo\">\n    <a href=\"https://hypothes.is\">\n      <i class=\"h-icon-hypothesis-logo loggedout-message-logo__icon\"></i>\n    </a>\n  </span>\n</li>\n";

},{}],149:[function(require,module,exports){
module.exports='\x3c!-- New controls --\x3e\n<span class="login-text"\n      ng-if="vm.newStyle && vm.auth.status === \'unknown\'">⋯</span>\n<span class="login-text"\n      ng-if="vm.newStyle && vm.auth.status === \'logged-out\'">\n  <a href="" ng-click="vm.onSignUp()" target="_blank" h-branding="accentColor">{{\'Sign up\' | translate}}</a>\n  / <a href="" ng-click="vm.onLogin()" h-branding="accentColor">{{\'Log in\' | translate}}</a>\n</span>\n<div ng-if="vm.newStyle"\n     class="pull-right login-control-menu"\n     dropdown\n     keyboard-nav>\n  <a role="button"\n     class="top-bar__btn"\n     data-toggle="dropdown"\n     dropdown-toggle\n     title="{{vm.auth.username}}">\n    <i class="h-icon-account" ng-if="vm.auth.status === \'logged-in\'"></i>\x3c!--\n    !--\x3e<i class="h-icon-arrow-drop-down top-bar__dropdown-arrow"></i>\n  </a>\n  <ul class="dropdown-menu pull-right" role="menu">\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <span ng-if="!vm.shouldEnableProfileButton()"\n            class="dropdown-menu__link dropdown-menu__link--disabled js-user-profile-btn is-disabled">\n        {{vm.auth.displayName}}</span>\n      <a ng-if="vm.shouldEnableProfileButton()"\n         ng-click="vm.showProfile()"\n         class="dropdown-menu__link js-user-profile-btn is-enabled"\n         title="{{\'View all your annotations\' | translate}}"\n         target="_blank">{{vm.auth.displayName}}</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\' && !vm.isThirdPartyUser()">\n      <a class="dropdown-menu__link js-account-settings-btn" href="{{vm.serviceUrl(\'account.settings\')}}" target="_blank">{{\'Account settings\' | translate}}</a>\n    </li>\n    <li class="dropdown-menu__row">\n      <a class="dropdown-menu__link js-help-btn" ng-click="vm.onShowHelpPanel()">{{\'Help\' | translate}}</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.shouldShowLogOutButton()">\n      <a class="dropdown-menu__link dropdown-menu__link--subtle js-log-out-btn"\n         href="" ng-click="vm.onLogout()">{{\'Log out\' | translate}}</a>\n    </li>\n  </ul>\n</div>\n\n\x3c!-- Old controls --\x3e\n<span ng-if="!vm.newStyle && vm.auth.status === \'unknown\'">⋯</span>\n<span ng-if="!vm.newStyle && vm.auth.status === \'logged-out\'">\n  <a href="" ng-click="vm.onLogin()">{{\'Log in\' | translate}}</a>\n</span>\n<div ng-if="!vm.newStyle"\n     class="pull-right login-control-menu"\n     dropdown\n     keyboard-nav>\n  <span role="button" data-toggle="dropdown" dropdown-toggle>\n    {{vm.auth.username}}\x3c!--\n    --\x3e<span class="provider"\n             ng-if="vm.auth.provider">/{{vm.auth.provider}}</span>\x3c!--\n    --\x3e<i class="h-icon-arrow-drop-down"></i>\n  </span>\n  <ul class="dropdown-menu pull-right" role="menu">\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <a class="dropdown-menu__link" href="{{vm.serviceUrl(\'account.settings\')}}" target="_blank">{{\'Account\' | translate}}</a>\n    </li>\n    <li class="dropdown-menu__row" >\n      <a class="dropdown-menu__link" ng-click="vm.onShowHelpPanel()">{{\'Help\' | translate}}</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <a class="dropdown-menu__link" href="{{vm.serviceUrl(\'user\',{user: vm.auth.username})}}"\n         target="_blank">{{\'My Annotations\' | translate}}</a>\n    </li>\n    <li class="dropdown-menu__row" ng-if="vm.auth.status === \'logged-in\'">\n      <a class="dropdown-menu__link" href="" ng-click="vm.onLogout()">{{\'Log out\' | translate}}</a>\n    </li>\n  </ul>\n</div>\n';

},{}],150:[function(require,module,exports){
module.exports='<div ng-if="!vm.readOnly" class="markdown-tools" ng-class="vm.preview && \'disable\'">\n  <span class="markdown-preview-toggle">\n    <a class="markdown-tools-badge h-icon-markdown" href="https://help.github.com/articles/markdown-basics" title="{{\'Parsed as Markdown\' | translate}}" target="_blank"></a>\n    <a href="" class="markdown-tools-toggle" ng-click="vm.togglePreview()"\n      ng-show="!vm.preview">{{\'Preview\' | translate}}</a>\n    <a href="" class="markdown-tools-toggle" ng-click="vm.togglePreview()"\n      ng-show="vm.preview">{{\'Write\' | translate}}</a>\n  </span>\n  <i class="h-icon-format-bold markdown-tools-button" ng-click="vm.insertBold()" title="{{\'Embolden text\' | translate}}"></i>\n  <i class="h-icon-format-italic markdown-tools-button" ng-click="vm.insertItalic()" title="{{\'Italicize text\' | translate}}"></i>\n  <i class="h-icon-format-quote markdown-tools-button" ng-click="vm.insertQuote()" title="{{\'Quote text\' | translate}}"></i>\n  <i class="h-icon-insert-link markdown-tools-button" ng-click="vm.insertLink()" title="{{\'Insert link\' | translate}}"></i>\n  <i class="h-icon-insert-photo markdown-tools-button" ng-click="vm.insertIMG()" title="{{\'Insert image\' | translate}}"></i>\n  <i class="h-icon-functions markdown-tools-button" ng-click="vm.insertMath()" title="{{\'Insert mathematical notation (LaTex is supported)\' | translate}}"></i>\n  <i class="h-icon-format-list-numbered markdown-tools-button" ng-click="vm.insertNumList()" title="{{\'Insert numbered list\' | translate}}"></i>\n  <i class="h-icon-format-list-bulleted markdown-tools-button" ng-click="vm.insertList()" title="{{\'Insert list\' | translate}}"></i>\n</div>\n<textarea class="form-input form-textarea js-markdown-input"\n          ng-show="vm.showEditor()"\n          ng-click="$event.stopPropagation()"\n          h-branding="annotationFontFamily"></textarea>\n<div class="markdown-body js-markdown-preview"\n     ng-class="(vm.preview && \'markdown-preview\') || vm.customTextClass"\n     ng-dblclick="vm.togglePreview()"\n     ng-show="!vm.showEditor()"\n     h-branding="annotationFontFamily"></div>\n';

},{}],151:[function(require,module,exports){
module.exports='<div class="moderation-banner"\n     ng-if="vm.isHiddenOrFlagged()"\n     ng-class="{\'is-flagged\': vm.flagCount() > 0,\n                \'is-hidden\': vm.isHidden(),\n                \'is-reply\': vm.isReply()}">\n  <span ng-if="vm.flagCount() > 0 && !vm.isHidden()">\n    Flagged for review x{{ vm.flagCount() }}\n  </span>\n  <span ng-if="vm.isHidden()">\n    {{\'Hidden from users.\' | translate}} Flagged x{{ vm.flagCount() }}\n  </span>\n  <span class="u-stretch"></span>\n  <button ng-if="!vm.isHidden()"\n          ng-click="vm.hideAnnotation()"\n          title="{{\'Hide this feedback from non-moderators\' | translate}}">\n    {{\'Hide\' | translate}}\n  </button>\n  <button ng-if="vm.isHidden()"\n          ng-click="vm.unhideAnnotation()"\n          title="{{\'Make this feedback visible to everyone\' | translate}}">\n    {{\'Unhide\' | translate}}\n  </button>\n</div>\n';

},{}],152:[function(require,module,exports){
module.exports='<button class="new-note__create" ng-click="vm.onNewNoteBtnClick()" h-branding="ctaBackgroundColor">\n  + {{\'New note\' | translate}}\n</button>\n';

},{}],153:[function(require,module,exports){
module.exports='<button class="publish-annotation-cancel-btn btn-clean"\n        ng-click="vm.onCancel()"\n        title="{{\'Cancel changes to this feedback\' | translate}}"\n        >\n  <i class="h-icon-cancel-outline publish-annotation-cancel-btn__icon btn-icon"></i> {{\'Cancel\' | translate}}\n</button>\n<div dropdown="" class="publish-annotation-btn__btn" is-open="vm.showDropdown" keyboard-nav>\n  <dropdown-menu-btn\n    label="(\'Post to\' | translate) + \' \' + vm.publishDestination()"\n    on-click="vm.onSave()"\n    on-toggle-dropdown="vm.showDropdown = !vm.showDropdown"\n    title="{{\'Publish this feedback to\' | translate}} {{vm.publishDestination()}}"\n    dropdown-menu-label="{{\'Change annotation sharing setting\' | translate}}"\n    is-disabled="!vm.canPost">\n  </dropdown-menu-btn>\n  <div class="publish-annotation-btn__dropdown-container">\n    <ul class="dropdown-menu pull-center group-list publish-annotation-btn__dropdown-menu" role="menu">\n      <li class="dropdown-menu__row" ng-click="vm.setPrivacy(\'shared\')">\n        <div class="group-item">\n          <div class="group-icon-container">\n            <i class="small" ng-class="\'h-icon-\' + vm.groupType()"></i>\n          </div>\n          <div class="group-details">\n            <div class="group-name-container">\n              <a href="" class="group-name-link" ng-bind="vm.group.name"></a>\n            </div>\n          </div>\n        </div>\n      </li>\n      <li class="dropdown-menu__row" ng-click="vm.setPrivacy(\'private\')">\n        <div class="group-item">\n          <div class="group-icon-container">\n            <i class="small h-icon-lock"></i>\n          </div>\n          <div class="group-details">\n            <div class="group-name-container">\n              <a href="" class="group-name-link" ng-bind="vm.privateLabel"></a>\n            </div>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n';

},{}],154:[function(require,module,exports){
module.exports='<form class="simple-search-form"\n      name="searchForm"\n      ng-class="!vm.query && \'simple-search-inactive\'">\n  <input class="simple-search-input"\n         type="text"\n         name="query"\n         placeholder="{{vm.loading && (\'Loading\' | translate) || (\'Search\' | translate) }}…"\n         ng-disabled="vm.loading"\n         ng-class="vm.inputClasses()"/>\n  <button type="button" class="simple-search-icon top-bar__btn" ng-hide="vm.loading">\n    <i class="h-icon-search"></i>\n  </button>\n  <button type="button" class="simple-search-icon btn btn-clean" ng-show="vm.loading" disabled>\n    <span class="btn-icon"><span class="spinner"></span></span>\n  </button>\n</form>\n';

},{}],155:[function(require,module,exports){
module.exports='<div class="search-status-bar" ng-if="vm.filterActive">\n  <button class="primary-action-btn primary-action-btn--short"\n          ng-click="vm.onClearSelection()"\n          title="{{\'Clear the search filter and show all feedback\' | translate}}"\n  >\n    <i class="primary-action-btn__icon h-icon-close"></i> {{\'Clear search\' | translate}}\n  </button>\n  <span ng-pluralize\n           count="vm.filterMatchCount"\n           when="{\'0\': \'No results for “{{vm.searchQuery}}”\',\n                  \'one\': \'1 search result\',\n                  \'other\': \'{} search results\'}"></span>\n</div>\n<div class="search-status-bar" ng-if="!vm.filterActive && vm.selectionCount > 0">\n  <button class="primary-action-btn primary-action-btn--short"\n          ng-click="vm.onClearSelection()"\n          title="Clear the selection and show all annotations">\n    <span ng-if="!vm.selectedTab || vm.selectedTab === vm.TAB_ORPHANS">\n      {{\'Show all feedback and notes\' | translate}}\n    </span>\n    <span ng-if="vm.selectedTab === vm.TAB_ANNOTATIONS">\n      {{\'Show all feedback\' | translate }}\n      <span ng-if="vm.totalAnnotations > 1">\n        ({{vm.totalAnnotations}})\n      </span>\n    </span>\n    <span ng-if="vm.selectedTab === vm.TAB_NOTES">\n      {{\'Show all notes\' | translate}}\n      <span ng-if="vm.totalNotes > 1">\n        ({{vm.totalNotes}})\n      </span>\n    </span>\n  </button>\n\n</div>\n';

},{}],156:[function(require,module,exports){
module.exports='\x3c!-- Tabbed display of annotations and notes. --\x3e\n<div class="selection-tabs"\n  ng-class="{\'selection-tabs--theme-clean\' : vm.isThemeClean }">\n  <a class="selection-tabs__type"\n     href="#"\n     ng-class="{\'is-selected\': vm.selectedTab === vm.TAB_ANNOTATIONS}"\n     h-on-touch="vm.selectTab(vm.TAB_ANNOTATIONS)">\n     {{\'Feedback\' | translate}}\n    <span class="selection-tabs__count"\n      ng-if="vm.totalAnnotations > 0 && !vm.isWaitingToAnchorAnnotations">\n      {{ vm.totalAnnotations }}\n    </span>\n  </a>\n  <a class="selection-tabs__type"\n     ng-if="!vm.isThemeCustom"\n     href="#"\n     ng-class="{\'is-selected\': vm.selectedTab === vm.TAB_NOTES}"\n     h-on-touch="vm.selectTab(vm.TAB_NOTES)">\n     {{\'Page Notes\' | translate}}\n    <span class="selection-tabs__count"\n      ng-if="vm.totalNotes > 0 && !vm.isWaitingToAnchorAnnotations">\n      {{ vm.totalNotes }}\n    </span>\n  </a> \n  <a class="selection-tabs__type selection-tabs__type--orphan"\n    ng-if="vm.totalOrphans > 0 && !vm.isThemeCustom"\n    href="#"\n    ng-class="{\'is-selected\': vm.selectedTab === vm.TAB_ORPHANS}"\n    h-on-touch="vm.selectTab(vm.TAB_ORPHANS)">\n    {{\'Orphans\' | translate}}\n    <span class="selection-tabs__count"\n      ng-if="vm.totalOrphans > 0 && !vm.isWaitingToAnchorAnnotations">\n      {{ vm.totalOrphans }}\n    </span>\n  </a>\n</div>\n<new-note-btn\n  ng-if="vm.selectedTab === vm.TAB_NOTES && vm.enableExperimentalNewNoteButton">\n</new-note-btn>\n<div ng-if="!vm.isLoading()" class="selection-tabs__empty-message">\n  <div ng-if="vm.showNotesUnavailableMessage() && !vm.isThemeCustom"  class="annotation-unavailable-message">\n    <p class="annotation-unavailable-message__label">\n        {{\'There are no page notes in this group.\' | translate}}\n      <br />\n      <div ng-if="!vm.enableExperimentalNewNoteButton && !vm.showSidebarTutorial()" class="annotation-unavailable-message__tutorial">\n        <p ng-bind-html="\'Create one by clicking the <i class=\\\'help-icon h-icon-note\\\'></i> button\' | translate"></p>\n      </div>\n    </p>\n  </div>\n  <div ng-if="vm.showAnnotationsUnavailableMessage()"  class="annotation-unavailable-message">\n    <p class="annotation-unavailable-message__label">\n      {{\'There is no feedback in this group.\' | translate}}\n      <br />\n      <div ng-if="!vm.showSidebarTutorial()" class="annotation-unavailable-message__tutorial">\n          <p ng-bind-html="\'Create one by selecting some text and clicking the <i class=\\\'help-icon h-icon-annotate\\\'></i> button\' | translate"></p>\n      </div>\n    </p>\n  </div>\n</div>\n';

},{}],157:[function(require,module,exports){
module.exports='<div class="sheet">\n  <i class="close h-icon-close"\n     role="button"\n     title="{{\'Close\' | translate}}"\n     ng-click="vm.onClose()"></i>\n  <div class="form-vertical">\n    <ul class="nav nav-tabs">\n      <li class="active"><a href="">{{\'Share\' | translate}}</a></li>\n    </ul>\n    <div class="tab-content">\n      <p>{{\'Share the link below to show anyone these annotations and invite them to contribute their own.\' | translate}}</p>\n      <p><input class="js-via form-input"\n          type="text"\n          ng-value="vm.viaPageLink"\n          readonly /></p>\n      <p class="share-link-icons">\n      <a href="https://twitter.com/intent/tweet?url={{vm.viaPageLink | urlEncode}}&hashtags=annotated"\n         target="_blank"\n         title="{{\'Tweet link\' | translate}}"\n         class="share-link-icon h-icon-twitter"\n         ng-click="onShareClick(\'twitter\')"></a>\n      <a href="https://www.facebook.com/sharer/sharer.php?u={{vm.viaPageLink | urlEncode}}"\n         target="_blank"\n         title="{{\'Share on Facebook\' | translate}}"\n         class="share-link-icon h-icon-facebook"\n         ng-click="onShareClick(\'facebook\')"></a>\n      <a href="https://plus.google.com/share?url={{vm.viaPageLink | urlEncode}}"\n         target="_blank"\n         title="{{\'Post on Google Plus\' | translate}}"\n         class="share-link-icon h-icon-google-plus"\n         ng-click="onShareClick(\'googlePlus\')"></a>\n      <a href="mailto:?subject=Let\'s%20Annotate&amp;body={{vm.viaPageLink}}"\n         target="_blank"\n         title="{{\'Share via email\' | translate}}"\n         class="share-link-icon h-icon-mail"\n         ng-click="onShareClick(\'email\')"></a>\n      </p>\n    </div>\n  </div>\n</div>\n';

},{}],158:[function(require,module,exports){
module.exports='<selection-tabs\n  ng-if="!vm.search.query() && vm.selectedAnnotationCount() === 0"\n  is-waiting-to-anchor-annotations="vm.waitingToAnchorAnnotations"\n  is-loading="vm.isLoading"\n  selected-tab="vm.selectedTab"\n  total-annotations="vm.totalAnnotations"\n  total-notes="vm.totalNotes"\n  total-orphans="vm.totalOrphans">\n</selection-tabs>\n\n<search-status-bar\n  ng-show="!vm.isLoading()"\n  filter-active="!!vm.search.query()"\n  filter-match-count="vm.visibleCount()"\n  on-clear-selection="vm.clearSelection()"\n  search-query="vm.search ? vm.search.query : \'\'"\n  selection-count="vm.selectedAnnotationCount()"\n  total-count="vm.topLevelThreadCount()"\n  selected-tab="vm.selectedTab"\n  total-annotations="vm.totalAnnotations"\n  total-notes="vm.totalNotes">\n</search-status-bar>\n\n<div class="annotation-unavailable-message"\n    ng-if="vm.selectedAnnotationUnavailable()">\n  <div class="annotation-unavailable-message__icon"></div>\n  <p class="annotation-unavailable-message__label">\n    <span ng-if="vm.auth.status === \'logged-out\'">\n      {{\'This feedback is not available.\' | translate}}\n      <br>\n      <p ng-bind-html="\'You may need to <a class=\\\'loggedout-message__link\\\' href=\\\'\\\' ng-click=\\\'vm.login()\\\'>log in</a> to see it.\' | translate"></p>\n    </span>\n    <span ng-if="vm.auth.status === \'logged-in\'">\n      {{\'You do not have permission to view this feedback.\' | translate}}\n    </span>\n  </p>\n</div>\n<thread-list\n  on-change-collapsed="vm.setCollapsed(id, collapsed)"\n  on-clear-selection="vm.clearSelection()"\n  on-focus="vm.focus(annotation)"\n  on-force-visible="vm.forceVisible(thread)"\n  on-select="vm.scrollTo(annotation)"\n  show-document-info="false"\n  thread="vm.rootThread">\n</thread-list>\n\n<loggedout-message ng-if="vm.shouldShowLoggedOutMessage()" on-login="vm.login()">\n</loggedout-message>\n';

},{}],159:[function(require,module,exports){
module.exports='<div class="sheet" ng-if="vm.showSidebarTutorial() &&  !vm.isThemeClean">\n  <i class="close h-icon-close" role="button" title="Close"\n     ng-click="vm.dismiss()"></i>\n  <h1 class="sidebar-tutorial__header">{{\'How to get started\' | translate}}</h1>\n  <ol class="sidebar-tutorial__list">\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content" \n        ng-bind-html="\'To create an annotation, select text and click the <i class=\\\'h-icon-annotate\\\'></i> button.\' | translate">\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content"\n        ng-bind-html="\'To add a note to the page you are viewing, click the <i class=\\\'h-icon-note\\\'></i> button.\' | translate">\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content"\n        ng-bind-html="\'To create a highlight, select text and click the <i class=\\\'h-icon-highlight\\\'></i> button.\' | translate">\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content"\n          ng-bind-html="\'To reply to an annotation, click the <i class=\\\'h-icon-annotation-reply\\\'></i> button. <strong>Reply</strong> link.\' | translate">\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content"\n          ng-bind-html="\'To share an annotated page, click the <i class=\\\'h-icon-annotation-share\\\'></i> button at the top.\' | translate">\n      </p>\n    </li>\n    <li class="sidebar-tutorial__list-item">\n      <p class="sidebar-tutorial__list-item-content"\n      ng-bind-html="\'To create a private group, select <strong>Public</strong>, open the dropdown, click <strong>+ New group</strong>.\' | translate">\n      </p>\n    </li>\n  </ol>\n</div>\n<div class="sheet sheet--is-theme-clean" ng-if="vm.showSidebarTutorial() && vm.isThemeClean">\n  <i class="close h-icon-close" role="button" title="Close"\n     ng-click="vm.dismiss()"></i>\n  <h1 class="sidebar-tutorial__header sidebar-tutorial__header--is-theme-clean">\n    <i class="h-icon-annotate sidebar-tutorial__header-annotate" h-branding="accentColor"></i>\n    {{\'Start annotating\' | translate}}\n  </h1>\n  <ol class="sidebar-tutorial__list">\n    <li class="sidebar-tutorial__list-item sidebar-tutorial__list-item--is-theme-clean">\n      <div class="sidebar-tutorial__list-item-content">\n        <p ng-html-bind="\'Select some text to\n          <span class=\\\'sidebar-tutorial__list-item-annotate\\\'> leave feedback </span>\n          <svg-icon class=\\\'sidebar-tutorial__list-item-cursor\\\' name=\\\'\\\'cursor\\\'\\\'></svg-icon>\n        or highlight.\' | translate">\n      </p>\n      </div>\n    </li>\n    <li class="sidebar-tutorial__list-item sidebar-tutorial__list-item--is-theme-clean">\n      <div class="sidebar-tutorial__list-item-content sidebar-tutorial__list-item-content--is-theme-clean">\n        {{\'Create page level notes\' | translate}}\n        <span class="sidebar-tutorial__list-item-new-note-btn" h-branding="ctaBackgroundColor">\n          + {{\'New note\' | translate}}\n        </span>\n      </div>\n    </li>\n    <li class="sidebar-tutorial__list-item sidebar-tutorial__list-item--is-theme-clean">\n      <div class="sidebar-tutorial__list-item-content">\n        {{\'View feedback through your profile\' | translate}}\n        <i class="h-icon-account sidebar-tutorial__list-item-profile"></i>\n        <i class="h-icon-arrow-drop-down sidebar-tutorial__list-item-drop-down"></i>\n      </div>\n    </li>\n  </ol>\n</div>\n';

},{}],160:[function(require,module,exports){
module.exports='<span dropdown keyboard-nav>\n  <button\n    type="button"\n    class="top-bar__btn"\n    dropdown-toggle\n    title="{{\'Sort by\' | translate}} {{vm.sortKey}}">\n    <i class="h-icon-sort"></i>\n  </button>\n  <div class="dropdown-menu__top-arrow"></div>\n  <ul class="dropdown-menu pull-right" role="menu">\n    <li class="dropdown-menu__row"\n        ng-repeat="key in vm.sortKeysAvailable"\n        ng-click="vm.onChangeSortKey({sortKey: key})"\n        ><span class="dropdown-menu-radio"\n               ng-class="{\'is-selected\' : vm.sortKey === key}"\n        ></span><a class="dropdown-menu__link" href="">{{key}}</a></li>\n  </ul>\n</span>\n';

},{}],161:[function(require,module,exports){
module.exports='<span window-scroll="vm.loadMore(20)">\n  <thread-list\n    on-change-collapsed="vm.setCollapsed(id, collapsed)"\n    on-force-visible="vm.forceVisible(thread)"\n    show-document-info="true"\n    thread="vm.rootThread">\n  </thread-list>\n</span>\n';

},{}],162:[function(require,module,exports){
module.exports='<tags-input ng-model="vm.tagList"\n  name="tags"\n  class="tags"\n  placeholder="Add tags…"\n  min-length="1"\n  replace-spaces-with-dashes="false"\n  enable-editing-last-tag="true"\n  on-tag-added="vm.onTagsChanged()"\n  on-tag-removed="vm.onTagsChanged()">\n  <auto-complete source="vm.autocomplete($query)"\n    min-length="1"\n    max-results-to-show="10"></auto-complete>\n</tags-input>\n';

},{}],163:[function(require,module,exports){
module.exports='<ul class="thread-list">\n  <li class="thread-list__spacer"\n      ng-style="{height: vm.virtualThreadList.offscreenUpperHeight}"></li>\n  <li ng-repeat="child in vm.virtualThreadList.visibleThreads track by child.id">\n    <div id="{{child.id}}"\n        class="thread-list__card"\n        ng-mouseenter="vm.onFocus({annotation: child.annotation})"\n        ng-class="{\'thread-list__card--theme-clean\' : vm.isThemeClean}"\n        ng-click="vm.onSelect({annotation: child.annotation})"\n        ng-mouseleave="vm.onFocus({annotation: null})">\n        <annotation-thread\n          thread="child"\n          show-document-info="vm.showDocumentInfo"\n          on-change-collapsed="vm.onChangeCollapsed({id: id, collapsed: collapsed})"\n          on-force-visible="vm.onForceVisible({thread: thread})">\n        </annotation-thread>\n    </div>\n    <hr ng-if="vm.isThemeClean"\n        class="thread-list__separator--theme-clean" />\n  </li>\n  <li id="{{child.id}}"\n      ng-show="false"\n      ng-repeat="child in vm.virtualThreadList.invisibleThreads track by child.id">\n      <annotation-thread thread="child" />\n  </li>\n  <li class="thread-list__spacer"\n      ng-style="{height: vm.virtualThreadList.offscreenLowerHeight}"></li>\n</ul>\n';

},{}],164:[function(require,module,exports){
module.exports='<div ng-switch="vm.href">\n  <span ng-switch-when=""\n        class="{{ vm.className }}"\n        title="{{ vm.absoluteTimestamp }}">\n    {{ vm.relativeTimestamp }}\n  </span>\n  <a ng-switch-default\n     class="{{ vm.className }}"\n     target="_blank"\n     title="{{ vm.absoluteTimestamp }}"\n     href="{{ vm.href }}">\n     {{ vm.relativeTimestamp }}\n  </a>\n</div>\n';

},{}],165:[function(require,module,exports){
module.exports='\x3c!-- top bar for the sidebar and the stream.\n!--\x3e\n<div class="top-bar"\n  ng-class="{\'top-bar--theme-clean\' : vm.isThemeClean }">\n  \x3c!-- Legacy design for top bar, as used in the stream !--\x3e\n  <div class="top-bar__inner content" ng-if="::!vm.isSidebar">\n    <search-input\n      class="search-input"\n      query="vm.searchController.query()"\n      on-search="vm.searchController.update($query)"\n      always-expanded="true">\n    </search-input>\n    <div class="top-bar__expander"></div>\n    <login-control\n      auth="vm.auth"\n      new-style="false"\n      on-show-help-panel="vm.onShowHelpPanel()"\n      on-login="vm.onLogin()"\n      on-logout="vm.onLogout()">\n    </login-control>\n  </div>\n  \x3c!-- New design for the top bar, as used in the sidebar.\n\n       The inner div is styled with \'content\' to center it in\n       the stream view.\n  !--\x3e\n  <div class="top-bar__inner content" ng-if="::vm.isSidebar">\n    <group-list class="group-list" auth="vm.auth"></group-list>\n    <div class="top-bar__expander"></div>\n    <a class="top-bar__apply-update-btn"\n       ng-if="vm.pendingUpdateCount > 0"\n       ng-click="vm.onApplyPendingUpdates()"\n       h-tooltip\n       tooltip-direction="up"\n       aria-label="Show {{vm.pendingUpdateCount}} new/updated annotation(s)">\n       <svg-icon class="top-bar__apply-icon" name="\'refresh\'"></svg-icon>\n    </a>\n    <search-input\n      class="search-input"\n      query="vm.searchController.query()"\n      on-search="vm.searchController.update($query)"\n      title="{{\'Filter the feedback list\' | translate}}">\n    </search-input>\n    <sort-dropdown\n      ng-if="!vm.isThemeCustom"\n      sort-keys-available="vm.sortKeysAvailable"\n      sort-key="vm.sortKey"\n      on-change-sort-key="vm.onChangeSortKey({sortKey: sortKey})">\n    </sort-dropdown>\n    <a class="top-bar__btn"\n       ng-click="vm.onSharePage()"\n       ng-if="vm.showSharePageButton() && !vm.isThemeCustom"\n       title="{{\'Share this page\' | translate}}">\n      <i class="h-icon-annotation-share"></i>\n    </a>\n    <login-control\n      class="login-control"\n      auth="vm.auth"\n      new-style="true"\n      on-show-help-panel="vm.onShowHelpPanel()"\n      on-login="vm.onLogin()"\n      on-logout="vm.onLogout()"\n      on-sign-up="vm.onSignUp()">\n    </login-control>\n  </div>\n</div>\n';

},{}],166:[function(require,module,exports){
"use strict";function lessThanThirtySecondsAgo(t,n){return n-t<3e4}function lessThanOneMinuteAgo(t,n){return n-t<6e4}function lessThanOneHourAgo(t,n){return n-t<36e5}function lessThanOneDayAgo(t,n){return n-t<864e5}function thisYear(t,n){return t.getFullYear()===n.getFullYear()}function delta(t,n){return Math.round((n-t)/1e3)}function nSec(t,n){return"{} secs".replace("{}",Math.floor(delta(t,n)))}function nMin(t,n){var e=Math.floor(delta(t,n)/minute),r="{} min";return e>1&&(r+="s"),r.replace("{}",e)}function nHr(t,n){var e=Math.floor(delta(t,n)/hour),r="{} hr";return e>1&&(r+="s"),r.replace("{}",e)}function format(t,n,e){if(void 0===e&&(e=window.Intl),e&&e.DateTimeFormat){var r=JSON.stringify(n),a=formatters[r];return a||(a=formatters[r]=new e.DateTimeFormat(void 0,n)),a.format(t)}return t.toDateString()}function dayAndMonth(t,n,e){return format(t,{month:"short",day:"numeric"},e)}function dayAndMonthAndYear(t,n,e){return format(t,{day:"numeric",month:"short",year:"numeric"},e)}function getBreakpoint(t,n){t=new Date(t);for(var e,r=0;r<BREAKPOINTS.length;r++)if(e=BREAKPOINTS[r],e.test(t,n))return e;return null}function nextFuzzyUpdate(t){if(!t)return null;var n=getBreakpoint(t,new Date).nextUpdate;return null===n?null:(n=Math.max(n,5),n=Math.min(n,2073600))}function decayingInterval(t,n){var e;return function r(){var a=nextFuzzyUpdate(t);if(null!==a){var o=1e3*a+500;e=setTimeout(function(){n(t),r()},o)}}(),function(){clearTimeout(e)}}function toFuzzyString(t,n){if(!t)return"";var e=new Date;return getBreakpoint(t,e).format(new Date(t),e,n)}var minute=60,hour=60*minute,formatters={},BREAKPOINTS=[{test:lessThanThirtySecondsAgo,format:function(){return"Just now"},nextUpdate:1},{test:lessThanOneMinuteAgo,format:nSec,nextUpdate:1},{test:lessThanOneHourAgo,format:nMin,nextUpdate:minute},{test:lessThanOneDayAgo,format:nHr,nextUpdate:hour},{test:thisYear,format:dayAndMonth,nextUpdate:null},{test:function(){return!0},format:dayAndMonthAndYear,nextUpdate:null}];module.exports={decayingInterval:decayingInterval,nextFuzzyUpdate:nextFuzzyUpdate,toFuzzyString:toFuzzyString};

},{}],167:[function(require,module,exports){
"use strict";function translate(a){a.translations("en",require("../shared/translations/english_en.json")).translations("ja",require("../shared/translations/japanese_ja.json"))}module.exports={translate:translate};

},{"../shared/translations/english_en.json":48,"../shared/translations/japanese_ja.json":49}],168:[function(require,module,exports){
"use strict";module.exports={TAB_ANNOTATIONS:"annotation",TAB_NOTES:"note",TAB_ORPHANS:"orphan"};

},{}],169:[function(require,module,exports){
"use strict";function unicode(){return{normalize:function(u){return unorm.nfkd(u)},fold:function(u){return u.replace(COMBINING_MARKS,"")}}}var unorm=require("unorm"),COMBINING_MARKS=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u08FE\u0900-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C01-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C82\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D02\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1DC0-\u1DE6\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE26]/g;module.exports=unicode;

},{"unorm":"unorm"}],170:[function(require,module,exports){
"use strict";function parseAccountID(r){if(!r)return null;var e=r.match(/^acct:([^@]+)@(.+)/);return e?{username:e[1],provider:e[2]}:null}function username(r){var e=parseAccountID(r);return e?e.username:""}function isThirdPartyUser(r,e){var n=parseAccountID(r);return!!n&&n.provider!==e}module.exports={isThirdPartyUser:isThirdPartyUser,parseAccountID:parseAccountID,username:username};

},{}],171:[function(require,module,exports){
"use strict";function countIf(t,e){return t.reduce(function(t,n){return e(n)?t+1:t},0)}function filterMap(t,e){return t.reduce(function(t,n){var r=e(n);return r&&t.push(r),t},[])}function toSet(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}module.exports={countIf:countIf,filterMap:filterMap,toSet:toSet};

},{}],172:[function(require,module,exports){
"use strict";function disableOpenerForExternalLinks(e){e.addEventListener("click",function(e){if("A"===e.target.tagName){var t=e.target;"_blank"===t.target&&(t.rel="noopener")}})}module.exports=disableOpenerForExternalLinks;

},{}],173:[function(require,module,exports){
"use strict";function toPx(t){return t.toString()+"px"}function ExcerptOverflowMonitor(t,e){function o(){var e=t.getState();if(a){a=!1;var o=!1;if(e.enabled){var n=e.overflowHysteresis||0;o=t.contentHeight()>e.collapsedHeight+n}o!==i&&(i=o,t.onOverflowChanged(o))}}function n(){a||(a=!0,e(o))}function r(){var e=t.getState();if(!e.enabled)return{};var o="";return i?e.collapse?o=toPx(e.collapsedHeight):e.animate&&(o=toPx(t.contentHeight())):void 0===i&&e.collapse&&(o=toPx(e.collapsedHeight)),{"max-height":o}}var i,a=!1;this.contentStyle=r,this.check=n}module.exports=ExcerptOverflowMonitor;

},{}],174:[function(require,module,exports){
"use strict";function isThirdPartyService(r){var i=serviceConfig(r);return null!==i&&(!!i.hasOwnProperty("authority")&&i.authority!==r.authDomain)}var serviceConfig=require("../service-config");module.exports=isThirdPartyService;

},{"../service-config":128}],175:[function(require,module,exports){
"use strict";function memoize(e){if(1!==e.length)throw new Error("Memoize input must be a function of one argument");var n,t;return function(o){return o===n?t:(n=o,t=e(o))}}module.exports=memoize;

},{}],176:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tokenInfoFrom(e){var t=e.data;return{accessToken:t.access_token,expiresAt:Date.now()+1e3*(t.expires_in-10),refreshToken:t.refresh_token}}function generateState(){return random.generateHexString(16)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),queryString=require("query-string"),random=require("./random"),OAuthClient=function(){function e(t,n){_classCallCheck(this,e),this.$http=t,this.clientId=n.clientId,this.tokenEndpoint=n.tokenEndpoint,this.authorizationEndpoint=n.authorizationEndpoint,this.revokeEndpoint=n.revokeEndpoint,this.generateState=n.generateState||generateState}return _createClass(e,[{key:"exchangeAuthCode",value:function(e){var t={client_id:this.clientId,grant_type:"authorization_code",code:e};return this._formPost(this.tokenEndpoint,t).then(function(e){if(200!==e.status)throw new Error("Authorization code exchange failed");return tokenInfoFrom(e)})}},{key:"exchangeGrantToken",value:function(e){var t={grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:e};return this._formPost(this.tokenEndpoint,t).then(function(e){if(200!==e.status)throw new Error("Failed to retrieve access token");return tokenInfoFrom(e)})}},{key:"refreshToken",value:function(e){var t={grant_type:"refresh_token",refresh_token:e};return this._formPost(this.tokenEndpoint,t).then(function(e){if(200!==e.status)throw new Error("Failed to refresh access token");return tokenInfoFrom(e)})}},{key:"revokeToken",value:function(e){return this._formPost(this.revokeEndpoint,{token:e})}},{key:"authorize",value:function(e,t){var n=this.generateState(),o=new Promise(function(t,o){function r(i){"object"===_typeof(i.data)&&i.data.state===n&&("authorization_response"===i.data.type&&t(i.data),"authorization_canceled"===i.data.type&&o(new Error("Authorization window was closed")),e.removeEventListener("message",r))}e.addEventListener("message",r)}),r=this.authorizationEndpoint;return r+="?"+queryString.stringify({client_id:this.clientId,origin:e.location.origin,response_mode:"web_message",response_type:"code",state:n}),t.location=r,o.then(function(e){return e.code})}},{key:"_formPost",value:function(e,t){t=queryString.stringify(t);var n={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return this.$http.post(e,t,n)}}],[{key:"openAuthPopupWindow",value:function(e){var t=e.screen.width/2-237.5,n=e.screen.height/2-215,o=queryString.stringify({left:t,top:n,width:475,height:430}).replace(/&/g,",");return e.open("about:blank","Log in to Hypothesis",o)}}]),e}();module.exports=OAuthClient;

},{"./random":177,"query-string":20}],177:[function(require,module,exports){
"use strict";function byteToHex(e){var r=e.toString(16);return 1===r.length?"0"+r:r}function generateHexString(e){var r=window.crypto||window.msCrypto,t=new Uint8Array(e/2);return r.getRandomValues(t),Array.from(t).map(byteToHex).join("")}module.exports={generateHexString:generateHexString};

},{}],178:[function(require,module,exports){
"use strict";module.exports=function(t,o,e,n,u){n=n||setTimeout,u=u||clearTimeout;var i,c=n(function(){i(),o()},e);i=t.$on("$destroy",function(){u(c)})};

},{}],179:[function(require,module,exports){
"use strict";function shouldShowSidebarTutorial(o){return!!o.preferences.show_sidebar_tutorial}module.exports={shouldShowSidebarTutorial:shouldShowSidebarTutorial};

},{}],180:[function(require,module,exports){
"use strict";function replaceURLParams(e,r){var a={};for(var n in r)if(r.hasOwnProperty(n)){var o=r[n],s=":"+n;-1!==e.indexOf(s)?e=e.replace(s,encodeURIComponent(o)):a[n]=o}return{url:e,params:a}}function resolve(e,r){return new URL(e,r).href}module.exports={replaceURLParams:replaceURLParams,resolve:resolve};

},{}],181:[function(require,module,exports){
angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.dropdown","ui.bootstrap.position"]),angular.module("ui.bootstrap.tpls",[]),angular.module("ui.bootstrap.dropdown",["ui.bootstrap.position"]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$rootScope",function(e,t){var n=null;this.open=function(t){n||(e.bind("click",o),e.bind("keydown",i)),n&&n!==t&&(n.isOpen=!1),n=t},this.close=function(t){n===t&&(n=null,e.unbind("click",o),e.unbind("keydown",i))};var o=function(e){if(n&&(!e||"disabled"!==n.getAutoClose())){var o=n.getToggleElement();if(!(e&&o&&o[0].contains(e.target))){var i=n.getDropdownElement();e&&"outsideClick"===n.getAutoClose()&&i&&i[0].contains(e.target)||(n.isOpen=!1,t.$$phase||n.$apply())}}},i=function(e){27===e.which?(n.focusToggleElement(),o()):n.isKeynavEnabled()&&/(38|40)/.test(e.which)&&n.isOpen&&(e.preventDefault(),e.stopPropagation(),n.focusDropdownEntry(e.which))}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate","$position","$document","$compile","$templateRequest",function(e,t,n,o,i,r,l,d,p,s){var u,a,c=this,f=e.$new(),g=o.openClass,w=angular.noop,h=t.onToggle?n(t.onToggle):angular.noop,m=!1,O=!1,$=d.find("body");this.init=function(o){c.$element=o,t.isOpen&&(a=n(t.isOpen),w=a.assign,e.$watch(a,function(e){f.isOpen=!!e})),m=angular.isDefined(t.dropdownAppendToBody),O=angular.isDefined(t.keyboardNav),m&&c.dropdownMenu&&($.append(c.dropdownMenu),$.addClass("dropdown"),o.on("$destroy",function(){c.dropdownMenu.remove()}))},this.toggle=function(e){return f.isOpen=arguments.length?!!e:!f.isOpen},this.isOpen=function(){return f.isOpen},f.getToggleElement=function(){return c.toggleElement},f.getAutoClose=function(){return t.autoClose||"always"},f.getElement=function(){return c.$element},f.isKeynavEnabled=function(){return O},f.focusDropdownEntry=function(e){var t=c.dropdownMenu?angular.element(c.dropdownMenu).find("a"):angular.element(c.$element).find("ul").eq(0).find("a");switch(e){case 40:angular.isNumber(c.selectedOption)?c.selectedOption=c.selectedOption===t.length-1?c.selectedOption:c.selectedOption+1:c.selectedOption=0;break;case 38:angular.isNumber(c.selectedOption)?c.selectedOption=0===c.selectedOption?0:c.selectedOption-1:c.selectedOption=t.length-1}t[c.selectedOption].focus()},f.getDropdownElement=function(){return c.dropdownMenu},f.focusToggleElement=function(){c.toggleElement&&c.toggleElement[0].focus()},f.$watch("isOpen",function(t,n){if(m&&c.dropdownMenu){var o=l.positionElements(c.$element,c.dropdownMenu,"bottom-left",!0),d={top:o.top+"px",display:t?"block":"none"};c.dropdownMenu.hasClass("dropdown-menu-right")?(d.left="auto",d.right=window.innerWidth-(o.left+c.$element.prop("offsetWidth"))+"px"):(d.left=o.left+"px",d.right="auto"),c.dropdownMenu.css(d)}var a=m?$:c.$element;if(r[t?"addClass":"removeClass"](a,g).then(function(){angular.isDefined(t)&&t!==n&&h(e,{open:!!t})}),t)c.dropdownMenuTemplateUrl&&s(c.dropdownMenuTemplateUrl).then(function(e){u=f.$new(),p(e.trim())(u,function(e){var t=e;c.dropdownMenu.replaceWith(t),c.dropdownMenu=t})}),f.focusToggleElement(),i.open(f);else{if(c.dropdownMenuTemplateUrl){u&&u.$destroy();var O=angular.element('<ul class="dropdown-menu"></ul>');c.dropdownMenu.replaceWith(O),c.dropdownMenu=O}i.close(f),c.selectedOption=null}angular.isFunction(w)&&w(e,t)}),e.$on("$locationChangeSuccess",function(){"disabled"!==f.getAutoClose()&&(f.isOpen=!1)});var b=e.$on("$destroy",function(){f.$destroy()});f.$on("$destroy",b)}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(e,t,n,o){o.init(t),t.addClass("dropdown")}}}).directive("dropdownMenu",function(){return{restrict:"AC",require:"?^dropdown",link:function(e,t,n,o){if(o){var i=n.templateUrl;i&&(o.dropdownMenuTemplateUrl=i),o.dropdownMenu||(o.dropdownMenu=t)}}}}).directive("keyboardNav",function(){return{restrict:"A",require:"?^dropdown",link:function(e,t,n,o){t.bind("keydown",function(e){if(-1!==[38,40].indexOf(e.which)){e.preventDefault(),e.stopPropagation();var t=o.dropdownMenu.find("a");switch(e.which){case 40:angular.isNumber(o.selectedOption)?o.selectedOption=o.selectedOption===t.length-1?o.selectedOption:o.selectedOption+1:o.selectedOption=0;break;case 38:angular.isNumber(o.selectedOption)?o.selectedOption=0===o.selectedOption?0:o.selectedOption-1:o.selectedOption=t.length-1}t[o.selectedOption].focus()}})}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(e,t,n,o){if(o){t.addClass("dropdown-toggle"),o.toggleElement=t;var i=function(i){i.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){o.toggle()})};t.bind("click",i),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(o.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",i)})}}}}),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(e,t){function n(e,n){return e.currentStyle?e.currentStyle[n]:t.getComputedStyle?t.getComputedStyle(e)[n]:e.style[n]}function o(e){return"static"===(n(e,"position")||"static")}var i=function(t){for(var n=e[0],i=t.offsetParent||n;i&&i!==n&&o(i);)i=i.offsetParent;return i||n};return{position:function(t){var n=this.offset(t),o={top:0,left:0},r=i(t[0]);r!=e[0]&&(o=this.offset(angular.element(r)),o.top+=r.clientTop-r.scrollTop,o.left+=r.clientLeft-r.scrollLeft);var l=t[0].getBoundingClientRect();return{width:l.width||t.prop("offsetWidth"),height:l.height||t.prop("offsetHeight"),top:n.top-o.top,left:n.left-o.left}},offset:function(n){var o=n[0].getBoundingClientRect();return{width:o.width||n.prop("offsetWidth"),height:o.height||n.prop("offsetHeight"),top:o.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:o.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}},positionElements:function(e,t,n,o){var i,r,l,d,p=n.split("-"),s=p[0],u=p[1]||"center";i=o?this.offset(e):this.position(e),r=t.prop("offsetWidth"),l=t.prop("offsetHeight");var a={center:function(){return i.left+i.width/2-r/2},left:function(){return i.left},right:function(){return i.left+i.width}},c={center:function(){return i.top+i.height/2-l/2},top:function(){return i.top},bottom:function(){return i.top+i.height}};switch(s){case"right":d={top:c[u](),left:a[s]()};break;case"left":d={top:c[u](),left:i.left-r};break;case"bottom":d={top:c[s](),left:a[u]()};break;default:d={top:i.top-l,left:a[u]()}}return d}}}]);

},{}],182:[function(require,module,exports){
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function viewFilter(t){function e(e){return"string"!=typeof e?e:t.fold(t.normalize(e)).toLowerCase()}var r=this,n=function(){function t(e,r,n){_classCallCheck(this,t),this.field=e,this.term=r,this.checker=n}return _createClass(t,[{key:"matches",value:function(t){var r=this.checker;if(r.autofalse&&r.autofalse(t))return!1;var n=r.value(t);return n=Array.isArray(n)?n.map(e):e(n),r.match(this.term,n)}}]),t}(),u=function(){function t(e,r){_classCallCheck(this,t),this.operator=e,this.filters=r}return _createClass(t,[{key:"matches",value:function(t){return"and"===this.operator?this.filters.every(function(e){return e.matches(t)}):this.filters.some(function(e){return e.matches(t)})}}]),t}();this.fields={quote:{autofalse:function(t){return(t.references||[]).length>0},value:function(t){return t.target?(t.target[0].selector||[]).filter(function(t){return"TextQuoteSelector"===t.type}).map(function(t){return t.exact}).join("\n"):""},match:function(t,e){return e.indexOf(t)>-1}},since:{autofalse:function(t){return"string"!=typeof t.updated},value:function(t){return new Date(t.updated)},match:function(t,e){return(Date.now()-e)/1e3<=t}},tag:{autofalse:function(t){return!Array.isArray(t.tags)},value:function(t){return t.tags},match:function(t,e){return e.includes(t)}},text:{autofalse:function(t){return"string"!=typeof t.text},value:function(t){return t.text},match:function(t,e){return e.indexOf(t)>-1}},uri:{autofalse:function(t){return"string"!=typeof t.uri},value:function(t){return t.uri},match:function(t,e){return e.indexOf(t)>-1}},user:{autofalse:function(t){return"string"!=typeof t.user},value:function(t){return t.user},match:function(t,e){return e.indexOf(t)>-1}}},this.filter=function(t,i){var a=Object.entries(i).filter(function(t){return _slicedToArray(t,2)[1].terms.length>0}).map(function(t){var i,a=_slicedToArray(t,2),o=a[0],c=a[1],f=c.terms.map(e);if("any"===o){var s=["quote","text","tag","user"];i=f.map(function(t){return new u("or",s.map(function(e){return new n(e,t,r.fields[e])}))})}else i=f.map(function(t){return new n(o,t,r.fields[o])});return new u(c.operator,i)}),o=new u("and",a);return t.filter(function(t){return o.matches(t)}).map(function(t){return t.id})}}viewFilter.$inject=["unicode"];var _slicedToArray=function(){function t(t,e){var r=[],n=!0,u=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){u=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(u)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();_slicedToArray.$inject=["arr","i"];var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),unused;module.exports=viewFilter;

},{}],183:[function(require,module,exports){
"use strict";function VirtualThreadList(t,e,i,r){var s=this;this._rootThread=i,this._options=Object.assign({},r),this._heights={},this.window=e,this.scrollRoot=r.scrollRoot||document.body;var o=debounce(function(){s._updateVisibleThreads(),t.$digest()},20);this.scrollRoot.addEventListener("scroll",o),this.window.addEventListener("resize",o),this._detach=function(){this.scrollRoot.removeEventListener("scroll",o),this.window.removeEventListener("resize",o)}}var EventEmitter=require("tiny-emitter"),debounce=require("lodash.debounce"),inherits=require("inherits");inherits(VirtualThreadList,EventEmitter),VirtualThreadList.prototype.detach=function(){this._detach()},VirtualThreadList.prototype.setRootThread=function(t){t!==this._rootThread&&(this._rootThread=t,this._updateVisibleThreads())},VirtualThreadList.prototype.setThreadHeight=function(t,e){if(isNaN(e)||e<=0)throw new Error("Invalid thread height %d",e);this._heights[t]=e},VirtualThreadList.prototype._height=function(t){return this._heights[t]||200},VirtualThreadList.prototype.yOffsetOf=function(t){var e=this,i=this._rootThread.children,r=i.findIndex(function(e){return e.id===t});return-1===r?0:i.slice(0,r).reduce(function(t,i){return t+e._height(i.id)},0)},VirtualThreadList.prototype._updateVisibleThreads=function(){for(var t,e=0,i=0,r=[],s=[],o=this._rootThread.children,h=this.window.innerHeight,n=0,d=0;d<o.length;d++){t=o[d];var a=this._height(t.id),l=!1;n+a<this.scrollRoot.scrollTop-800?i+=a:n<this.scrollRoot.scrollTop+h+800?(r.push(t),l=!0):e+=a,!l&&this._options.invisibleThreadFilter&&this._options.invisibleThreadFilter(t)&&s.push(t),n+=a}this.emit("changed",{offscreenLowerHeight:e,offscreenUpperHeight:i,visibleThreads:r,invisibleThreads:s})},module.exports=VirtualThreadList;

},{"inherits":5,"lodash.debounce":6,"tiny-emitter":40}],184:[function(require,module,exports){
"use strict";function Socket(e){function t(){for(;u.length>0;){var e=JSON.stringify(u.shift());i.send(e)}}function n(){c||(c=retry.operation({minTimeout:2*RECONNECT_MIN_DELAY,retries:10,randomize:!0}),c.attempt(function(){i=new WebSocket(e),i.onopen=function(e){o(),s.emit("open",e)},i.onclose=function(e){if(e.code===CLOSE_NORMAL)return void s.emit("close",e);var t=new Error("WebSocket closed abnormally, code: "+e.code);console.warn(t),r(t)},i.onerror=function(e){s.emit("error",e)},i.onmessage=function(e){s.emit("message",e)}}))}function o(){c=null,t()}function r(e){if(c)return void(c.retry(e)||console.error("reached max retries attempting to reconnect websocket"));var t=RECONNECT_MIN_DELAY;t+=Math.floor(Math.random()*t),c=setTimeout(function(){c=null,n()},t)}var i,c,s=this,u=[];this.close=function(){i.close()},this.send=function(e){u.push(e),this.isConnected()&&t()},this.isConnected=function(){return i.readyState===WebSocket.OPEN},n()}var retry=require("retry"),EventEmitter=require("tiny-emitter"),inherits=require("inherits"),CLOSE_NORMAL=1e3,RECONNECT_MIN_DELAY=1e3;inherits(Socket,EventEmitter),module.exports=Socket;

},{"inherits":5,"retry":32,"tiny-emitter":40}]},{},[105])
//# sourceMappingURL=sidebar.bundle.js.map
